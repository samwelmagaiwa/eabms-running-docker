services:
  backend:
    image: ghcr.io/samwelmagaiwa/eabms-backend:latest
    container_name: eabms_backend

    environment:
      APP_NAME: "EABMS, Access and Booking management system"
      APP_ENV: production
      APP_DEBUG: "false"
      APP_KEY: base64:iDBpDRUav/eeZD3lKtTIo4OZ2lIeitDKnhJ8CYLMkDw=
      APP_URL: http://eabms.mloganzila.or.tz
      
      DB_CONNECTION: mysql
      DB_HOST: 192.168.30.246
      DB_PORT: 3306
      DB_DATABASE: eabms_prod
      DB_USERNAME: samwel_eabms
      DB_PASSWORD: Samwel123@
      
      SESSION_DRIVER: database
      
      # SMS Service Configuration - Kilakona
      SMS_ENABLED: "true"
      SMS_API_URL: https://messaging.kilakona.co.tz/api/v1/vendor/message/send
      SMS_API_KEY: chimwege
      SMS_API_SECRET: f5IZEc5o8PeXi9l5ilOo
      SMS_SECRET_KEY: f5IZEc5o8PeXi9l5ilOo
      SMS_SENDER_ID: MLG
      SMS_SENDER_NAME: MLG
      SMS_BASE_URL: https://messaging.kilakona.co.tz/
      SMS_DELIVERY_REPORT_URL: http://eabms.mloganzila.or.tz/api/sms/delivery-report
      SMS_DELIVERY_REPORT_TOKEN: "some-strong-random-token"
      SMS_TEST_MODE: "false"
      SMS_MESSAGE_TYPE: text
      SMS_VERIFY_SSL: "false"
      SMS_TIMEOUT: 30
      SMS_RETRY_ATTEMPTS: 3
      SMS_RETRY_DELAY: 60
      SMS_RATE_LIMIT_PER_HOUR: 10
      SMS_MAX_BULK_SIZE: 100
      SMS_BULK_DELAY: 0.1
      SMS_LOGGING_ENABLED: "true"
      SMS_LOG_SUCCESSFUL: "true"
      SMS_LOG_FAILED: "true"
      SMS_LOG_LEVEL: info
      SMS_QUEUE_ENABLED: "true"
      SMS_QUEUE_NAME: sms
      SMS_MAX_TRIES: 3
      SMS_FAKE_SEND: "false"
      SMS_LOG_TO_FILE: "false"
      SMS_MOCK_RESPONSES: "false"
      SMS_FALLBACK_ENABLED: "false"
      
      # Additional Production Overrides
      CORS_ALLOWED_ORIGINS: http://eabms.mloganzila.or.tz
      SANCTUM_STATEFUL_DOMAINS: eabms.mloganzila.or.tz
      
    volumes:
      - ./backend/storage:/var/www/storage
      - ./backend/bootstrap/cache:/var/www/bootstrap/cache
      - app_data:/var/www

  nginx:
    image: nginx:stable-alpine
    container_name: eabms_nginx
    ports:
      - "80:80"
    volumes:
      - ./backend:/var/www
      - ./docker/nginx/default.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - backend
    networks:
      - eabms_network

  db:
    image: mysql:8.0
    container_name: eabms_db
    restart: always
    environment:
      MYSQL_DATABASE: eabms_prod
      MYSQL_USER: samwel_eabms
      MYSQL_PASSWORD: Samwel123@
      MYSQL_ROOT_PASSWORD: Samwel123@
    ports:
      - "3306:3306"
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - eabms_network

networks:
  eabms_network:
    driver: bridge

volumes:
  app_data:
  db_data:
