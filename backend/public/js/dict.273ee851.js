"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[4710,5531],{1445:function(e,t,s){s.d(t,{A:function(){return x}});var r=s(5796);const a={key:0,class:"fixed inset-0 z-40 flex items-center justify-center pointer-events-none animate-fade-in"},i={class:"pointer-events-auto w-full max-w-lg mx-auto"},o={class:"relative bg-gradient-to-br from-white/20 via-blue-50/30 to-white/10 border-2 border-blue-300/50 backdrop-blur-xl rounded-3xl p-8 shadow-2xl overflow-hidden"},n={class:"relative z-10"},d={class:"flex items-center justify-center gap-6 mb-6"},l={class:"relative flex flex-col items-center"},c={class:"relative mb-3"},u={class:"text-center"},p={class:"text-white text-2xl font-bold tracking-wide mb-1 drop-shadow-md"},h={class:"text-blue-100 text-lg animate-pulse"},b={class:"text-center border-t border-blue-300/30 pt-4"},f={class:"text-teal-200 text-base font-semibold tracking-wider"};function g(e,t,s,g,m,v){return s.show?((0,r.uX)(),(0,r.CE)("div",a,[(0,r.Lk)("div",i,[(0,r.Lk)("div",o,[t[5]||(t[5]=(0,r.Fv)('<div class="absolute inset-0 opacity-10" data-v-94539b4a><div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-slide-across" data-v-94539b4a></div><div class="absolute top-4 left-4 w-16 h-16 rounded-full animate-float" style="background:rgba(255, 0, 0, 0.2);" data-v-94539b4a></div><div class="absolute bottom-4 right-4 w-20 h-20 bg-blue-400/20 rounded-full animate-float" style="animation-delay:1s;" data-v-94539b4a></div><div class="absolute top-1/2 left-8 w-12 h-12 rounded-full animate-float" style="background:rgba(255, 0, 0, 0.15);animation-delay:2s;" data-v-94539b4a></div></div>',1)),(0,r.Lk)("div",n,[(0,r.Lk)("div",d,[t[1]||(t[1]=(0,r.Lk)("div",{class:"relative"},[(0,r.Lk)("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500/30 to-teal-500/30 rounded-2xl backdrop-blur-sm border-2 border-blue-300/50 flex items-center justify-center shadow-xl hover:scale-105 transition-transform duration-300"},[(0,r.Lk)("img",{src:"/assets/images/ngao2.png",alt:"National Shield",class:"max-w-12 max-h-12 object-contain drop-shadow-lg"})]),(0,r.Lk)("div",{class:"absolute -inset-1 bg-gradient-to-r from-blue-400 to-teal-400 rounded-2xl opacity-20 blur-sm animate-pulse"})],-1)),(0,r.Lk)("div",l,[(0,r.Lk)("div",c,[t[0]||(t[0]=(0,r.Lk)("div",{class:"rounded-full h-12 w-12 border-2 border-gray-300/20"},null,-1)),(0,r.Lk)("div",{class:(0,r.C4)(["absolute inset-0 rounded-full h-12 w-12 border-4 border-transparent shadow-lg",s.forceSpin?"always-spin":"animate-spin"]),style:{"border-top-color":"#ff0000","animation-duration":"2s"}},null,2),(0,r.Lk)("div",{class:(0,r.C4)(["absolute inset-0 rounded-full h-12 w-12 border-4 border-transparent shadow-lg",s.forceSpin?"always-spin":"animate-spin"]),style:{"border-bottom-color":"#0000d1","animation-direction":"reverse","animation-duration":"1.5s"}},null,2),(0,r.Lk)("div",{class:(0,r.C4)(["absolute inset-0 rounded-full h-12 w-12 border-4 border-transparent shadow-lg",s.forceSpin?"always-spin":"animate-spin"]),style:{"border-right-color":"rgba(255, 0, 0, 0.7)","animation-duration":"2.5s"}},null,2),(0,r.Lk)("div",{class:(0,r.C4)(["absolute inset-0 rounded-full h-12 w-12 border-4 border-transparent shadow-lg",s.forceSpin?"always-spin":"animate-spin"]),style:{"border-left-color":"rgba(0, 0, 209, 0.7)","animation-direction":"reverse","animation-duration":"1.8s"}},null,2)]),(0,r.Lk)("div",u,[(0,r.Lk)("div",p,(0,r.v_)(s.loadingTitle),1),(0,r.Lk)("div",h,(0,r.v_)(s.loadingSubtitle),1)])]),t[2]||(t[2]=(0,r.Lk)("div",{class:"relative"},[(0,r.Lk)("div",{class:"w-16 h-16 bg-gradient-to-br from-teal-500/30 to-blue-500/30 rounded-2xl backdrop-blur-sm border-2 border-teal-300/50 flex items-center justify-center shadow-xl hover:scale-105 transition-transform duration-300"},[(0,r.Lk)("img",{src:"/assets/images/logo2.png",alt:"MNH Logo",class:"max-w-12 max-h-12 object-contain drop-shadow-lg"})]),(0,r.Lk)("div",{class:"absolute -inset-1 bg-gradient-to-r from-teal-400 to-blue-400 rounded-2xl opacity-20 blur-sm animate-pulse",style:{"animation-delay":"0.5s"}})],-1))]),(0,r.Lk)("div",b,[t[3]||(t[3]=(0,r.Lk)("div",{class:"text-lg font-black tracking-widest mb-1 drop-shadow-sm",style:{color:"#ff0000"}}," MUHIMBILI NATIONAL HOSPITAL ",-1)),(0,r.Lk)("div",f,(0,r.v_)(s.departmentTitle),1)]),t[4]||(t[4]=(0,r.Fv)('<div class="flex justify-center gap-2 mt-4" data-v-94539b4a><div class="w-2 h-2 rounded-full animate-bounce" style="background:#ff0000;" data-v-94539b4a></div><div class="w-2 h-2 rounded-full animate-bounce" style="background:#0000d1;animation-delay:0.1s;" data-v-94539b4a></div><div class="w-2 h-2 rounded-full animate-bounce" style="background:#ff0000;animation-delay:0.2s;" data-v-94539b4a></div><div class="w-2 h-2 rounded-full animate-bounce" style="background:#0000d1;animation-delay:0.3s;" data-v-94539b4a></div></div>',1))])])])])):(0,r.Q3)("",!0)}var m={name:"UnifiedLoadingBanner",props:{show:{type:Boolean,default:!0},loadingTitle:{type:String,default:"Loading Requests"},loadingSubtitle:{type:String,default:"Please wait..."},departmentTitle:{type:String,default:"SYSTEM MANAGEMENT"},forceSpin:{type:Boolean,default:!1}}},v=s(1241);const y=(0,v.A)(m,[["render",g],["__scopeId","data-v-94539b4a"]]);var x=y},4710:function(e,t,s){s.r(t);s(4603),s(7566),s(8721);var r=s(4373);const a="/api",i=r.A.create({baseURL:a,timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json"}}),o=r.A.create({baseURL:a,timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json"}}),n=!1,d=e=>{e.interceptors.request.use(e=>{const t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e))};d(i),d(o);const l=e=>{e.interceptors.request.use(e=>{if(e.method&&"get"===e.method.toLowerCase())try{const t=new URL(e.url,e.baseURL);t.searchParams.set("_cb",String(Date.now())),e.url=t.pathname+t.search}catch(t){const s=(e.url||"").includes("?")?"&":"?";e.url=`${e.url}${s}_cb=${Date.now()}`}return e},e=>Promise.reject(e))};l(i),l(o);const c={data:null,timestamp:null,maxAge:15e3},u="true"===String({NODE_ENV:"production",VUE_APP_API_TIMEOUT:"30000",VUE_APP_API_URL:"/api",VUE_APP_DEBUG:"false",VUE_APP_LOG_LEVEL:"debug",VUE_APP_NAME:"Mnh Access Management System",VUE_APP_VERSION:"1.0.0",BASE_URL:"/"}.VUE_APP_ENABLE_SMS_RESEND||"false").toLowerCase(),p={isResendEnabled(){return u},async resendSmsGeneric({requestId:e,role:t=null,target:s=null,phone:r=null,channel:a="sms"}){if(!u)return{success:!1,message:"SMS resend not supported by backend; skipped"};const i=e=>{if(!e)return null;const t=String(e).trim(),s=t.startsWith("+"),r=t.replace(/[^\d]/g,"");return s?`+${r}`:r},n=r||null,d=i(n),l={request_id:e,role:t,target:s,notification_type:"generic_sms",resend_only:!0,force:!0,force_resend:!0,resend_sms:!0,send_sms:!0,notification_channel:a,phone:n||void 0,phone_number:d||void 0,recipient_phone:d||void 0,destination_phone:d||void 0,msisdn:d||void 0,contact_phone:d||void 0,requester_phone:n||void 0,requester_phone_number:n||void 0,staff_phone:n||void 0,staff_phone_number:n||void 0},c=[];let p,h;for(let u=0;u<c.length;u++)try{return p=await o.post(c[u],l),{success:!!p.data?.success,data:p.data?.data,message:p.data?.message}}catch(b){h=b;continue}return{success:!1,message:h?.response?.data?.message||h?.message||"No resend endpoints configured"}},async getPendingRequestsCount(e=!1){if(!e&&c.data&&c.timestamp){const e=Date.now()-c.timestamp;if(e<c.maxAge)return n&&Math.round(e/1e3),c.data}let t=null;const s=2;for(let a=1;a<=s;a++)try{const e=await o.get("/notifications/pending-count");if(e.data.success)return c.data=e.data.data,c.timestamp=Date.now(),e.data.data;console.error("âŒ NotificationService: Failed to load pending count:",e.data.message),t=new Error(e.data.message||"Failed to load pending requests count")}catch(r){if(a===s&&n&&console.error("âŒ NotificationService: Error fetching pending count:",r?.message||r),r.response&&(console.error("Response status:",r.response.status),console.error("Response data:",r.response.data),console.error("Response headers:",r.response.headers)),t=r,401===r.response?.status||403===r.response?.status)break;if(500===r.response?.status&&a>=2)break;a<s&&await new Promise(e=>setTimeout(e,1e3*a))}if(t){if(c.data)return console.warn("âš ï¸ NotificationService: Using stale cached data due to API failure"),c.data;n&&(console.error("ðŸš« NotificationService: All retry attempts failed"),console.error("Last error details:",{message:t.message,status:t.response?.status,data:t.response?.data})),n&&console.warn("ðŸ”„ NotificationService: Providing fallback data to prevent UI breakage");const e={total_pending:0,requires_attention:!1,details:null};return c.data=e,c.timestamp=Date.now(),e}return{total_pending:0,requires_attention:!1,details:null}},async getPendingRequestsBreakdown(){try{const e=await o.get("/notifications/breakdown");if(e.data.success)return e.data.data;throw console.error("âŒ NotificationService: Failed to load breakdown:",e.data.message),new Error(e.data.message||"Failed to load breakdown")}catch(e){console.error("âŒ NotificationService: Error fetching breakdown:",e);let t="Network error while loading breakdown";throw e.response?t=e.response.data?.message||"Failed to load breakdown":"ECONNABORTED"===e.code?t="Request timed out - server may be slow":e.message.includes("Network Error")&&(t="Network connection error"),new Error(t)}},clearCache(){c.data=null,c.timestamp=null},getRoleNotificationConfig(e){const t={head_of_department:{routePattern:"/hod-dashboard",menuItems:["/hod-dashboard/request-list"],description:"New requests awaiting HOD approval"},divisional_director:{routePattern:"/divisional-dashboard",menuItems:["/divisional-dashboard/combined-requests"],description:"HOD-approved requests awaiting divisional approval"},ict_director:{routePattern:"/dict-dashboard",menuItems:["/dict-dashboard/combined-requests"],description:"Divisional-approved requests awaiting ICT Director approval"},head_of_it:{routePattern:"/head_of_it-dashboard",menuItems:["/head_of_it-dashboard/combined-requests"],description:"ICT Director-approved requests awaiting Head of IT approval"},ict_officer:{routePattern:"/ict-dashboard",menuItems:["/ict-dashboard/access-requests"],description:"Requests requiring implementation (excludes implemented/completed)"},admin:{routePattern:"/admin-dashboard",menuItems:["/admin-dashboard","/service-users"],description:"System-wide pending requests"}};return t[e]||{routePattern:"/user-dashboard",menuItems:[],description:"No pending approval tasks"}},shouldShowNotificationForRoute(e,t){const s=this.getRoleNotificationConfig(t);return s.menuItems.includes(e)}};t["default"]=p},8667:function(e,t,s){s.r(t),s.d(t,{default:function(){return ke}});var r=s(5796);const a={class:"flex flex-col h-screen"},i={class:"flex flex-1 overflow-hidden"},o={class:"sidebar-narrow"},n={class:"flex-1 p-4 bg-blue-900 overflow-y-auto"},d={class:"max-w-full mx-auto"},l={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},c={class:"text-lg"},u={class:"grid grid-cols-4 gap-4 mb-6"},p={class:"bg-yellow-600/25 border border-yellow-400/40 p-4 rounded-xl"},h={class:"text-white text-3xl font-extrabold mt-1"},b={class:"bg-green-600/25 border border-green-400/40 p-4 rounded-xl"},f={class:"text-white text-3xl font-extrabold mt-1"},g={class:"bg-red-600/25 border border-red-400/40 p-4 rounded-xl"},m={class:"text-white text-3xl font-extrabold mt-1"},v={class:"bg-blue-600/25 border border-blue-400/40 p-4 rounded-xl"},y={class:"text-white text-3xl font-extrabold mt-1"},x={class:"bg-white/10 rounded-lg p-4 mb-6"},w={class:"flex gap-4"},_={class:"bg-white/10 rounded-lg",style:{overflow:"visible"}},k={style:{"overflow-x":"auto"}},q={class:"w-full"},L={class:"px-4 py-3"},R={class:"flex items-center space-x-2"},S={class:"flex-shrink-0"},A={key:0,class:"fas fa-clock text-yellow-400 text-base",title:"Pending your approval"},C={key:1,class:"fas fa-check-circle text-green-400 text-base",title:"Processed by you"},E={class:"text-white font-semibold text-sm"},T={class:"text-purple-300 text-xs"},D={class:"px-4 py-3"},I={class:"flex flex-wrap gap-2"},P={key:0,class:"px-2 py-1 rounded text-xs bg-blue-100 text-blue-800"},F={key:1,class:"px-2 py-1 rounded text-xs bg-green-100 text-green-800"},N={key:2,class:"px-2 py-1 rounded text-xs bg-cyan-100 text-cyan-800"},U={class:"px-4 py-3"},j={class:"text-white font-semibold text-sm"},$={class:"text-blue-300 text-xs"},M={key:0,class:"text-teal-300 text-xs"},X={class:"text-blue-200 text-xs"},O={class:"px-4 py-3"},Q={class:"text-white font-semibold text-sm"},V={class:"text-blue-300 text-xs"},B={class:"px-4 py-3"},H={class:"flex flex-col"},z={key:0,class:"mb-1 rounded text-xs font-semibold inline-block bg-red-900/30 text-red-300 border border-red-500/40 px-2 py-0.5",style:{width:"fit-content"}},W={key:1,class:"mt-1 px-1.5 py-0.5 rounded text-[10px] font-semibold bg-emerald-900/30 text-emerald-300 border border-emerald-500/40 w-fit"},G={class:"px-4 py-3"},J={class:"flex items-center space-x-3"},K=["onClick","disabled"],Y={key:0},Z={key:1},ee={key:1,class:"text-xs text-blue-200 ml-1"},te={class:"px-4 py-3 text-center relative"},se={class:"flex justify-center three-dot-menu"},re=["onClick","aria-label"],ae=["onClick"],ie={class:"font-semibold"},oe={key:0,class:"text-center py-12"},ne={class:"text-blue-300 text-base"},de={key:1,class:"px-4 py-3 border-t border-blue-300/30"},le={class:"text-blue-300 text-base"};function ce(e,t,s,ce,ue,pe){const he=(0,r.g2)("Header"),be=(0,r.g2)("ModernSidebar"),fe=(0,r.g2)("AppFooter"),ge=(0,r.g2)("UnifiedLoadingBanner"),me=(0,r.g2)("RequestTimeline");return(0,r.uX)(),(0,r.CE)("div",a,[(0,r.bF)(he),(0,r.Lk)("div",i,[(0,r.Lk)("div",o,[(0,r.bF)(be)]),(0,r.Lk)("main",n,[(0,r.Lk)("div",d,[ue.error?((0,r.uX)(),(0,r.CE)("div",l,[t[4]||(t[4]=(0,r.Lk)("h3",{class:"font-bold text-xl"},"Error",-1)),(0,r.Lk)("p",c,(0,r.v_)(ue.error),1),(0,r.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>pe.fetchRequests&&pe.fetchRequests(...e)),class:"mt-2 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 text-base font-medium"}," Retry ")])):(0,r.Q3)("",!0),(0,r.Lk)("div",u,[(0,r.Lk)("div",p,[t[5]||(t[5]=(0,r.Lk)("h3",{class:"text-yellow-200 text-lg font-bold"},"Pending My Approval",-1)),(0,r.Lk)("p",h,(0,r.v_)(ue.stats.pendingDict),1)]),(0,r.Lk)("div",b,[t[6]||(t[6]=(0,r.Lk)("h3",{class:"text-green-200 text-lg font-bold"},"Approved by Me",-1)),(0,r.Lk)("p",f,(0,r.v_)(ue.stats.dictApproved),1)]),(0,r.Lk)("div",g,[t[7]||(t[7]=(0,r.Lk)("h3",{class:"text-red-200 text-lg font-bold"},"Rejected by Me",-1)),(0,r.Lk)("p",m,(0,r.v_)(ue.stats.dictRejected),1)]),(0,r.Lk)("div",v,[t[8]||(t[8]=(0,r.Lk)("h3",{class:"text-blue-200 text-lg font-bold"},"Total Requests",-1)),(0,r.Lk)("p",y,(0,r.v_)(ue.stats.total),1)])]),(0,r.Lk)("div",x,[(0,r.Lk)("div",w,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>ue.searchQuery=e),type:"text",placeholder:"Search by staff name, PF number, or department...",class:"flex-1 px-4 py-3 bg-white/20 border-2 border-blue-300/40 rounded-lg text-white placeholder-blue-200/60 text-base"},null,512),[[r.Jo,ue.searchQuery]]),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>ue.statusFilter=e),class:"px-4 py-3 bg-white/20 border-2 border-blue-300/40 rounded-lg text-white text-base status-select"},[...t[9]||(t[9]=[(0,r.Fv)('<option value="" data-v-5f360234>All My Requests</option><option value="pending" data-v-5f360234>Show All Pending</option><option value="divisional_approved" data-v-5f360234>Pending My Approval</option><option value="ict_director_approved" data-v-5f360234>Approved by Me</option><option value="dict_approved" data-v-5f360234>Dict Approved</option><option value="dict_rejected" data-v-5f360234>Rejected by Me</option><option value="ict_director_rejected" data-v-5f360234>ICT Rejected</option><option value="approved" data-v-5f360234>Approved</option><option value="implemented" data-v-5f360234>Implemented</option><option value="completed" data-v-5f360234>Completed</option><option value="cancelled" data-v-5f360234>Cancelled</option>',11)])],512),[[r.u1,ue.statusFilter]]),(0,r.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>pe.refreshRequests&&pe.refreshRequests(...e)),class:"px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 text-base font-bold"}," Refresh ")])]),(0,r.Lk)("div",_,[(0,r.Lk)("div",k,[(0,r.Lk)("table",q,[t[12]||(t[12]=(0,r.Lk)("thead",{class:"bg-blue-800/50"},[(0,r.Lk)("tr",null,[(0,r.Lk)("th",{class:"px-4 py-3 text-left text-blue-100 text-sm font-bold"},"Request ID"),(0,r.Lk)("th",{class:"px-4 py-3 text-left text-blue-100 text-sm font-bold"}," Request Type "),(0,r.Lk)("th",{class:"px-4 py-3 text-left text-blue-100 text-sm font-bold"}," Personal Information "),(0,r.Lk)("th",{class:"px-4 py-3 text-left text-blue-100 text-sm font-bold"}," Divisional Approval Date "),(0,r.Lk)("th",{class:"px-4 py-3 text-left text-blue-100 text-sm font-bold"}," Current Status "),(0,r.Lk)("th",{class:"px-4 py-3 text-left text-blue-100 text-sm font-bold"},"SMS Status"),(0,r.Lk)("th",{class:"px-4 py-3 text-center text-blue-100 text-sm font-bold"},"Actions")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(pe.filteredRequests,e=>((0,r.uX)(),(0,r.CE)("tr",{key:e.id,class:(0,r.C4)(["border-t border-blue-300/20 hover:bg-blue-700/30 transition-colors duration-200",pe.isPendingStatus(e.status)?"bg-yellow-900/20 border-l-4 border-yellow-400":"bg-green-900/10 border-l-4 border-green-600"])},[(0,r.Lk)("td",L,[(0,r.Lk)("div",R,[(0,r.Lk)("div",S,[pe.isPendingStatus(e.status)?((0,r.uX)(),(0,r.CE)("i",A)):((0,r.uX)(),(0,r.CE)("i",C))]),(0,r.Lk)("div",null,[(0,r.Lk)("div",E,(0,r.v_)(e.request_id||`REQ-${e.id.toString().padStart(6,"0")}`),1),(0,r.Lk)("div",T,"ID: "+(0,r.v_)(e.id),1)])])]),(0,r.Lk)("td",D,[(0,r.Lk)("div",I,[pe.hasService(e,"jeeva")?((0,r.uX)(),(0,r.CE)("span",P," Jeeva ")):(0,r.Q3)("",!0),pe.hasService(e,"wellsoft")?((0,r.uX)(),(0,r.CE)("span",F," Wellsoft ")):(0,r.Q3)("",!0),pe.hasService(e,"internet")?((0,r.uX)(),(0,r.CE)("span",N," Internet ")):(0,r.Q3)("",!0)])]),(0,r.Lk)("td",U,[(0,r.Lk)("div",j,(0,r.v_)(e.staff_name||e.full_name||"Unknown User"),1),(0,r.Lk)("div",$,(0,r.v_)(e.phone||e.phone_number||"No phone"),1),e.pf_number?((0,r.uX)(),(0,r.CE)("div",M," PF: "+(0,r.v_)(e.pf_number),1)):(0,r.Q3)("",!0),(0,r.Lk)("div",X," Dept: "+(0,r.v_)(e.department||"Unknown"),1)]),(0,r.Lk)("td",O,[(0,r.Lk)("div",Q,(0,r.v_)(pe.formatDate(e.divisional_approved_at)),1),(0,r.Lk)("div",V,(0,r.v_)(pe.formatTime(e.divisional_approved_at)),1)]),(0,r.Lk)("td",B,[(0,r.Lk)("div",H,["skipped"===e.divisional_status?((0,r.uX)(),(0,r.CE)("span",z," No Divisional Director â€” Stage Skipped ")):(0,r.Q3)("",!0),(0,r.Lk)("span",{class:(0,r.C4)([pe.getStatusBadgeClass(e.status),"rounded text-sm font-semibold inline-block"]),style:{padding:"4px 8px",width:"fit-content"}},(0,r.v_)(pe.getStatusText(e.status)),3),e.has_signature||e.signature?((0,r.uX)(),(0,r.CE)("span",W," Digitally signed ")):(0,r.Q3)("",!0)])]),(0,r.Lk)("td",G,[(0,r.Lk)("div",J,[(0,r.Lk)("div",{class:(0,r.C4)(["w-3 h-3 rounded-full",pe.getSmsStatusColor(pe.getRelevantSmsStatus(e))])},null,2),(0,r.Lk)("span",{class:(0,r.C4)(["text-sm font-semibold",pe.getSmsStatusTextColor(pe.getRelevantSmsStatus(e))])},(0,r.v_)(pe.getSmsStatusText(pe.getRelevantSmsStatus(e))),3),["failed","pending"].includes(pe.getRelevantSmsStatus(e))?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:(0,r.D$)(t=>pe.retrySendSms(e),["stop"]),disabled:pe.isRetrying(e.id),class:"ml-2 px-2 py-1 text-xs rounded border border-blue-300/50 text-blue-100 hover:bg-blue-700/40 disabled:opacity-50",title:"Retry sending SMS"},[pe.isRetrying(e.id)?((0,r.uX)(),(0,r.CE)("span",Z,[...t[10]||(t[10]=[(0,r.Lk)("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),(0,r.eW)("Retrying",-1)])])):((0,r.uX)(),(0,r.CE)("span",Y,"Retry"))],8,K)):(0,r.Q3)("",!0),pe.getRetryAttempts(e.id)>0?((0,r.uX)(),(0,r.CE)("span",ee," ("+(0,r.v_)(pe.getRetryAttempts(e.id))+") ",1)):(0,r.Q3)("",!0)])]),(0,r.Lk)("td",te,[(0,r.Lk)("div",se,[(0,r.Lk)("button",{onClick:(0,r.D$)(t=>pe.toggleDropdown(e.id),["stop"]),class:(0,r.C4)(["three-dot-button p-2 text-white hover:bg-blue-600/40 rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-400 hover:scale-105 active:scale-95",{"bg-blue-600/40 shadow-lg":ue.openDropdownId===e.id}]),"aria-label":"Actions for request "+(e.request_id||"REQ-"+e.id.toString().padStart(6,"0"))},[...t[11]||(t[11]=[(0,r.Lk)("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[(0,r.Lk)("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"})],-1)])],10,re),((0,r.uX)(),(0,r.Wv)(r.Im,{to:"body"},[(0,r.bo)((0,r.Lk)("div",{ref_for:!0,ref:"dropdown-"+e.id,class:"dropdown-menu fixed w-48 bg-white rounded-lg shadow-xl border border-gray-200 py-1 min-w-max",style:(0,r.Tr)(pe.getDropdownStyle(e.id)),onClick:(0,r.D$)(()=>{},["stop"])},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(pe.getAvailableActions(e),(t,s)=>((0,r.uX)(),(0,r.CE)("button",{key:t.key,onClick:(0,r.D$)(s=>pe.executeAction(t.key,e),["stop"]),class:(0,r.C4)(["w-full text-left px-4 py-2 text-sm hover:bg-gray-50 transition-all duration-200 flex items-center space-x-3 group",[{"border-t border-gray-100":s>0&&pe.shouldShowSeparator(t,pe.getAvailableActions(e)[s-1])},pe.getActionColorClass(t)]])},[(0,r.Lk)("i",{class:(0,r.C4)([[t.icon,pe.getActionIconColorClass(t)],"flex-shrink-0 transition-colors duration-200 text-base"])},null,2),(0,r.Lk)("span",ie,(0,r.v_)(t.label),1)],10,ae))),128))],4),[[r.aG,ue.openDropdownId===e.id]])]))])])],2))),128))])])]),0===pe.filteredRequests.length?((0,r.uX)(),(0,r.CE)("div",oe,[t[13]||(t[13]=(0,r.Lk)("h3",{class:"text-white text-xl font-medium mb-2"},"No requests found",-1)),(0,r.Lk)("p",ne,(0,r.v_)(ue.searchQuery||ue.statusFilter?"No requests match your current filters.":"No requests available for ICT Director review. Requests appear here when approved by Divisional Directors."),1)])):(0,r.Q3)("",!0),pe.filteredRequests.length>0?((0,r.uX)(),(0,r.CE)("div",de,[(0,r.Lk)("div",le," Showing "+(0,r.v_)(pe.filteredRequests.length)+" of "+(0,r.v_)(ue.requests.length)+" requests ",1)])):(0,r.Q3)("",!0)]),(0,r.bF)(fe)])])]),ue.isLoading?((0,r.uX)(),(0,r.Wv)(ge,{key:0,"loading-title":"Loading Access Requests","loading-subtitle":"Fetching requests awaiting ICT Director review...","department-title":"ICT Director Dashboard"})):(0,r.Q3)("",!0),(0,r.bF)(me,{show:ue.showTimeline,"request-id":ue.selectedRequestId,onClose:pe.closeTimeline,onUpdated:pe.handleTimelineUpdate},null,8,["show","request-id","onClose","onUpdated"])])}s(4114),s(8111),s(2489),s(116),s(7588),s(3579);var ue=s(5498),pe=s(8966),he=s(9101),be=s(373),fe=s(1445),ge=s(9189),me=s(2398),ve=s(1127),ye=s(4710),xe={name:"DictRequestList",components:{Header:ue.A,ModernSidebar:pe.A,AppFooter:he.A,RequestTimeline:be.A,UnifiedLoadingBanner:fe.A},setup(){const{userRole:e}=(0,ve.h)();return{userRole:e}},data(){return{requests:[],searchQuery:"",statusFilter:"",isLoading:!1,stats:{pendingDict:0,dictApproved:0,dictRejected:0,total:0},error:null,openDropdownId:null,dropdownPositions:{},showTimeline:!1,selectedRequestId:null,retryAttempts:{},retryTimers:{},maxRetryAttempts:5,retryDelays:[3e3,7e3,15e3,3e4,6e4],$statusUtils:me.Ay}},watch:{$route(e,t){"/dict-dashboard/combined-requests"===e.path&&t?.path?.includes("/both-service-form/")&&this.fetchRequests()}},computed:{filteredRequests(){if(!Array.isArray(this.requests))return console.warn("DictRequestList: requests is not an array:",this.requests),[];let e=this.requests;if(this.searchQuery){const t=this.searchQuery.toLowerCase();e=e.filter(e=>(e.staff_name||e.full_name||"").toLowerCase().includes(t)||(e.pf_number||"").toLowerCase().includes(t)||(e.department||"").toLowerCase().includes(t)||(e.request_id||"").toLowerCase().includes(t))}return this.statusFilter&&(e="pending"===this.statusFilter?e.filter(e=>this.isPendingStatus(e.status)):e.filter(e=>e.status===this.statusFilter)),e.sort((e,t)=>{const s=this.isPendingStatus(e.status),r=this.isPendingStatus(t.status);if(s&&!r)return-1;if(!s&&r)return 1;const a=e=>this.isPendingStatus(e.status)?new Date(e.divisional_approved_at||e.created_at||0):new Date(e.ict_director_approved_at||e.updated_at||0),i=a(e),o=a(t);return i-o})}},async mounted(){try{await this.fetchRequests(),window.addEventListener("focus",this.onWindowFocus),document.addEventListener("click",this.closeAllDropdowns)}catch(e){console.error("DictRequestList: Error during mount:",e),this.error="Failed to initialize component: "+e.message,this.isLoading=!1}},async beforeRouteEnter(e,t,s){t?.path?.includes("/both-service-form/")?s(e=>{e.fetchRequests()}):s()},async beforeRouteUpdate(e,t,s){(e.meta?.refreshOnEnter||t?.path?.includes("/both-service-form/"))&&await this.fetchRequests(),s()},async activated(){await this.fetchRequests()},beforeUnmount(){window.removeEventListener("focus",this.onWindowFocus),document.removeEventListener("click",this.closeAllDropdowns)},methods:{async fetchRequests(){this.isLoading=!0,this.error=null;try{const t=await ge["default"].getDictRequests({search:this.searchQuery||void 0,status:this.statusFilter||void 0,per_page:50,include_processed:!0,show_all_ict_director_requests:!0});if(!t.success)throw new Error(t.error||"Failed to fetch requests");{const s=t.data;let r=[];Array.isArray(s)?r=s:s&&Array.isArray(s.data)?r=s.data:s&&s.data&&Array.isArray(s.data.data)&&(r=s.data.data),this.requests=r,this.requests.length,t.data;try{const e=(r||[]).filter(e=>{const t=String(e.status||"").toLowerCase(),s=String(e.ict_director_status||e.dict_status||"").toLowerCase();return"pending"===t||"pending"===s}).length;window.sidebarInstance?.setNotificationCount&&window.sidebarInstance.setNotificationCount("/dict-dashboard/combined-requests",e),window.accessRequestsPendingCount=e}catch(e){console.warn("DictRequestList: Failed to set sidebar badge override",e)}this.$nextTick(()=>this.initAutoRetryForList()),await this.fetchStatistics()}}catch(t){console.error("Error fetching requests:",t),this.error="Unable to load combined access requests. Please check your connection and try again.",this.requests=[],this.calculateStats()}finally{this.isLoading=!1}},async fetchStatistics(){try{const e=await ge["default"].getDictStatistics();if(e.success&&e.data){const t=e.data||{};this.stats={pendingDict:Number(t.pendingDict??t.pending??0),dictApproved:Number(t.dictApproved??0),dictRejected:Number(t.dictRejected??0),total:Number(t.total??0)};const s=(this.stats.pendingDict||0)+(this.stats.dictApproved||0)+(this.stats.dictRejected||0)+(this.stats.total||0);0===s&&Array.isArray(this.requests)&&this.requests.length>0&&this.calculateStats()}else this.calculateStats()}catch(e){console.error("Error fetching statistics:",e),this.calculateStats()}},calculateStats(){const e=Array.isArray(this.requests)?this.requests:[];this.stats={pendingDict:e.filter(e=>"pending"===e.status).length,dictApproved:e.filter(e=>"approved"===e.status||"approved"===e.ict_director_status).length,dictRejected:e.filter(e=>"rejected"===e.status||"rejected"===e.ict_director_status).length,total:e.length}},async refreshRequests(){await this.fetchRequests()},viewAndProcessRequest(e){this.$router.push(`/dict-dashboard/both-service-form/${e}`)},viewApprovedRequest(e){this.$router.push(`/dict-dashboard/both-service-form/${e}`)},editRequest(e){this.$router.push(`/both-service-form/${e}/edit`)},async cancelRequest(e){try{const t=confirm("Are you sure you want to cancel this request? This action cannot be undone.");if(!t)return;const s=prompt("Please provide a reason for cancellation:");if(!s||""===s.trim())return void alert("Cancellation reason is required");const r=await ge["default"].cancelRequest(e,s);if(!r.success)throw new Error(r.error||"Failed to cancel request");{const t=this.requests.findIndex(t=>t.id===e);-1!==t&&(this.requests[t].dict_status="cancelled",this.requests[t].status="cancelled"),this.calculateStats(),alert("Request cancelled successfully!")}}catch(t){console.error("Error cancelling request:",t),alert("Error cancelling request: "+t.message)}},hasService(e,t){return e.services&&e.services.includes(t)||e.request_types&&e.request_types.some(e=>"jeeva"===t&&"jeeva_access"===e||"wellsoft"===t&&"wellsoft"===e||"internet"===t&&"internet_access_request"===e)},canEdit(e){return"divisional_approved"===e.status},canCancel(e){const t=["dict_rejected","cancelled","approved","implemented","completed"];return!t.includes(e.status)},formatDate(e){if(!e)return"N/A";const t=new Date(e);return t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},formatTime(e){if(!e)return"N/A";const t=new Date(e);return t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})},getStatusBadgeClass(e){return this.$statusUtils.getStatusBadgeClass(e,"DictRequestList")},getStatusIcon(e){return this.$statusUtils.getStatusIcon(e)},getStatusText(e){return this.$statusUtils.getStatusText(e,"DictRequestList")},isPendingStatus(e){return"pending"===e},async handleRequestApproval(e,t){try{const s=await ge["default"].approveRequest(e,t);if(!s.success)throw new Error(s.error||"Failed to approve request");{const s=this.requests.findIndex(t=>t.id===e);-1!==s&&(this.requests[s].status="dict_approved",this.requests[s].dict_status="approved",this.requests[s].ict_director_approved_at=(new Date).toISOString(),this.requests[s].ict_director_comments=t.comments||"",this.requests[s].ict_director_name=t.name||"",this.requests[s].status,this.requests[s].dict_status,this.$forceUpdate()),this.calculateStats(),alert("Request approved successfully!"),await this.fetchRequests()}}catch(s){console.error("Error approving request:",s),alert("Error approving request: "+s.message)}},async handleRequestRejection(e,t){try{const s=await ge["default"].rejectRequest(e,t);if(!s.success)throw new Error(s.error||"Failed to reject request");{const s=this.requests.findIndex(t=>t.id===e);-1!==s&&(this.requests[s].status="dict_rejected",this.requests[s].dict_status="rejected",this.requests[s].ict_director_rejected_at=(new Date).toISOString(),this.requests[s].ict_director_comments=t.comments||"",this.requests[s].ict_director_name=t.name||"",this.requests[s].status,this.requests[s].dict_status,this.$forceUpdate()),this.calculateStats(),alert("Request rejected successfully!"),await this.fetchRequests()}}catch(s){console.error("Error rejecting request:",s),alert("Error rejecting request: "+s.message)}},onWindowFocus(){const e="/dict-dashboard/combined-requests"===this.$route?.path;this.isLoading||document.hidden||!e||setTimeout(()=>{this.fetchRequests()},500)},toggleDropdown(e){this.openDropdownId=this.openDropdownId===e?null:e,this.openDropdownId===e&&this.$nextTick(()=>{this.positionDropdown(e)})},positionDropdown(e){const t=document.querySelector(`[aria-label*='${e}']`);if(!t)return;const s=t.getBoundingClientRect(),r=window.innerHeight,a=200,i=r-s.bottom;this.dropdownPositions||(this.dropdownPositions={});const o=i<a+20?"top":"bottom";this.dropdownPositions[e]={position:o,top:"bottom"===o?s.bottom+4:s.top-a-4,left:s.right-192},this.$forceUpdate()},getDropdownStyle(e){const t=this.dropdownPositions?.[e];return t?{top:`${t.top}px`,left:`${t.left}px`,zIndex:99999,boxShadow:"0 10px 25px rgba(0, 0, 0, 0.15), 0 4px 6px rgba(0, 0, 0, 0.1)"}:{zIndex:99999}},closeAllDropdowns(e){e&&e.target.closest(".three-dot-menu")||(this.openDropdownId=null)},getAvailableActions(e){const t=[],s=this.userRole,r=e.status,a={HEAD_OF_IT:"head_of_it",ICT_OFFICER:"ict_officer",ICT_DIRECTOR:"ict_director",DIVISIONAL_DIRECTOR:"divisional_director",HEAD_OF_DEPARTMENT:"hod",STAFF:"staff"};if(s===a.HEAD_OF_IT)["dict_approved","ict_director_approved","approved"].includes(r)&&(t.push({key:"assign_task",label:"Assign Task",icon:"fas fa-user-plus"}),t.push({key:"cancel_task",label:"Cancel Task",icon:"fas fa-times-circle"})),t.push({key:"view_timeline",label:"View Timeline",icon:"fas fa-history"});else if(s===a.ICT_OFFICER)["assigned","in_progress","head_it_approved"].includes(r)&&t.push({key:"update_progress",label:"Update Progress",icon:"fas fa-edit"}),t.push({key:"view_timeline",label:"View Timeline",icon:"fas fa-history"});else if(s===a.ICT_DIRECTOR){const s=["ict_director_approved","dict_approved","approved","head_it_approved","assigned","in_progress","implemented","completed"].includes(r);s?(t.push({key:"view_approved_request",label:"View Approved Request",icon:"fas fa-eye",color:"blue"}),t.push({key:"view_timeline",label:"View Timeline",icon:"fas fa-history",color:"gray"})):(t.push({key:"view_and_process",label:"Approve",icon:"fas fa-check-circle",color:"green"}),this.canEdit(e)&&t.push({key:"edit_request",label:"Edit Request",icon:"fas fa-edit",color:"blue"}),this.canCancel(e)&&t.push({key:"cancel_request",label:"Cancel Request",icon:"fas fa-times",color:"red"}),t.push({key:"view_timeline",label:"View Timeline",icon:"fas fa-history",color:"gray"}))}else t.push({key:"view_and_process",label:"Approve",icon:"fas fa-check-circle",color:"green"}),t.push({key:"view_timeline",label:"View Timeline",icon:"fas fa-history"});return t},executeAction(e,t){switch(this.closeAllDropdowns(),e){case"assign_task":this.assignTask(t);break;case"cancel_task":this.cancelTask(t);break;case"update_progress":this.updateProgress(t);break;case"view_timeline":this.viewTimeline(t);break;case"view_and_process":this.viewAndProcessRequest(t.id);break;case"view_approved_request":this.viewApprovedRequest(t.id);break;case"edit_request":this.editRequest(t.id);break;case"cancel_request":this.cancelRequest(t.id);break;default:console.warn("Unknown action:",e)}},getActionColorClass(e){const t={green:"text-green-600 hover:text-green-700 hover:bg-green-50",red:"text-red-600 hover:text-red-700 hover:bg-red-50",blue:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",gray:"text-gray-600 hover:text-gray-700"};return t[e.color]||"text-gray-700 hover:text-gray-900"},getActionIconColorClass(e){const t={green:"text-green-500 group-hover:text-green-600",red:"text-red-500 group-hover:text-red-600",blue:"text-blue-500 group-hover:text-blue-600",gray:"text-gray-400 group-hover:text-gray-600"};return t[e.color]||"text-gray-400 group-hover:text-gray-600"},assignTask(e){e.id,this.$router.push(`/head_of_it-dashboard/select-ict-officer/${e.id}`)},cancelTask(e){e.id,this.cancelRequest(e.id)},updateProgress(e){e.id,alert("Update Progress functionality would be implemented here. This might open a modal or dedicated page.")},viewTimeline(e){e.id,this.selectedRequestId=e.id,this.showTimeline=!0},closeTimeline(){this.showTimeline=!1,this.selectedRequestId=null},async handleTimelineUpdate(){await this.fetchRequests(),this.initAutoRetryForList()},shouldShowSeparator(e,t){const s=["cancel_task","cancel_request"],r=["view_timeline","view_and_process"];return!(!s.includes(e.key)||s.includes(t?.key))||!(!r.includes(e.key)||r.includes(t?.key)||"view_and_process"===t?.key)},getRetryAttempts(e){return this.retryAttempts[e]||0},isRetrying(e){return!!this.retryTimers[e]},async retrySendSms(e){if(!e)return;if(!ye["default"].isResendEnabled||!ye["default"].isResendEnabled())return void console.warn("DictRequestList: SMS resend disabled by feature flag; skipping retry loop");const t=e.id;if(this.retryAttempts[t]||(this.retryAttempts[t]=0),!this.isRetrying(t))try{this.retryTimers[t]=setTimeout(()=>{},0),await ye["default"].resendSmsGeneric({requestId:t,role:"ict_director",target:"head_of_it"}),setTimeout(async()=>{await this.fetchRequests(),clearTimeout(this.retryTimers[t]),delete this.retryTimers[t];const s=this.getRelevantSmsStatus((this.requests||[]).find(e=>e.id===t)||e);"sent"!==s?this.scheduleNextRetry(t,e):this.retryAttempts[t]=0},1200)}catch(s){clearTimeout(this.retryTimers[t]),delete this.retryTimers[t],this.scheduleNextRetry(t,e)}},scheduleNextRetry(e,t){if(this.retryAttempts[e]=(this.retryAttempts[e]||0)+1,this.retryAttempts[e]>this.maxRetryAttempts)return;const s=this.retryDelays[Math.min(this.retryAttempts[e]-1,this.retryDelays.length-1)];this.retryTimers[e]=setTimeout(async()=>{clearTimeout(this.retryTimers[e]),delete this.retryTimers[e],await this.retrySendSms(t)},s)},initAutoRetryForList(){ye["default"].isResendEnabled&&ye["default"].isResendEnabled()&&(this.requests||[]).forEach(e=>{const t=this.getRelevantSmsStatus(e);["failed","pending"].includes(t)&&(this.retryTimers[e.id]||0!==(this.retryAttempts[e.id]||0)||this.scheduleNextRetry(e.id,e))})},getRelevantSmsStatus(e){const t=e.ict_director_status||e.status;return("ict_director_approved"===t||"dict_approved"===t||"approved"===t||"head_it_approved"===t||"implemented"===t)&&e.sms_to_head_it_status||"pending"},getSmsStatusText(e){const t={sent:"Delivered",pending:"Pending",failed:"Failed"};return t[e]||"Pending"},getSmsStatusColor(e){const t={sent:"bg-green-500",pending:"bg-yellow-500",failed:"bg-red-500"};return t[e]||"bg-gray-400"},getSmsStatusTextColor(e){const t={sent:"text-green-400",pending:"text-yellow-400",failed:"text-red-400"};return t[e]||"text-gray-400"}}},we=s(1241);const _e=(0,we.A)(xe,[["render",ce],["__scopeId","data-v-5f360234"]]);var ke=_e}}]);
//# sourceMappingURL=dict.273ee851.js.map