"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[5389],{5389:function(e,s,t){t.r(s);t(4603),t(7566),t(8721);var a=t(4373),r=t(8998);const c="/api",i=a.A.create({baseURL:c,timeout:0,headers:{"Content-Type":"application/json",Accept:"application/json"}});i.interceptors.request.use(e=>{const s=localStorage.getItem("auth_token");if(s&&(e.headers.Authorization=`Bearer ${s}`),e.method&&"get"===e.method.toLowerCase())try{const s=new URL(e.url,e.baseURL);s.searchParams.set("_cb",String(Date.now())),e.url=s.pathname+s.search}catch(t){const s=(e.url||"").includes("?")?"&":"?";e.url=`${e.url}${s}_cb=${Date.now()}`}return e},e=>Promise.reject(e)),i.interceptors.response.use(e=>e,e=>{const s=e.response?.status;if(401===s&&(localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),localStorage.removeItem("session_data"),"undefined"!==typeof window)){const e=window.location.pathname||"";"/"!==e&&"/login"!==e&&(window.location.href="/")}return Promise.reject(e)});const n={async getAccessRequests(){try{r.gg.debug("ðŸ”„ IctOfficerService: Fetching access requests...");const e=await i.get("/ict-officer/access-requests");return e.data.success?(r.gg.debug("âœ… IctOfficerService: Access requests loaded successfully"),{success:!0,data:e.data.data,message:e.data.message}):(r.gg.error("âŒ IctOfficerService: Failed to load access requests:",e.data.message),{success:!1,message:e.data.message||"Failed to load access requests"})}catch(e){return r.gg.error("âŒ IctOfficerService: Error fetching access requests:",e),{success:!1,message:e.response?.data?.message||"Network error while loading access requests"}}},async getAccessRequestById(e){try{r.gg.debug("ðŸ”„ IctOfficerService: Fetching access request by ID:",e);const s=await i.get(`/ict-officer/access-requests/${e}`);return s.data.success?(r.gg.debug("âœ… IctOfficerService: Access request loaded successfully"),{success:!0,data:s.data.data,message:s.data.message}):(r.gg.error("âŒ IctOfficerService: Failed to load access request:",s.data.message),{success:!1,message:s.data.message||"Failed to load access request"})}catch(s){return r.gg.error("âŒ IctOfficerService: Error fetching access request:",s),{success:!1,message:s.response?.data?.message||"Network error while loading access request"}}},async assignTaskToSelf(e,s=""){try{r.gg.debug("ðŸ”„ IctOfficerService: Assigning task to self:",e);const t=await i.post(`/ict-officer/access-requests/${e}/assign`,{notes:s});return t.data.success?(r.gg.debug("âœ… IctOfficerService: Task assigned successfully"),{success:!0,data:t.data.data,message:t.data.message}):(r.gg.error("âŒ IctOfficerService: Failed to assign task:",t.data.message),{success:!1,message:t.data.message||"Failed to assign task"})}catch(t){return r.gg.error("âŒ IctOfficerService: Error assigning task:",t),{success:!1,message:t.response?.data?.message||"Network error while assigning task"}}},async updateProgress(e,s,t=""){try{r.gg.debug("ðŸ”„ IctOfficerService: Updating progress:",e,s);const a=await i.put(`/ict-officer/access-requests/${e}/progress`,{status:s,notes:t});return a.data.success?(r.gg.debug("âœ… IctOfficerService: Progress updated successfully"),{success:!0,data:a.data.data,message:a.data.message}):(r.gg.error("âŒ IctOfficerService: Failed to update progress:",a.data.message),{success:!1,message:a.data.message||"Failed to update progress"})}catch(a){return r.gg.error("âŒ IctOfficerService: Error updating progress:",a),{success:!1,message:a.response?.data?.message||"Network error while updating progress"}}},async updateImplementationProgress(e,s,t=""){try{r.gg.debug("ðŸ”„ IctOfficerService: Updating implementation progress:",e,s);const a={implementation_status:s,implementation_comments:t};"implementation_in_progress"===s?a.ict_officer_started_at=(new Date).toISOString():"implemented"===s&&(a.ict_officer_implemented_at=(new Date).toISOString());const c=await i.put(`/ict-officer/access-requests/${e}/implementation`,a);return c.data.success?(r.gg.debug("âœ… IctOfficerService: Implementation progress updated successfully"),{success:!0,data:c.data.data,message:c.data.message||"Implementation progress updated successfully"}):(r.gg.error("âŒ IctOfficerService: Failed to update implementation progress:",c.data.message),{success:!1,message:c.data.message||"Failed to update implementation progress"})}catch(a){return r.gg.error("âŒ IctOfficerService: Error updating implementation progress:",a),{success:!1,message:a.response?.data?.message||"Network error while updating implementation progress"}}},async cancelTask(e,s){try{r.gg.debug("ðŸ”„ IctOfficerService: Canceling task:",e);const t=await i.post(`/ict-officer/access-requests/${e}/cancel`,{reason:s});return t.data.success?(r.gg.debug("âœ… IctOfficerService: Task canceled successfully"),{success:!0,data:t.data.data,message:t.data.message}):(r.gg.error("âŒ IctOfficerService: Failed to cancel task:",t.data.message),{success:!1,message:t.data.message||"Failed to cancel task"})}catch(t){return r.gg.error("âŒ IctOfficerService: Error canceling task:",t),{success:!1,message:t.response?.data?.message||"Network error while canceling task"}}},async completeImplementation(e,s="",t=null){try{r.gg.debug("ðŸ”„ IctOfficerService: Completing implementation:",e);const a=new FormData;a.append("notes",s),t&&a.append("signature",t);const c=await i.post(`/ict-officer/access-requests/${e}/complete`,a,{headers:{"Content-Type":"multipart/form-data"}});return c.data.success?(r.gg.debug("âœ… IctOfficerService: Implementation completed successfully"),{success:!0,data:c.data.data,message:c.data.message}):(r.gg.error("âŒ IctOfficerService: Failed to complete implementation:",c.data.message),{success:!1,message:c.data.message||"Failed to complete implementation"})}catch(a){return r.gg.error("âŒ IctOfficerService: Error completing implementation:",a),{success:!1,message:a.response?.data?.message||"Network error while completing implementation"}}},async getRequestTimeline(e){try{r.gg.debug("ðŸ”„ IctOfficerService: Fetching request timeline:",e);const s=await i.get(`/ict-officer/access-requests/${e}/timeline`);if(s.data.success)return r.gg.debug("âœ… IctOfficerService: Request timeline loaded successfully"),s.data.data;throw r.gg.error("âŒ IctOfficerService: Failed to load request timeline:",s.data.message),new Error(s.data.message||"Failed to load request timeline")}catch(s){throw r.gg.error("âŒ IctOfficerService: Error fetching request timeline:",s),s.response?new Error(s.response.data?.message||"Failed to load timeline data"):new Error("Network error while loading timeline")}},async getAccessRequestTimeline(e){try{r.gg.debug("ðŸ”„ IctOfficerService: Fetching access request timeline:",e);const s=await i.get(`/ict-officer/access-requests/${e}/timeline`);return s.data.success?(r.gg.debug("âœ… IctOfficerService: Access request timeline loaded successfully"),{success:!0,data:s.data.data,message:s.data.message}):(r.gg.error("âŒ IctOfficerService: Failed to load access request timeline:",s.data.message),{success:!1,message:s.data.message||"Failed to load access request timeline"})}catch(s){return r.gg.error("âŒ IctOfficerService: Error fetching access request timeline:",s),{success:!1,message:s.response?.data?.message||"Network error while loading access request timeline"}}},async grantAccess(e,s){try{r.gg.debug("ðŸ”„ IctOfficerService: Granting access for request:",e),r.gg.debug("Grant access data:",s);const t=await i.post(`/ict-officer/access-requests/${e}/grant-access`,{comments:s.comments||"",implementation_status:"implemented",implementation_completed_at:(new Date).toISOString()});return t.data.success?(r.gg.debug("âœ… IctOfficerService: Access granted successfully"),{success:!0,data:t.data.data,message:t.data.message||"Access granted successfully"}):(r.gg.error("âŒ IctOfficerService: Failed to grant access:",t.data.message),{success:!1,message:t.data.message||"Failed to grant access"})}catch(t){return r.gg.error("âŒ IctOfficerService: Error granting access:",t),{success:!1,message:t.response?.data?.message||"Network error while granting access"}}},async getStatistics(){try{r.gg.debug("ðŸ”„ IctOfficerService: Fetching statistics...");const e=await i.get("/ict-officer/statistics");return e.data.success?(r.gg.debug("âœ… IctOfficerService: Statistics loaded successfully"),{success:!0,data:e.data.data,message:e.data.message}):(r.gg.error("âŒ IctOfficerService: Failed to load statistics:",e.data.message),{success:!1,message:e.data.message||"Failed to load statistics"})}catch(e){return r.gg.error("âŒ IctOfficerService: Error fetching statistics:",e),{success:!1,message:e.response?.data?.message||"Network error while loading statistics"}}},async getPendingRequestsCount(){try{r.gg.debug("ðŸ”„ IctOfficerService: Fetching pending requests count...");const e=await i.get("/ict-officer/pending-count");if(e.data.success)return e.data.data;throw r.gg.error("âŒ IctOfficerService: Failed to load pending count:",e.data.message),new Error(e.data.message||"Failed to load pending requests count")}catch(e){throw r.gg.error("âŒ IctOfficerService: Error fetching pending count:",e),e.response?new Error(e.response.data?.message||"Failed to load pending count"):new Error("Network error while loading pending count")}},async resendRequesterSms(e,s=null){try{r.gg.debug("ðŸ”„ IctOfficerService: Retrying requester SMS for:",{requestId:e,requesterPhone:s});const a=e=>{if(!e)return null;const s=String(e).trim(),t=s.startsWith("+"),a=s.replace(/[^\d]/g,"");return t?`+${a}`:a},c=s||null,n=a(c),o={request_id:e,role:"ict_officer",notification_type:"requester_access_granted",resend_only:!0,force:!0,force_resend:!0,resend_sms:!0,send_sms:!0,send_sms_to_requester:!0,notification_channel:"sms",requester_phone:c||void 0,requester_phone_number:c||void 0,requester_msisdn:n||void 0,staff_phone:c||void 0,staff_phone_number:c||void 0,recipient_phone:n||void 0,destination_phone:n||void 0,phone_number:n||void 0,msisdn:n||void 0,contact_phone:n||void 0};let g;const d=[`/ict-officer/access-requests/${e}/notify`,`/ict-officer/access-requests/${e}/resend-sms`,`/ict-officer/access-requests/${e}/send-notification`,`/ict-officer/access-requests/${e}/grant-access`,"/ict-officer/notify","/ict-officer/resend-sms"];let u;for(let e=0;e<d.length;e++)try{r.gg.debug(`ðŸ”„ Trying endpoint ${e+1}/${d.length}: ${d[e]}`),g=await i.post(d[e],o),r.gg.debug(`âœ… Success with endpoint: ${d[e]}`);break}catch(t){if(console.warn(`âŒ Endpoint ${d[e]} failed:`,t.response?.status,t.response?.data?.message||t.message),u=t,e===d.length-1)throw r.gg.error("ðŸš« All endpoints failed for SMS retry"),u}return g.data?.success?(r.gg.debug("âœ… IctOfficerService: Requester SMS retry triggered successfully"),{success:!0,data:g.data.data,message:g.data.message}):{success:!1,message:g.data?.message||"Failed to trigger SMS retry"}}catch(a){return r.gg.error("âŒ IctOfficerService: Error retrying requester SMS:",a),{success:!1,message:a.response?.data?.message||"Network error while retrying SMS"}}}};s["default"]=n}}]);
//# sourceMappingURL=5389.4dd38d1e.js.map