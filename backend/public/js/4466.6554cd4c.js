"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[4466],{4466:function(e,s,t){t.d(s,{d:function(){return n}});t(8111),t(2489),t(1701);var r=t(274),a=t(8998);const n={async getAllRequests(e={}){try{let t;try{t=await r.A.get("/ict-approval/device-requests",{params:{...e,per_page:e.per_page||50}}),a.gg.debug("Successfully fetched from ICT approval endpoint")}catch(s){a.gg.debug("ICT approval endpoint failed, trying booking service endpoint:",s.response?.status,s.response?.data?.message),t=await r.A.get("/booking-service/ict-approval-requests",{params:{...e,per_page:e.per_page||50}}),a.gg.debug("Successfully fetched from booking service endpoint")}const n=t.data.data?.data||t.data.data||[],o=Array.isArray(n)?n.map(e=>this.transformRequest(e)):[];return{success:!0,data:{data:o,current_page:t.data.data?.current_page||1,last_page:t.data.data?.last_page||1,per_page:t.data.data?.per_page||50,total:t.data.data?.total||o.length}}}catch(t){return a.gg.error("Failed to fetch device borrowing requests:",t),{success:!1,message:t.response?.data?.message||"Failed to fetch requests",error:t.message,status:t.response?.status}}},async getPendingRequests(e={}){return this.getAllRequests({...e,ict_status:"pending"})},async getRequestDetails(e){try{let t;a.gg.debug("üîç Fetching request details for ID:",e);let n="";try{t=await r.A.get(`/ict-approval/device-requests/${e}`),n="ict-approval/device-requests",a.gg.debug("‚úÖ Successfully fetched from ICT approval endpoint")}catch(s){a.gg.debug("‚ö†Ô∏è ICT approval endpoint failed, trying booking service endpoint:",s.response?.status),t=await r.A.get(`/booking-service/bookings/${e}`),n="booking-service/bookings",a.gg.debug("‚úÖ Successfully fetched from booking service endpoint")}const o=t.data.data||t.data;o._endpoint=n,o._source=n.includes("booking")?"booking_service":"ict_approval",a.gg.debug("üìÑ Raw request data:",o),a.gg.debug("üîç Source endpoint:",n),a.gg.debug("üîç Raw reason field:",o.reason),a.gg.debug("üîç Raw purpose field:",o.purpose),a.gg.debug("üîç Raw phone fields:",{phone_number:o.phone_number,borrower_phone:o.borrower_phone,user_phone:o.user?.phone,phoneNumber:o.phoneNumber});const i=this.isBookingRequest(o);if(a.gg.debug("üîç Request type analysis:",{requestId:o.id,isBookingRequest:i,detectedType:i?"booking":"access"}),!o)throw new Error("No request data received from API");const d=this.transformRequest(o);return a.gg.debug("üîÑ Transformed request data:",d),a.gg.debug("üîç Transformed reason field:",d.reason),a.gg.debug("üîç Transformed purpose field:",d.purpose),a.gg.debug("üîç Transformed phone field:",d.borrower_phone),a.gg.debug("üîç Final request type:",d.request_type),{success:!0,data:d}}catch(t){return a.gg.error("‚ùå Failed to fetch request details:",{requestId:e,error:t.message,status:t.response?.status,statusText:t.response?.statusText,responseData:t.response?.data}),{success:!1,message:t.response?.data?.message||t.message||"Failed to fetch request details",error:t.message,status:t.response?.status,details:{requestId:e,endpoint:t.config?.url,method:t.config?.method}}}},async approveRequest(e,s=""){try{let n;a.gg.debug("‚úÖ Approving request ID:",e,"with notes:",s);try{n=await r.A.post(`/booking-service/bookings/${e}/ict-approve`,{ict_notes:s}),a.gg.debug("‚úÖ Successfully approved via booking service endpoint")}catch(t){const o=t.response?.status;a.gg.debug("‚ö†Ô∏è Booking-service endpoint failed:",o,t.response?.data?.message);const i=!o||[404,405,501].includes(o);if(!i)throw t;n=await r.A.post(`/ict-approval/device-requests/${e}/approve`,{ict_notes:s}),a.gg.debug("‚úÖ Successfully approved via ICT approval endpoint (fallback)")}return{success:!0,data:this.transformRequest(n.data.data||n.data),message:"Device borrowing request approved successfully"}}catch(n){return a.gg.error("‚ùå Failed to approve request:",{requestId:e,error:n.message,status:n.response?.status,responseData:n.response?.data}),{success:!1,message:n.response?.data?.message||n.message||"Failed to approve request",errors:n.response?.data?.errors||{},status:n.response?.status}}},async rejectRequest(e,s){try{if(!s||""===s.trim())throw new Error("Rejection reason is required");let n;a.gg.debug("‚ùå Rejecting request ID:",e,"with notes:",s);try{n=await r.A.post(`/ict-approval/device-requests/${e}/reject`,{ict_notes:s}),a.gg.debug("‚úÖ Successfully rejected via ICT approval endpoint")}catch(t){a.gg.debug("‚ö†Ô∏è ICT approval endpoint failed, trying booking service endpoint:",t.response?.status),n=await r.A.post(`/booking-service/bookings/${e}/ict-reject`,{ict_notes:s}),a.gg.debug("‚úÖ Successfully rejected via booking service endpoint")}return{success:!0,data:this.transformRequest(n.data.data||n.data),message:"Device borrowing request rejected successfully"}}catch(n){return a.gg.error("‚ùå Failed to reject request:",{requestId:e,error:n.message,status:n.response?.status,responseData:n.response?.data}),{success:!1,message:n.response?.data?.message||n.message||"Failed to reject request",errors:n.response?.data?.errors||{},status:n.response?.status}}},async deleteRequest(e){try{a.gg.debug("üóëÔ∏è Deleting request ID:",e);try{await r.A.delete(`/ict-approval/device-requests/${e}`),a.gg.debug("‚úÖ Successfully deleted via ICT approval endpoint")}catch(s){a.gg.debug("‚ö†Ô∏è ICT approval endpoint failed, trying booking service endpoint:",s.response?.status),await r.A.delete(`/booking-service/bookings/${e}`),a.gg.debug("‚úÖ Successfully deleted via booking service endpoint")}return{success:!0,message:"Device borrowing request deleted successfully"}}catch(t){return a.gg.error("‚ùå Failed to delete request:",{requestId:e,error:t.message,status:t.response?.status,responseData:t.response?.data}),{success:!1,message:t.response?.data?.message||t.message||"Failed to delete request",errors:t.response?.data?.errors||{},status:t.response?.status}}},async bulkDeleteRequests(e){try{let t;a.gg.debug("üóëÔ∏è Bulk deleting request IDs:",e);try{t=await r.A.post("/ict-approval/device-requests/bulk-delete",{request_ids:e}),a.gg.debug("‚úÖ Successfully bulk deleted via ICT approval endpoint")}catch(s){a.gg.debug("‚ö†Ô∏è ICT approval endpoint failed, trying booking service endpoint:",s.response?.status),t=await r.A.post("/booking-service/bookings/bulk-delete",{request_ids:e}),a.gg.debug("‚úÖ Successfully bulk deleted via booking service endpoint")}return{success:!0,data:t.data.data||{},message:t.data.message||"Requests deleted successfully"}}catch(t){return a.gg.error("‚ùå Failed to bulk delete requests:",{requestIds:e,error:t.message,status:t.response?.status,responseData:t.response?.data}),{success:!1,message:t.response?.data?.message||t.message||"Failed to delete requests",errors:t.response?.data?.errors||{},status:t.response?.status}}},canDeleteRequest(e){return"pending"===e.ict_approve||"pending"===e.status||("rejected"===e.ict_approve||"approved"===e.ict_approve&&("returned"===e.return_status||"returned_but_compromised"===e.return_status))},isBookingRequest(e){const s=["phone_number","device_inventory_id","return_time","ict_approve","device_condition_issuing","booking_date"],t=s.filter(s=>Object.prototype.hasOwnProperty.call(e,s)&&null!==e[s]&&void 0!==e[s]).length,r="booking_service"===e._source||e._endpoint?.includes("booking")||e._endpoint?.includes("device-requests");return a.gg.debug("üîç Request type detection:",{requestId:e.id,hasBookingFields:t,bookingFieldsFound:s.filter(s=>Object.prototype.hasOwnProperty.call(e,s)),isFromBookingEndpoint:r,isBookingRequest:t>=3||r}),t>=3||r},getPhoneNumber(e){const s=e.user?.phone||e.phone_number||e.borrower_phone;return a.gg.debug("üìû Auto-captured phone number from users table:",{requestId:e.id,user_phone:e.user?.phone,phone_number:e.phone_number,borrower_phone:e.borrower_phone,selected:s,source:e.user?.phone?"users_table":e.phone_number?"booking_service_table":"fallback"}),s},transformRequest(e){if(!e)return null;const s=this.isBookingRequest(e),t=this.getPhoneNumber(e),r=e=>{if(!e)return null;if("object"===typeof e)return e;try{return JSON.parse(e)}catch(s){return null}},a=r(e.device_condition_issuing||e.issuing_assessment||e.assessment_issuing),n=r(e.device_condition_receiving||e.receiving_assessment||e.assessment_receiving),o="undefined"!==typeof e.has_signature?!!e.has_signature:"undefined"!==typeof e.signature?!!e.signature:!!e.signature_path;return{id:e.id,request_id:`REQ-${e.id.toString().padStart(6,"0")}`,request_type:s?"booking":"access",borrower_id:e.user_id||e.borrower_id,borrower_name:e.user?.name||e.borrower_name||"Unknown User",borrower_email:e.user?.email||e.borrower_email,borrower_phone:t,pf_number:e.user?.pf_number||e.pf_number,department_id:e.user?.department_id||e.department_id,department:e.user?.department?.name||e.departmentInfo?.name||e.department||"Unknown Department",device_type:e.device_type,custom_device:e.custom_device,device_name:Array.isArray(e.all_device_names)&&e.all_device_names.length?e.all_device_names.join(" & "):this.getDeviceDisplayName(e.device_type,e.custom_device,e.device_inventory_ids),device_inventory_id:e.device_inventory_id,device_inventory_ids:e.device_inventory_ids||[],all_device_names:Array.isArray(e.all_device_names)?e.all_device_names:[],device_available:"undefined"!==typeof e.device_available?e.device_available:null,booking_date:e.booking_date,return_date:e.return_date,return_time:e.return_time,return_date_time:e.return_date_time,reason:e.reason||e.purpose,purpose:e.purpose||e.reason,signature_path:e.signature_path,signature_url:e.signature_url,has_signature:o,status:e.status||"pending",ict_approve:e.ict_approve||"pending",ict_approved_at:e.ict_approved_at,ict_notes:e.ict_notes,ict_approved_by:e.ict_approved_by,sms_to_requester_status:e.sms_to_requester_status,sms_to_hod_status:e.sms_to_hod_status,sms_sent_to_requester_at:e.sms_sent_to_requester_at,sms_status:e.sms_status||e.sms_to_requester_status||e.sms_to_hod_status||"pending",return_status:e.return_status||"not_yet_returned",device_issued_at:e.device_issued_at,device_received_at:e.device_received_at,device_condition_issuing:a,device_condition_receiving:n,admin_approved_by:e.approved_by,admin_approved_at:e.approved_at,admin_notes:e.admin_notes,created_at:e.created_at,updated_at:e.updated_at,_raw:e}},getDeviceDisplayName(e,s,t=[]){let r;if("others"===e&&s)r=s;else{const s={projector:"Projector",tv_remote:"TV Remote",hdmi_cable:"HDMI Cable",monitor:"Monitor",cpu:"CPU",keyboard:"Keyboard",pc:"PC",others:"Others"};r=s[e]||e||"Unknown Device"}const a=Array.isArray(t)?t.filter(Boolean):[];if(a.length>1){const e=a.length-1;return`${r} + ${e} more device${e>1?"s":""}`}return r},formatDate(e){if(!e)return"N/A";try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(s){return e}},formatDateTime(e){if(!e)return"N/A";try{return new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(s){return e}},getStatusBadgeClass(e){const s={pending:"bg-yellow-100 text-yellow-800 border-yellow-200",approved:"bg-green-100 text-green-800 border-green-200",rejected:"bg-red-100 text-red-800 border-red-200"};return s[e]||s.pending},getStatusIcon(e){const s={pending:"fas fa-clock",approved:"fas fa-check-circle",rejected:"fas fa-times-circle"};return s[e]||s.pending},getStatusText(e){const s={pending:"Pending",approved:"Approved",rejected:"Rejected"};return s[e]||e||"Unknown"},getReturnStatusBadgeClass(e){const s={not_yet_returned:"bg-blue-100 text-blue-800 border-blue-200",returned:"bg-green-100 text-green-800 border-green-200",returned_but_compromised:"bg-red-100 text-red-800 border-red-200",out_of_stock:"bg-yellow-100 text-yellow-800 border-yellow-200",received:"bg-green-100 text-green-800 border-green-200",received_compromised:"bg-red-100 text-red-800 border-red-200"};return s[e]||s.not_yet_returned},getReturnStatusIcon(e){const s={not_yet_returned:"fas fa-hourglass-half",returned:"fas fa-check-circle",returned_but_compromised:"fas fa-exclamation-triangle"};return s[e]||s.not_yet_returned},getReturnStatusText(e){const s={not_yet_returned:"Not Returned",returned:"Returned",returned_but_compromised:"Compromised",received:"Received",received_compromised:"Received (Compromised)"};return s[e]||e||"Unknown"},async saveIssuingAssessment(e,s){try{let n;a.gg.debug("üíæ Saving issuing assessment for request ID:",e,s);try{n=await r.A.post(`/ict-approval/device-requests/${e}/assessment/issuing`,s),a.gg.debug("‚úÖ Successfully saved via ICT approval endpoint")}catch(t){const o=t.response?.status;a.gg.debug("‚ö†Ô∏è ICT approval endpoint failed:",o,t.response?.data?.message);const i=!o||[404,405,501].includes(o);if(!i)throw t;a.gg.debug("‚Ü©Ô∏è Falling back to booking-service endpoint..."),n=await r.A.post(`/booking-service/bookings/${e}/assessment/issuing`,s),a.gg.debug("‚úÖ Successfully saved via booking service endpoint")}return{success:!0,data:this.transformRequest(n.data.data||n.data),message:n.data.message||"Device issued and condition assessment saved successfully"}}catch(n){return a.gg.error("‚ùå Failed to save issuing assessment:",{requestId:e,error:n.message,status:n.response?.status,responseData:n.response?.data}),{success:!1,message:n.response?.data?.message||n.message||"Failed to save assessment",errors:n.response?.data?.errors||{},status:n.response?.status}}},async saveReceivingAssessment(e,s){try{let n;a.gg.debug("üì• Saving receiving assessment for request ID:",e,s);try{n=await r.A.post(`/ict-approval/device-requests/${e}/assessment/receiving`,s),a.gg.debug("‚úÖ Successfully saved via ICT approval endpoint")}catch(t){const o=t.response?.status;a.gg.debug("‚ö†Ô∏è ICT approval endpoint failed:",o,t.response?.data?.message);const i=!o||[404,405,501].includes(o);if(!i)throw t;a.gg.debug("‚Ü©Ô∏è Falling back to booking-service endpoint..."),n=await r.A.post(`/booking-service/bookings/${e}/assessment/receiving`,s),a.gg.debug("‚úÖ Successfully saved via booking service endpoint")}return{success:!0,data:this.transformRequest(n.data.data||n.data),message:n.data.message||"Device received and assessment completed successfully"}}catch(n){return a.gg.error("‚ùå Failed to save receiving assessment:",{requestId:e,error:n.message,status:n.response?.status,responseData:n.response?.data}),{success:!1,message:n.response?.data?.message||n.message||"Failed to save assessment",errors:n.response?.data?.errors||{},status:n.response?.status}}}};s.A=n}}]);
//# sourceMappingURL=4466.6554cd4c.js.map