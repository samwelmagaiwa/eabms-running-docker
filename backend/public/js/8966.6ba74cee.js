"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[8966],{1127:function(e,t,s){s.d(t,{h:function(){return n}});s(4114);var a=s(5796),o=s(1387),r=s(14),i=s(9553);function n(){const e=(0,o.rd)(),t=(0,r.useAuthStore)(),n=(0,a.EW)(()=>t.user),l=(0,a.EW)(()=>t.token),d=(0,a.EW)(()=>t.isAuthenticated),u=(0,a.EW)(()=>t.userPermissions),c=(0,a.EW)(()=>t.userRole),p=(0,a.EW)(()=>t.userRoles),g=(0,a.EW)(()=>t.isLoading),m=(0,a.EW)(()=>t.error),h=(0,a.EW)(()=>t.isAdmin),f=(0,a.EW)(()=>t.isStaff),v=(0,a.EW)(()=>t.isApprover),b=(0,a.EW)(()=>n.value?.name||"User"),w=async a=>{try{const{authService:o}=await s.e(981).then(s.bind(s,981)),r=await o.login(a);if(r.success){const{user:s,token:a}=r.data;t.setAuthData({user:s,token:a});let o=(0,i.getDefaultDashboard)(t.userRole)||"/user-dashboard";s?.needs_onboarding&&"admin"!==t.userRole&&(o="/onboarding");const n=e.currentRoute.value.query.redirect;return n&&"string"===typeof n&&(o=n),await e.push(o),{success:!0,user:s}}{let e=r.message||"Login failed";if(r.errors&&"object"===typeof r.errors){const t=["email","password"];for(const s of t){const t=r.errors[s];if(Array.isArray(t)&&t.length>0){e=t[0];break}}}return console.error("❌ Login failed:",e),t.setError(e),{success:!1,message:e}}}catch(m){return console.error("❌ Login error in composable:",m),t.setError(m.message||"Login failed"),{success:!1,message:m.message||"Login failed"}}},y=async()=>{try{const{authService:a}=await s.e(981).then(s.bind(s,981));return await a.logout(),t.clearAuth(),await e.push("/login"),{success:!0}}catch(m){return t.clearAuth(),await e.push("/login"),{success:!0}}},C=async()=>{try{const{authService:a}=await s.e(981).then(s.bind(s,981)),o=await a.logoutAll();return t.clearAuth(),await e.push("/login"),o.success?o:{success:!0}}catch(m){return t.clearAuth(),await e.push("/login"),{success:!0}}},k=e=>{t.updateUser(e)},x=()=>{t.clearError()},I=e=>t.hasPermission(e),E=e=>t.hasRole(e),L=e=>!e.meta?.roles||E(e.meta.roles),S=e=>{if(!E(e)){const t=Array.isArray(e)?e.join(", "):e;throw new Error(`Access denied. Required role(s): ${t}`)}},_=e=>{if(!e)return"User";const t={[i.gg.ADMIN]:"Administrator",[i.gg.DIVISIONAL_DIRECTOR]:"Divisional Director",[i.gg.HEAD_OF_DEPARTMENT]:"Head of Department",[i.gg.ICT_DIRECTOR]:"ICT Director",[i.gg.HEAD_OF_IT]:"Head of IT",[i.gg.STAFF]:"D. IN MEDICINE",[i.gg.ICT_OFFICER]:"ICT Officer",[i.gg.SECRETARY_ICT]:"Secretary ICT"};return t[e]||e};return{user:n,userName:b,token:l,isAuthenticated:d,userPermissions:u,userRole:c,userRoles:p,isLoading:g,error:m,isAdmin:h,isStaff:f,isApprover:v,login:w,logout:y,logoutAll:C,updateUser:k,clearError:x,hasPermission:I,hasRole:E,canAccessRoute:L,requireRole:S,getRoleDisplayName:_,ROLES:i.gg}}},6358:function(e,t,s){s.d(t,{a:function(){return o}});class a{constructor(){this.isLoggingOut=!1,this.logoutPromise=null,this.lastLogoutTime=0,this.cooldownPeriod=2e3}async executeLogout(e){const t=Date.now();return t-this.lastLogoutTime<this.cooldownPeriod?{success:!0,message:"Logout in cooldown period"}:(this.isLoggingOut&&this.logoutPromise||(this.isLoggingOut=!0,this.lastLogoutTime=t,this.logoutPromise=this.performLogout(e)),this.logoutPromise)}async performLogout(e){try{const t=await e();return t}catch(t){throw console.error("❌ Logout failed:",t),t}finally{setTimeout(()=>{this.isLoggingOut=!1,this.logoutPromise=null},1e3)}}reset(){this.isLoggingOut=!1,this.logoutPromise=null,this.lastLogoutTime=0}get isInProgress(){return this.isLoggingOut}}const o=new a},8966:function(e,t,s){s.d(t,{A:function(){return Se}});var a=s(5796);const o=["aria-hidden"],r={class:"relative z-10 flex flex-col h-full"},i={class:"mb-6 px-4 pt-4"},n={class:"flex items-center justify-between mb-4"},l=["aria-label"],d={class:"relative w-6 h-6"},u={class:"transition-all duration-500 ease-in-out"},c={key:0,class:"profile-expanded opacity-100 transform translate-y-0 transition-all duration-500 ease-out"},p={class:"flex items-center space-x-3 p-3 rounded-xl bg-blue-600/60 border border-blue-500/40 backdrop-blur-sm hover:bg-blue-600/80 transition-all duration-300 group cursor-pointer"},g={class:"relative"},m={class:"w-14 h-14 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center shadow-lg border-2 border-white/20 group-hover:scale-110 transition-transform duration-300 relative overflow-hidden"},h=["src"],f={key:1,class:"text-white font-bold text-lg relative z-10 drop-shadow-lg"},v={class:"flex-1 min-w-0"},b={class:"text-white font-bold responsive-profile-name truncate group-hover:text-orange-100 transition-colors duration-300 text-sm"},w={class:"text-blue-100 responsive-profile-role truncate opacity-80 group-hover:opacity-100 transition-opacity duration-300 text-xs"},y={key:1,class:"profile-collapsed opacity-100 transform translate-y-0 transition-all duration-500 ease-out flex justify-center"},C={class:"relative group cursor-pointer"},k={class:"w-12 h-12 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center shadow-lg border-2 border-white/20 group-hover:scale-110 transition-transform duration-300 relative overflow-hidden"},x=["src"],I={key:1,class:"text-white font-bold responsive-profile-name relative z-10 drop-shadow-lg"},E={class:"flex-1 min-h-0 space-y-1 overflow-y-auto custom-scrollbar px-4"},L={key:0,class:"mb-2"},S=["title"],_={key:0,class:"truncate uppercase tracking-wide"},D=["title"],A={key:2,class:"absolute right-2 w-2 h-2 bg-blue-600 rounded-full shadow-sm active-indicator"},R={key:1,class:"mb-2"},N={key:0,class:"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full min-w-[1rem] h-4 flex items-center justify-center px-1 shadow-lg border border-white notification-badge animate-pulse"},T={key:0,class:"truncate uppercase tracking-wide"},O={key:1,class:"absolute right-3 top-1/2 transform -translate-y-1/2 bg-red-500 text-white text-xs font-bold rounded-full min-w-[1.25rem] h-5 flex items-center justify-center px-1 shadow-lg border-2 border-white notification-badge animate-pulse"},q={key:2,class:"absolute right-2 w-2 h-2 bg-blue-600 rounded-full shadow-sm active-indicator"},M={key:2,class:"mb-2"},H={key:0,class:"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full min-w-[1rem] h-4 flex items-center justify-center px-1 shadow-lg border border-white notification-badge animate-pulse"},j={key:0,class:"truncate uppercase tracking-wide"},X={key:1,class:"absolute right-3 top-1/2 transform -translate-y-1/2 bg-red-500 text-white text-xs font-bold rounded-full min-w-[1.25rem] h-5 flex items-center justify-center px-1 shadow-lg border-2 border-white notification-badge animate-pulse"},F={key:2,class:"absolute right-2 w-2 h-2 bg-blue-600 rounded-full shadow-sm active-indicator"},U={key:3,class:"mb-2"},W={key:0,class:"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full min-w-[1rem] h-4 flex items-center justify-center px-1 shadow-lg border border-white notification-badge animate-pulse"},P={key:0,class:"truncate uppercase tracking-wide"},z={key:1,class:"absolute right-3 top-1/2 transform -translate-y-1/2 bg-red-500 text-white text-xs font-bold rounded-full min-w-[1.25rem] h-5 flex items-center justify-center px-1 shadow-lg border-2 border-white notification-badge animate-pulse"},Q={key:2,class:"absolute right-2 w-2 h-2 bg-blue-600 rounded-full shadow-sm active-indicator"},J={class:"bottom-section space-y-3 pt-4 pb-4 px-4 border-t border-blue-400/30",style:{"flex-shrink":"0","margin-top":"auto"}},B={key:0,class:"truncate uppercase tracking-wide responsive-bottom-section"},K={key:0,class:"truncate uppercase tracking-wide responsive-bottom-section"},G={class:"p-6"},V={class:"space-y-4"},Y={class:"rounded-lg shadow-sm border bg-blue-50 border-blue-100"},$={class:"w-8 h-8 rounded-lg bg-white/80 border border-blue-100 flex items-center justify-center"},Z={key:0,class:"px-4 pb-4"},ee={class:"bg-white rounded-xl border border-blue-100 p-4"},te={class:"text-xs text-gray-500 mb-2"},se={class:"font-medium"},ae={class:"space-y-3"},oe={class:"text-sm font-semibold text-gray-800 mb-1"},re={class:"list-disc pl-5 text-sm text-gray-700 space-y-1"},ie={class:"mt-6"};function ne(e,t,s,ne,le,de){const ue=(0,a.g2)("router-link"),ce=(0,a.gN)("tooltip");return(0,a.uX)(),(0,a.CE)("aside",{class:(0,a.C4)(["h-full flex flex-col transition-all duration-300 ease-in-out overflow-hidden relative shadow-2xl sidebar-responsive",[ne.isCollapsed?"w-16 sidebar-collapsed":"sidebar-expanded",ne.shouldShowSidebar?"opacity-100":"invisible pointer-events-none opacity-0"]]),style:(0,a.Tr)([ne.isCollapsed?"":"width: 16rem;",{background:"linear-gradient(\n        135deg,\n        #1e3a8a 0%,\n        #1e40af 25%,\n        #1d4ed8 50%,\n        #1e40af 75%,\n        #1e3a8a 100%\n      )","box-shadow":"0 25px 50px -12px rgba(0, 0, 0, 0.25),\n        0 0 0 1px rgba(255, 255, 255, 0.1)","border-right":"1px solid rgba(59, 130, 246, 0.4)"}]),"aria-label":"Sidebar navigation","aria-hidden":!ne.shouldShowSidebar},[t[37]||(t[37]=(0,a.Lk)("div",{class:"absolute inset-0"},[(0,a.Lk)("div",{class:"absolute inset-0 bg-gradient-to-br from-blue-900/20 via-transparent to-blue-800/30 rounded-2xl m-1"}),(0,a.Lk)("div",{class:"absolute inset-0 border-2 border-dashed border-blue-300/20 rounded-2xl m-2"}),(0,a.Lk)("div",{class:"absolute inset-0 bg-gradient-to-t from-transparent via-blue-400/5 to-blue-300/10 rounded-2xl m-3"})],-1)),(0,a.Lk)("div",r,[(0,a.Lk)("div",i,[(0,a.Lk)("div",n,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>ne.toggleCollapse&&ne.toggleCollapse(...e)),class:"menu-toggle-btn p-2 rounded-lg transition-all duration-300 hover:bg-blue-600/60 text-white group relative overflow-hidden","aria-label":ne.isCollapsed?"Expand sidebar":"Collapse sidebar"},[(0,a.Lk)("div",d,[(0,a.Lk)("span",{class:(0,a.C4)(["absolute left-0 top-1 w-6 h-0.5 bg-white rounded-full transition-all duration-300 transform origin-center",{"rotate-45 translate-y-2":ne.isCollapsed,"rotate-0 translate-y-0":!ne.isCollapsed}])},null,2),(0,a.Lk)("span",{class:(0,a.C4)(["absolute left-0 top-3 w-6 h-0.5 bg-white rounded-full transition-all duration-300",{"opacity-0 scale-0":ne.isCollapsed,"opacity-100 scale-100":!ne.isCollapsed}])},null,2),(0,a.Lk)("span",{class:(0,a.C4)(["absolute left-0 top-5 w-6 h-0.5 bg-white rounded-full transition-all duration-300 transform origin-center",{"-rotate-45 -translate-y-2":ne.isCollapsed,"rotate-0 translate-y-0":!ne.isCollapsed}])},null,2)]),t[11]||(t[11]=(0,a.Lk)("div",{class:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"},null,-1))],8,l),(0,a.Lk)("div",{class:(0,a.C4)(["transition-all duration-300 ease-in-out overflow-hidden",{"w-0 opacity-0":ne.isCollapsed,"w-auto opacity-100":!ne.isCollapsed}])},[...t[12]||(t[12]=[(0,a.Lk)("div",{class:"flex items-center space-x-2"},[(0,a.Lk)("div",{class:"w-8 h-8 bg-gradient-to-br from-blue-500/30 to-blue-600/30 rounded-lg backdrop-blur-sm border border-blue-400/50 flex items-center justify-center shadow-lg"},[(0,a.Lk)("i",{class:"fas fa-hospital text-white text-sm"})]),(0,a.Lk)("span",{class:"text-white font-bold responsive-brand-text tracking-wide"},"MNH")],-1)])],2)]),(0,a.Lk)("div",u,[ne.isCollapsed?((0,a.uX)(),(0,a.CE)("div",y,[(0,a.Lk)("div",C,[(0,a.Lk)("div",k,[t[17]||(t[17]=(0,a.Lk)("div",{class:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent"},null,-1)),ne.currentUser?.value?.profile_photo_url||ne.piniaAuthStore?.user?.profile_photo_url?((0,a.uX)(),(0,a.CE)("img",{key:0,src:ne.currentUser?.value?.profile_photo_url||ne.piniaAuthStore?.user?.profile_photo_url,alt:"Profile photo",class:"w-full h-full object-cover rounded-full relative z-10"},null,8,x)):((0,a.uX)(),(0,a.CE)("span",I,(0,a.v_)(ne.userInitials),1)),t[18]||(t[18]=(0,a.Lk)("div",{class:"absolute bottom-0 right-0 w-2 h-2 bg-green-400 rounded-full border border-white shadow-sm animate-pulse"},null,-1))]),t[19]||(t[19]=(0,a.Lk)("div",{class:"absolute inset-0 bg-orange-500/20 rounded-full blur-md opacity-0 group-hover:opacity-100 transition-opacity duration-300 -z-10"},null,-1))])])):((0,a.uX)(),(0,a.CE)("div",c,[(0,a.Lk)("div",p,[(0,a.Lk)("div",g,[(0,a.Lk)("div",m,[t[13]||(t[13]=(0,a.Lk)("div",{class:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent"},null,-1)),ne.currentUser?.value?.profile_photo_url||ne.piniaAuthStore?.user?.profile_photo_url?((0,a.uX)(),(0,a.CE)("img",{key:0,src:ne.currentUser?.value?.profile_photo_url||ne.piniaAuthStore?.user?.profile_photo_url,alt:"Profile photo",class:"w-full h-full object-cover rounded-full relative z-10"},null,8,h)):((0,a.uX)(),(0,a.CE)("span",f,(0,a.v_)(ne.userInitials),1)),t[14]||(t[14]=(0,a.Lk)("div",{class:"absolute bottom-0 right-0 w-3 h-3 bg-green-400 rounded-full border-2 border-white shadow-sm animate-pulse"},null,-1))]),t[15]||(t[15]=(0,a.Lk)("div",{class:"absolute inset-0 bg-orange-500/20 rounded-full blur-md opacity-0 group-hover:opacity-100 transition-opacity duration-300 -z-10"},null,-1))]),(0,a.Lk)("div",v,[(0,a.Lk)("h3",b,(0,a.v_)(ne.userName||"JOHN DOE"),1),(0,a.Lk)("p",w,(0,a.v_)(ne.userDepartmentOrRole),1)]),t[16]||(t[16]=(0,a.Lk)("div",{class:"w-5 h-5 text-blue-200 group-hover:text-white transition-colors duration-300"},[(0,a.Lk)("svg",{class:"w-full h-full",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})])],-1))])]))])]),(0,a.Lk)("nav",E,[ne.filteredDashboardItems.length>0?((0,a.uX)(),(0,a.CE)("div",L,[ne.isCollapsed?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",{key:0,class:"flex items-center justify-between px-4 py-2 responsive-section-header font-bold text-blue-200 uppercase tracking-wider cursor-pointer hover:text-white transition-colors duration-200 section-header text-xs",onClick:t[1]||(t[1]=e=>ne.toggleSectionLocal("dashboard"))},[t[21]||(t[21]=(0,a.Lk)("span",null,"Dashboard",-1)),((0,a.uX)(),(0,a.CE)("svg",{class:(0,a.C4)(["w-4 h-4 transition-transform duration-200",{"rotate-180":!ne.expandedSections.dashboard}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[20]||(t[20]=[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])),(0,a.Lk)("div",{class:(0,a.C4)(["space-y-1 transition-all duration-300 ease-in-out overflow-hidden",{"max-h-0 opacity-0":!ne.isCollapsed&&!ne.expandedSections.dashboard&&!ne.debugHeadOfIt,"max-h-96 opacity-100":ne.isCollapsed||ne.expandedSections.dashboard||ne.debugHeadOfIt}]),style:(0,a.Tr)({maxHeight:ne.isCollapsed||ne.expandedSections.dashboard||ne.debugHeadOfIt?"24rem":"0",opacity:ne.isCollapsed||ne.expandedSections.dashboard||ne.debugHeadOfIt?"1":"0"})},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ne.filteredDashboardItems,e=>(0,a.bo)(((0,a.uX)(),(0,a.Wv)(ue,{key:e.path,to:e.path,class:(0,a.C4)(["group flex items-center px-4 py-3 responsive-nav-item font-medium rounded-lg transition-all duration-200 relative ml-2 shadow-sm nav-item text-xs",[ne.route.path===e.path?"bg-white text-blue-600 shadow-lg transform scale-105":"text-white hover:bg-blue-600/60 hover:text-white hover:shadow-md hover:transform hover:scale-102",ne.isCollapsed?"justify-center ml-0":""]])},{default:(0,a.k6)(()=>[(0,a.Lk)("div",{class:(0,a.C4)(["flex items-center justify-center responsive-icon-small transition-colors duration-200 relative",ne.isCollapsed?"":"mr-3"])},[(0,a.Lk)("i",{class:(0,a.C4)([e.icon,"text-current"])},null,2),ne.getNotificationCount(e.path)>0&&ne.isCollapsed?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full min-w-[1rem] h-4 flex items-center justify-center px-1 shadow-lg border border-white notification-badge animate-pulse",style:{"z-index":"999 !important"},title:`Debug: ${ne.getNotificationCount(e.path)} notifications for ${e.path}`},(0,a.v_)(ne.getNotificationCount(e.path)),9,S)):(0,a.Q3)("",!0)],2),ne.isCollapsed?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("span",_,(0,a.v_)(e.displayName.toUpperCase()),1)),ne.getNotificationCount(e.path)>0&&!ne.isCollapsed?((0,a.uX)(),(0,a.CE)("div",{key:1,class:"absolute right-3 top-1/2 transform -translate-y-1/2 bg-red-500 text-white text-xs font-bold rounded-full min-w-[1.25rem] h-5 flex items-center justify-center px-1 shadow-lg border-2 border-white notification-badge animate-pulse",style:{"z-index":"999 !important"},title:`Debug: ${ne.getNotificationCount(e.path)} notifications for ${e.path}`},(0,a.v_)(ne.getNotificationCount(e.path)),9,D)):(0,a.Q3)("",!0),ne.route.path!==e.path||ne.isCollapsed||0!==ne.getNotificationCount(e.path)?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",A))]),_:2},1032,["to","class"])),[[ce,ne.isCollapsed?e.displayName:""]])),128))],6)])):(0,a.Q3)("",!0),ne.filteredUserManagementItems.length>0?((0,a.uX)(),(0,a.CE)("div",R,[ne.isCollapsed?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",{key:0,class:"flex items-center justify-between px-4 py-2 responsive-section-header font-bold text-blue-200 uppercase tracking-wider cursor-pointer hover:text-white transition-colors duration-200 section-header text-xs",onClick:t[2]||(t[2]=e=>ne.toggleSectionLocal("userManagement"))},[t[23]||(t[23]=(0,a.Lk)("span",null,"User Management",-1)),((0,a.uX)(),(0,a.CE)("svg",{class:(0,a.C4)(["w-4 h-4 transition-transform duration-200",{"rotate-180":!ne.expandedSections.userManagement}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[22]||(t[22]=[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])),(0,a.Lk)("div",{class:(0,a.C4)(["space-y-1 transition-all duration-300 ease-in-out overflow-hidden",{"max-h-0 opacity-0":!ne.isCollapsed&&!ne.expandedSections.userManagement,"max-h-96 opacity-100":ne.isCollapsed||ne.expandedSections.userManagement}]),style:(0,a.Tr)({maxHeight:ne.isCollapsed||ne.expandedSections.userManagement?"24rem":"0",opacity:ne.isCollapsed||ne.expandedSections.userManagement?"1":"0"})},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ne.filteredUserManagementItems,e=>(0,a.bo)(((0,a.uX)(),(0,a.Wv)(ue,{key:e.path,to:e.path,class:(0,a.C4)(["group flex items-center px-4 py-3 responsive-nav-item font-medium rounded-lg transition-all duration-200 relative ml-2 shadow-sm nav-item text-xs",[ne.route.path===e.path?"bg-white text-blue-600 shadow-lg transform scale-105":"text-white hover:bg-blue-600/60 hover:text-white hover:shadow-md hover:transform hover:scale-102",ne.isCollapsed?"justify-center ml-0":""]])},{default:(0,a.k6)(()=>[(0,a.Lk)("div",{class:(0,a.C4)(["flex items-center justify-center responsive-icon-small transition-colors duration-200 relative",ne.isCollapsed?"":"mr-3"])},[(0,a.Lk)("i",{class:(0,a.C4)([e.icon,"text-current"])},null,2),ne.getNotificationCount(e.path)>0&&ne.isCollapsed?((0,a.uX)(),(0,a.CE)("div",N,(0,a.v_)(ne.getNotificationCount(e.path)),1)):(0,a.Q3)("",!0)],2),ne.isCollapsed?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("span",T,(0,a.v_)(e.displayName.toUpperCase()),1)),ne.getNotificationCount(e.path)>0&&!ne.isCollapsed?((0,a.uX)(),(0,a.CE)("div",O,(0,a.v_)(ne.getNotificationCount(e.path)),1)):(0,a.Q3)("",!0),ne.route.path!==e.path||ne.isCollapsed||0!==ne.getNotificationCount(e.path)?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",q))]),_:2},1032,["to","class"])),[[ce,ne.isCollapsed?e.displayName:""]])),128))],6)])):(0,a.Q3)("",!0),ne.filteredRequestsManagementItems.length>0?((0,a.uX)(),(0,a.CE)("div",M,[ne.isCollapsed?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",{key:0,class:"flex items-center justify-between px-4 py-2 responsive-section-header font-bold text-blue-200 uppercase tracking-wider cursor-pointer hover:text-white transition-colors duration-200 section-header text-xs",onClick:t[3]||(t[3]=e=>ne.toggleSectionLocal("requestsManagement"))},[t[25]||(t[25]=(0,a.Lk)("span",null,"Requests",-1)),((0,a.uX)(),(0,a.CE)("svg",{class:(0,a.C4)(["w-4 h-4 transition-transform duration-200",{"rotate-180":!ne.expandedSections.requestsManagement}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[24]||(t[24]=[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])),(0,a.Lk)("div",{class:(0,a.C4)(["space-y-1 transition-all duration-300 ease-in-out overflow-hidden",{"max-h-0 opacity-0":!ne.isCollapsed&&!ne.expandedSections.requestsManagement&&!ne.debugHeadOfIt,"max-h-96 opacity-100":ne.isCollapsed||ne.expandedSections.requestsManagement||ne.debugHeadOfIt}]),style:(0,a.Tr)({maxHeight:ne.isCollapsed||ne.expandedSections.requestsManagement||ne.debugHeadOfIt?"24rem":"0",opacity:ne.isCollapsed||ne.expandedSections.requestsManagement||ne.debugHeadOfIt?"1":"0"})},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ne.filteredRequestsManagementItems,e=>(0,a.bo)(((0,a.uX)(),(0,a.Wv)(ue,{key:e.path,to:e.path,class:(0,a.C4)(["group flex items-center px-4 py-3 responsive-nav-item font-medium rounded-lg transition-all duration-200 relative ml-2 shadow-sm nav-item text-xs",[ne.route.path===e.path?"bg-white text-blue-600 shadow-lg transform scale-105":"text-white hover:bg-blue-600/60 hover:text-white hover:shadow-md hover:transform hover:scale-102",ne.isCollapsed?"justify-center ml-0":""]])},{default:(0,a.k6)(()=>[(0,a.Lk)("div",{class:(0,a.C4)(["flex items-center justify-center responsive-icon-small transition-colors duration-200 relative",ne.isCollapsed?"":"mr-3"])},[(0,a.Lk)("i",{class:(0,a.C4)([e.icon,"text-current"])},null,2),ne.getNotificationCount(e.path)>0&&ne.isCollapsed?((0,a.uX)(),(0,a.CE)("div",H,(0,a.v_)(ne.getNotificationCount(e.path)),1)):(0,a.Q3)("",!0)],2),ne.isCollapsed?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("span",j,(0,a.v_)(e.displayName.toUpperCase()),1)),ne.getNotificationCount(e.path)>0&&!ne.isCollapsed?((0,a.uX)(),(0,a.CE)("div",X,(0,a.v_)(ne.getNotificationCount(e.path)),1)):(0,a.Q3)("",!0),ne.route.path!==e.path||ne.isCollapsed||0!==ne.getNotificationCount(e.path)?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",F))]),_:2},1032,["to","class"])),[[ce,ne.isCollapsed?e.displayName:""]])),128))],6)])):(0,a.Q3)("",!0),ne.filteredDeviceManagementItems.length>0?((0,a.uX)(),(0,a.CE)("div",U,[ne.isCollapsed?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",{key:0,class:"flex items-center justify-between px-4 py-2 responsive-section-header font-bold text-blue-200 uppercase tracking-wider cursor-pointer hover:text-white transition-colors duration-200 section-header text-xs",onClick:t[4]||(t[4]=e=>ne.toggleSectionLocal("deviceManagement"))},[t[27]||(t[27]=(0,a.Lk)("span",null,"Device Management",-1)),((0,a.uX)(),(0,a.CE)("svg",{class:(0,a.C4)(["w-4 h-4 transition-transform duration-200",{"rotate-180":!ne.expandedSections.deviceManagement}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[26]||(t[26]=[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])),(0,a.Lk)("div",{class:(0,a.C4)(["space-y-1 transition-all duration-300 ease-in-out overflow-hidden",{"max-h-0 opacity-0":!ne.isCollapsed&&!ne.expandedSections.deviceManagement,"max-h-96 opacity-100":ne.isCollapsed||ne.expandedSections.deviceManagement}]),style:(0,a.Tr)({maxHeight:ne.isCollapsed||ne.expandedSections.deviceManagement?"24rem":"0",opacity:ne.isCollapsed||ne.expandedSections.deviceManagement?"1":"0"})},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ne.filteredDeviceManagementItems,e=>(0,a.bo)(((0,a.uX)(),(0,a.Wv)(ue,{key:e.path,to:e.path,class:(0,a.C4)(["group flex items-center px-4 py-3 responsive-nav-item font-medium rounded-lg transition-all duration-200 relative ml-2 shadow-sm nav-item text-xs",[ne.route.path===e.path?"bg-white text-blue-600 shadow-lg transform scale-105":"text-white hover:bg-blue-600/60 hover:text-white hover:shadow-md hover:transform hover:scale-102",ne.isCollapsed?"justify-center ml-0":""]])},{default:(0,a.k6)(()=>[(0,a.Lk)("div",{class:(0,a.C4)(["flex items-center justify-center responsive-icon-small transition-colors duration-200 relative",ne.isCollapsed?"":"mr-3"])},[(0,a.Lk)("i",{class:(0,a.C4)([e.icon,"text-current"])},null,2),ne.getNotificationCount(e.path)>0&&ne.isCollapsed?((0,a.uX)(),(0,a.CE)("div",W,(0,a.v_)(ne.getNotificationCount(e.path)),1)):(0,a.Q3)("",!0)],2),ne.isCollapsed?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("span",P,(0,a.v_)(e.displayName.toUpperCase()),1)),ne.getNotificationCount(e.path)>0&&!ne.isCollapsed?((0,a.uX)(),(0,a.CE)("div",z,(0,a.v_)(ne.getNotificationCount(e.path)),1)):(0,a.Q3)("",!0),ne.route.path!==e.path||ne.isCollapsed||0!==ne.getNotificationCount(e.path)?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",Q))]),_:2},1032,["to","class"])),[[ce,ne.isCollapsed?e.displayName:""]])),128))],6)])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",J,[(0,a.bo)(((0,a.uX)(),(0,a.CE)("button",{onClick:t[5]||(t[5]=(...e)=>ne.showHelp&&ne.showHelp(...e)),class:(0,a.C4)(["w-full flex items-center px-4 py-3 responsive-bottom-section font-medium rounded-lg transition-all duration-200 text-white hover:bg-blue-600/60",ne.isCollapsed?"justify-center":""])},[(0,a.Lk)("div",{class:(0,a.C4)(["flex items-center justify-center responsive-icon-small transition-colors duration-200",ne.isCollapsed?"":"mr-3"])},[...t[28]||(t[28]=[(0,a.Lk)("svg",{class:"responsive-icon-small text-current",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],2),ne.isCollapsed?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("span",B,"HELP CENTER"))],2)),[[ce,ne.isCollapsed?"Help Center":""]]),(0,a.bo)(((0,a.uX)(),(0,a.CE)("button",{onClick:t[6]||(t[6]=(...e)=>ne.handleLogout&&ne.handleLogout(...e)),class:(0,a.C4)(["w-full flex items-center px-4 py-3 responsive-bottom-section font-medium rounded-lg transition-all duration-200 text-white hover:bg-blue-600/60",ne.isCollapsed?"justify-center":""])},[(0,a.Lk)("div",{class:(0,a.C4)(["flex items-center justify-center responsive-icon-small transition-colors duration-200",ne.isCollapsed?"":"mr-3"])},[...t[29]||(t[29]=[(0,a.Lk)("svg",{class:"responsive-icon-small text-current",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1)])],2),ne.isCollapsed?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("span",K,"LOG OUT"))],2)),[[ce,ne.isCollapsed?"Log Out":""]])])]),((0,a.uX)(),(0,a.Wv)(a.Im,{to:"body"},[ne.showHelpModal?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"fixed inset-0 bg-black/60 flex items-center justify-center z-[10001] backdrop-blur-sm",onClick:t[10]||(t[10]=e=>ne.showHelpModal=!1)},[(0,a.Lk)("div",{class:"bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 transform transition-all duration-300 scale-100 overflow-hidden max-h-[85vh] overflow-y-auto",onClick:t[9]||(t[9]=(0,a.D$)(()=>{},["stop"]))},[t[36]||(t[36]=(0,a.Lk)("div",{class:"bg-gradient-to-r from-blue-600 to-blue-700 p-6 text-center shadow-lg"},[(0,a.Lk)("div",{class:"w-16 h-16 bg-blue-500/30 rounded-full flex items-center justify-center mx-auto mb-4 backdrop-blur-sm border border-blue-300/40 shadow-lg"},[(0,a.Lk)("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])]),(0,a.Lk)("h3",{class:"text-xl font-bold text-white mb-1"},"Help & Support"),(0,a.Lk)("p",{class:"text-blue-100 text-sm"},"Quick help based on your role")],-1)),(0,a.Lk)("div",G,[(0,a.Lk)("div",V,[t[34]||(t[34]=(0,a.Lk)("div",{class:"flex items-center p-4 rounded-lg shadow-sm border bg-blue-50 border-blue-100"},[(0,a.Lk)("div",{class:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center mr-3 shadow-md"},[(0,a.Lk)("svg",{class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})])]),(0,a.Lk)("div",null,[(0,a.Lk)("p",{class:"font-medium text-gray-800"},"ICT Support"),(0,a.Lk)("a",{class:"text-sm text-gray-600 hover:text-blue-700",href:"tel:+255222215701"}," +255222215701 ")])],-1)),t[35]||(t[35]=(0,a.Lk)("div",{class:"flex items-center p-4 rounded-lg shadow-sm border bg-blue-50 border-blue-100"},[(0,a.Lk)("div",{class:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center mr-3 shadow-md"},[(0,a.Lk)("svg",{class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})])]),(0,a.Lk)("div",null,[(0,a.Lk)("p",{class:"font-medium text-gray-800"},"Email Support"),(0,a.Lk)("a",{class:"text-sm text-gray-600 hover:text-blue-700",href:"mailto:ict@mnh.or.tz"}," ict@mnh.or.tz ")])],-1)),(0,a.Lk)("div",Y,[(0,a.Lk)("button",{type:"button",onClick:t[7]||(t[7]=e=>ne.showUserGuide=!ne.showUserGuide),class:"w-full flex items-center p-4 text-left"},[t[31]||(t[31]=(0,a.Lk)("div",{class:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center mr-3 shadow-md flex-shrink-0"},[(0,a.Lk)("svg",{class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})])],-1)),t[32]||(t[32]=(0,a.Lk)("div",{class:"flex-1 min-w-0"},[(0,a.Lk)("p",{class:"font-medium text-gray-800"},"User Guide"),(0,a.Lk)("p",{class:"text-sm text-gray-600"},"Access system documentation")],-1)),(0,a.Lk)("div",$,[((0,a.uX)(),(0,a.CE)("svg",{class:(0,a.C4)(["w-4 h-4 text-blue-700 transition-transform duration-200",ne.showUserGuide?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[30]||(t[30]=[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),(0,a.bF)(a.eB,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"transform opacity-0 -translate-y-1","enter-to-class":"transform opacity-100 translate-y-0","leave-active-class":"transition duration-150 ease-in","leave-from-class":"transform opacity-100 translate-y-0","leave-to-class":"transform opacity-0 -translate-y-1"},{default:(0,a.k6)(()=>[ne.showUserGuide?((0,a.uX)(),(0,a.CE)("div",Z,[(0,a.Lk)("div",ee,[(0,a.Lk)("p",te,[t[33]||(t[33]=(0,a.eW)(" Showing guidance for: ",-1)),(0,a.Lk)("span",se,(0,a.v_)(ne.userGuideRoleLabel),1)]),(0,a.Lk)("div",ae,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ne.userGuideSections,(e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t},[(0,a.Lk)("p",oe,(0,a.v_)(e.title),1),(0,a.Lk)("ul",re,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.items,(e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:t},(0,a.v_)(e),1))),128))])]))),128))])])])):(0,a.Q3)("",!0)]),_:1})])]),(0,a.Lk)("div",ie,[(0,a.Lk)("button",{onClick:t[8]||(t[8]=e=>ne.showHelpModal=!1),class:"w-full bg-blue-600 text-white py-3 px-4 rounded-xl font-medium hover:bg-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105"}," Close ")])])])])):(0,a.Q3)("",!0)]))],14,o)}s(4114),s(8111),s(2489),s(116),s(7588),s(1701);var le=s(1387),de=s(9553),ue=s(1127),ce=s(9750),pe=s(657);function ge(){const e=(0,ce.useSidebarStore)(),{isCollapsed:t,isExpanded:s,isInitialized:a,isMobile:o,expandedSections:r,sidebarWidth:i,sidebarClasses:n,mainContentClasses:l}=(0,pe.bP)(e),{initializeSidebar:d,detectMobile:u,setCollapsed:c,toggle:p,expand:g,collapse:m,toggleSection:h,setSectionExpanded:f,resetToDefaults:v,clearStorage:b,getDebugInfo:w}=e,y=()=>g(),C=()=>m(),k=()=>p(),x=e=>r.value[e]||!1,I=e=>{f(e,!0)},E=e=>{f(e,!1)},L=()=>{Object.keys(r.value).forEach(e=>{f(e,!0)})},S=()=>{Object.keys(r.value).forEach(e=>{f(e,!1)})};return a.value||d(),{isCollapsed:t,isExpanded:s,isInitialized:a,isMobile:o,expandedSections:r,sidebarWidth:i,sidebarClasses:n,mainContentClasses:l,initializeSidebar:d,detectMobile:u,setCollapsed:c,toggle:p,expand:g,collapse:m,toggleSection:h,setSectionExpanded:f,resetToDefaults:v,clearStorage:b,getDebugInfo:w,openSidebar:y,closeSidebar:C,toggleSidebar:k,isSectionExpanded:x,expandSection:I,collapseSection:E,expandAllSections:L,collapseAllSections:S}}var me=s(14),he=s(274);const fe=!1,ve=(0,a.Kh)({isAuthenticated:!1,user:null,token:null,tokenName:null,sessionInfo:null,activeSessions:[],loading:!1,error:null}),be={admin:de.gg.ADMIN,divisional_director:de.gg.DIVISIONAL_DIRECTOR,head_of_department:de.gg.HEAD_OF_DEPARTMENT,"Head of Department":de.gg.HEAD_OF_DEPARTMENT,HOD:de.gg.HEAD_OF_DEPARTMENT,hod:de.gg.HEAD_OF_DEPARTMENT,ict_director:de.gg.ICT_DIRECTOR,head_of_it:de.gg.HEAD_OF_IT,staff:de.gg.STAFF,ict_officer:de.gg.ICT_OFFICER},we=e=>{if(!e||"undefined"===e||"null"===e)return console.error("❌ Backend returned invalid role:",e),console.error("❌ This indicates a database issue - user has no role assigned!"),de.gg.STAFF;const t=be[e];return t||(console.warn("⚠️ Role mapping not found for:",e),Object.keys(be),e)},ye={needsOnboarding(e){if(!e)return!1;if(e.role===de.gg.ADMIN)return!1;if(void 0!==e.needs_onboarding)return e.needs_onboarding;const t=JSON.parse(localStorage.getItem("onboarding_completed")||"[]");return!t.includes(e.id)},async markOnboardingComplete(e){try{const t=await he.authAPI.completeOnboarding();if(t.success){ve.user&&ve.user.id===e&&(ve.user={...ve.user,needs_onboarding:!1},localStorage.setItem("user_data",JSON.stringify(ve.user)));const t=JSON.parse(localStorage.getItem("onboarding_completed")||"[]");return t.includes(e)||(t.push(e),localStorage.setItem("onboarding_completed",JSON.stringify(t))),!0}return!1}catch(t){return console.error("Failed to mark onboarding complete:",t),!1}},hasCompletedOnboarding(e){if(!e)return!1;if(void 0!==e.needs_onboarding)return!e.needs_onboarding;const t=JSON.parse(localStorage.getItem("onboarding_completed")||"[]");return t.includes(e.id)}},Ce={get isAuthenticated(){return ve.isAuthenticated},get currentUser(){return ve.user},get userRole(){return ve.user?.role||null},get userName(){return ve.user?.name||""},get userEmail(){return ve.user?.email||""},get isLoading(){return ve.loading},get error(){return ve.error},async login(e){try{ve.loading=!0,ve.error=null;const t=await he.authAPI.login(e);if(t.success){const{user:e,token:s}=t.data;fe&&(e.role,e.role_name,e.roles,e.permissions);const a={...e,role:we(e.role_name||e.role),roles:e.roles||[],permissions:e.permissions||[]};if(!(0,de.t_)(a.role))throw new Error("Invalid user role received from server");const o={token:s,tokenName:t.data.token_name,sessionInfo:t.data.session_info,user:a};return localStorage.setItem("auth_token",s),localStorage.setItem("user_data",JSON.stringify(a)),localStorage.setItem("session_data",JSON.stringify(o)),fe&&(s.substring(0,20),a.name,a.role,t.data.token_name),ve.isAuthenticated=!0,ve.user=a,ve.token=s,ve.tokenName=t.data.token_name,ve.sessionInfo=t.data.session_info,fe&&ve.isAuthenticated,{success:!0,user:a}}throw new Error(t.error)}catch(t){const e=t.message||"Login failed";return ve.error=e,{success:!1,error:e}}finally{ve.loading=!1}},async logout(){try{return ve.loading=!0,await he.authAPI.logout(),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),localStorage.removeItem("session_data"),ve.isAuthenticated=!1,ve.user=null,ve.token=null,ve.tokenName=null,ve.sessionInfo=null,ve.activeSessions=[],ve.error=null,{success:!0}}catch(e){return localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),localStorage.removeItem("session_data"),ve.isAuthenticated=!1,ve.user=null,ve.token=null,ve.tokenName=null,ve.sessionInfo=null,ve.activeSessions=[],console.warn("Logout API call failed, but local state cleared:",e.message),{success:!0}}finally{ve.loading=!1}},async initializeAuth(e=!1){try{if(!e&&ve.isAuthenticated&&ve.user&&ve.token)return!0;ve.loading=!0;const a=localStorage.getItem("auth_token"),o=localStorage.getItem("user_data"),r=localStorage.getItem("session_data");if(a&&o)try{const e=JSON.parse(o);let s=null;if(fe&&(e.name,e.role,e.id),r)try{s=JSON.parse(r)}catch(t){console.warn("Failed to parse session data:",t)}if((0,de.t_)(e.role))return fe&&e.role,ve.isAuthenticated=!0,ve.user=e,ve.token=a,ve.tokenName=s?.tokenName||null,ve.sessionInfo=s?.sessionInfo||null,fe&&(ve.isAuthenticated,ve.user.role,ve.user.name),setTimeout(()=>{this.verifyTokenInBackground(a,e)},100),!0;console.error("❌ Auth: Invalid role in stored data:",e.role),this.clearAuthData()}catch(s){console.error("Failed to parse stored user data:",s),this.clearAuthData()}else ve.isAuthenticated=!1,ve.user=null,ve.token=null,ve.tokenName=null,ve.sessionInfo=null,ve.activeSessions=[]}catch(a){console.error("Failed to initialize auth:",a),this.clearAuthData()}finally{ve.loading=!1}return!1},async verifyTokenInBackground(e,t){try{const e=await he.authAPI.getCurrentUser();if(e.success){const t=e.data;fe&&(t.role,t.role_name,t.roles,t.permissions);const s={...t,role:we(t.role_name||t.role),roles:t.roles||[],permissions:t.permissions||[]};ve.user=s,localStorage.setItem("user_data",JSON.stringify(s))}else e.error&&(e.error.includes("401")||e.error.includes("Unauthorized")||e.error.includes("expired"))&&(this.clearAuthData(),"/"!==window.location.pathname&&"/login"!==window.location.pathname&&(window.location.href="/login"))}catch(s){s.message&&(s.message.includes("401")||s.message.includes("Unauthorized"))&&(this.clearAuthData(),"/"!==window.location.pathname&&"/login"!==window.location.pathname&&(window.location.href="/login"))}},clearAuthData(){localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),localStorage.removeItem("session_data"),ve.isAuthenticated=!1,ve.user=null,ve.token=null,ve.tokenName=null,ve.sessionInfo=null,ve.activeSessions=[],ve.error=null},clearError(){ve.error=null},getDefaultDashboard(){const e=(0,de.getDefaultDashboard)(this.userRole);return fe&&this.userRole,e},needsOnboarding(){return ye.needsOnboarding(this.currentUser)},async markOnboardingComplete(e){return await ye.markOnboardingComplete(e)},async logoutAll(){try{ve.loading=!0;const e=await he.authAPI.logoutAll();if(e.success)return this.clearAuthData(),{success:!0,data:e.data};throw new Error(e.error)}catch(e){return this.clearAuthData(),console.warn("LogoutAll API call failed, but local state cleared:",e.message),{success:!0}}finally{ve.loading=!1}},async getActiveSessions(){try{const e=await he.authAPI.getActiveSessions();if(e.success)return ve.activeSessions=e.data.sessions||[],{success:!0,data:e.data};throw new Error(e.error)}catch(e){const t=e.message||"Failed to fetch active sessions";return ve.error=t,{success:!1,error:t}}},async revokeSession(e){try{const t=await he.authAPI.revokeSession(e);if(t.success)return await this.getActiveSessions(),{success:!0,data:t.data};throw new Error(t.error)}catch(t){const e=t.message||"Failed to revoke session";return ve.error=e,{success:!1,error:e}}},get currentSession(){return{tokenName:ve.tokenName,sessionInfo:ve.sessionInfo,isAuthenticated:ve.isAuthenticated}},get activeSessions(){return ve.activeSessions}};Ce.initializeAuth();var ke=Ce,xe=s(6358),Ie={name:"ModernSidebar",setup(){const e=(0,le.rd)(),t=(0,le.lq)(),{user:o,userRole:r,logout:i,isAuthenticated:n,isLoading:l}=(0,ue.h)(),{isCollapsed:d,expandedSections:u,toggleSidebar:c,toggleSection:p,setSectionExpanded:g,setCollapsed:m}=ge(),h=(0,me.useAuthStore)(),f=!1;h.isInitialized||h.initializeAuth();const v=(0,a.KR)(null),b=(0,a.KR)(""),w=(0,a.KR)(!1),y=(0,a.KR)(!1),C=(0,a.EW)(()=>{const e=h?.userRole||r?.value||v?.value,t=e===de.gg.HEAD_OF_IT;return t&&f&&(D.value.length,A.value.length,T.value.length,u.value),t}),k=(0,a.KR)(window.innerWidth<768),x=()=>{k.value=window.innerWidth<768,k.value&&!d.value&&m(!0)};(0,a.wB)([n,r],([e,t])=>{try{e&&t&&(v.value=t)}catch(s){console.warn("Error in auth state watcher:",s)}},{immediate:!0}),(0,a.sV)(async()=>{window.addEventListener("resize",x),x();const e=localStorage.getItem("auth_token"),s=localStorage.getItem("user_data");if(e&&s){try{const e=JSON.parse(s);e.role&&(v.value=e.role)}catch(o){console.error("Failed to parse stored user data:",o)}n?.value||l?.value||(await(0,a.dY)(),ke.initializeAuth())}n?.value&&r?.value&&(v.value=r.value,r.value===de.gg.HEAD_OF_IT&&(g("dashboard",!0),g("requestsManagement",!0))),await(0,a.dY)(),t.path.startsWith("/divisional-dashboard")&&(d.value?(t.path,m(!1)):t.path)}),(0,a.hi)(()=>{window.removeEventListener("resize",x)});const I=(0,a.EW)(()=>{try{return o?.value?.name||h?.user?.name||"JOHN DOE"}catch(e){return console.warn("Error getting userName:",e),"JOHN DOE"}}),E=(0,a.EW)(()=>{try{const e=I.value||"JOHN DOE";return e.split(" ").map(e=>e?.[0]||"").join("").toUpperCase().slice(0,2)||"JD"}catch(e){return console.warn("Error getting userInitials:",e),"JD"}}),L=(0,a.EW)(()=>{try{const e=o?.value||h?.user;if(e?.department?.name)return e.department.name;if(e?.department_name)return e.department_name;const t=h?.userRole||r?.value||v?.value;return Q(t)}catch(e){return console.warn("Error getting userDepartmentOrRole:",e),"Staff Member"}}),S=(0,a.EW)(()=>{try{const e=n?.value||!1,t=r?.value||null,s=l?.value||!1,a=h?.isAuthenticated||!1,o=h?.userRole||null,i=h?.isLoading||!1,d=a||e,u=o||t||v?.value,c=!i&&!s;return d&&u&&c}catch(e){return console.warn("Error in shouldShowSidebar computed:",e),!1}});function _(e){const t={"/admin-dashboard":{name:"AdminDashboard",displayName:"Admin Dashboard",icon:"fas fa-user-shield",category:"dashboard",description:"Administrative control panel"},"/user-dashboard":{name:"UserDashboard",displayName:"User Dashboard",icon:"fas fa-home",category:"dashboard",description:"User portal and services"},"/dict-dashboard":{name:"DictDashboard",displayName:"ICT Director Dashboard",icon:"fas fa-user-cog",category:"dashboard",description:"ICT Director control panel"},"/hod-dashboard":{name:"HodDashboard",displayName:"HOD Dashboard",icon:"fas fa-user-tie",category:"dashboard",description:"Head of Department panel"},"/divisional-dashboard":{name:"DivisionalDashboard",displayName:"Divisional Dashboard",icon:"fas fa-building",category:"dashboard",description:"Divisional Director panel"},"/ict-dashboard/access-requests":{name:"IctAccessRequests",displayName:"Access Requests",icon:"fas fa-clipboard-check",category:"requests-management",description:"Access requests approved by Head of IT"},"/ict-dashboard/access-service":{name:"IctAccessService",displayName:"Access Service",icon:"fas fa-tags",category:"requests-management",description:"Create new access or booking request"},"/head_of_it-dashboard":{name:"HeadOfItDashboard",displayName:"Dashboard",icon:"fas fa-user-cog",category:"dashboard",description:"Head of IT control panel"},"/service-users":{name:"ServiceUsers",displayName:"Service Granted",icon:"fas fa-check-circle",category:"user-management",description:"Manage granted services"},"/ict-approval/requests":{name:"RequestsList",displayName:"Device Requests",icon:"fas fa-clipboard-list",category:"device-management",description:"Manage device borrowing requests (ICT Officer)"},"/secretary-approval/requests":{name:"SecretaryRequestsList",displayName:"Device Requests",icon:"fas fa-clipboard-list",category:"device-management",description:"Manage device borrowing requests (Secretary ICT)"},"/hod-dashboard/request-list":{name:"HODDashboardRequestList",displayName:"Access Requests",icon:"fas fa-clipboard-check",category:"requests-management",description:"Review access requests"},"/divisional-dashboard/combined-requests":{name:"DivisionalCombinedRequestList",displayName:"Combined Requests",icon:"fas fa-clipboard-list",category:"requests-management",description:"Review HOD-approved requests"},"/dict-dashboard/combined-requests":{name:"DictCombinedRequestList",displayName:"Access Requests",icon:"fas fa-clipboard-check",category:"requests-management",description:"Review Divisional Director-approved requests"},"/head_of_it-dashboard/combined-requests":{name:"HeadOfItCombinedRequestList",displayName:"Access Requests",icon:"fas fa-clipboard-check",category:"requests-management",description:"Review ICT Director-approved requests"}};return t[e]||{}}const D=(0,a.EW)(()=>{try{const e=h?.userRole||r?.value||v?.value;if(!e)return[];const t=(0,de.X0)(e)||[];if(!t.length)return[];const s=t.map(e=>{try{const t=_(e);return{path:e,...t}}catch(t){return console.warn("Error getting metadata for route:",e,t),null}}).filter(e=>e&&e.name);return s.length,s}catch(e){return console.error("Error computing menu items:",e),[]}}),A=(0,a.EW)(()=>{try{return D?.value?.filter(e=>"dashboard"===e?.category)||[]}catch(e){return console.warn("Error filtering dashboard items:",e),[]}}),R=(0,a.EW)(()=>{try{return D?.value?.filter(e=>"user-management"===e?.category)||[]}catch(e){return console.warn("Error filtering user management items:",e),[]}}),N=(0,a.EW)(()=>{try{return D?.value?.filter(e=>"device-management"===e?.category)||[]}catch(e){return console.warn("Error filtering device management items:",e),[]}}),T=(0,a.EW)(()=>{try{return D?.value?.filter(e=>"requests-management"===e?.category)||[]}catch(e){return console.warn("Error filtering requests management items:",e),[]}}),O=(0,a.EW)(()=>{try{const e=h?.userRole||r?.value||v?.value;return e===de.gg.SECRETARY_ICT}catch(e){return console.warn("Error computing shouldHideAccessRequests:",e),!1}}),q=(0,a.EW)(()=>{try{return b?.value?A?.value?.filter(e=>e?.displayName?.toLowerCase().includes(b.value.toLowerCase()))||[]:A?.value||[]}catch(e){return console.error("Error filtering dashboard items:",e),A?.value||[]}}),M=(0,a.EW)(()=>{try{return b?.value?R?.value?.filter(e=>e?.displayName?.toLowerCase().includes(b.value.toLowerCase()))||[]:R?.value||[]}catch(e){return console.error("Error filtering user management items:",e),R?.value||[]}}),H=(0,a.EW)(()=>{try{return b?.value?N?.value?.filter(e=>e?.displayName?.toLowerCase().includes(b.value.toLowerCase()))||[]:N?.value||[]}catch(e){return console.error("Error filtering device management items:",e),N?.value||[]}}),j=(0,a.EW)(()=>{try{let e=T?.value||[];return O.value&&(e=e.filter(e=>"/ict-dashboard/access-requests"!==e.path)),b?.value?e?.filter(e=>e?.displayName?.toLowerCase().includes(b.value.toLowerCase()))||[]:e}catch(e){return console.error("Error filtering requests management items:",e),T?.value||[]}});function X(){c()}function F(e){p(e)}const U=(0,a.EW)(()=>h?.userRole||r?.value||v?.value||de.gg.STAFF),W=(0,a.EW)(()=>Q(U.value)),P=(0,a.EW)(()=>{const e=U.value;switch(e){case de.gg.ADMIN:return[{title:"Admin: setup & maintenance",items:["Open Admin Dashboard to manage users, roles, and departments.","Correct role + department assignment controls which menus/forms a user can access."]},{title:"Admin: user support",items:["If a user cannot see expected pages, verify their role assignment first.","Use onboarding reset when a user must re-accept terms/ICT policy or restart onboarding."]}];case de.gg.STAFF:return[{title:"Staff: submit a request",items:["Open User Dashboard and select the required form (Jeeva / Wellsoft / Internet / Combined).","Complete all fields accurately (request type, justification, user details) then submit."]},{title:"Staff: follow up",items:["Track your request status from your dashboard.","If clarification is requested by approvers, update/re-submit promptly."]}];case de.gg.HEAD_OF_DEPARTMENT:return[{title:"HOD: review & recommend",items:["Use HOD Dashboard → Access Requests to review submissions from your department.","Approve/Reject (recommend) with clear comments and forward to the next approval stage."]},{title:"HOD: data quality",items:["Ensure staff details and department information are correct for routing.","If details are missing, reject with reasons so the user can correct and re-submit."]}];case de.gg.DIVISIONAL_DIRECTOR:return[{title:"Divisional Director: approval stage",items:["Use Divisional Dashboard → Combined Requests to review escalated requests.","Approve/Reject with clear audit comments (who/what/why) to keep workflow moving."]}];case de.gg.HEAD_OF_IT:return[{title:"Head of IT: routing & oversight",items:["Use Head of IT Dashboard → Combined Requests to review and route requests.","Forward tasks to the ICT team for implementation and track bottlenecks."]},{title:"Head of IT: escalation",items:["Escalate high-impact or policy-sensitive requests to ICT Director.","Coordinate with departments when submitted information is incomplete."]}];case de.gg.ICT_OFFICER:return[{title:"ICT Officer: implement requests",items:["Open ICT Dashboard → Access Requests to view items forwarded for implementation.","Validate request details and implement the required service or reject with reasons."]},{title:"ICT Officer: update status",items:["Update the request status after action is taken so users/approvers can track progress.","Escalate exceptions to Head of IT / ICT Director."]}];case de.gg.SECRETARY_ICT:return[{title:"ICT Secretary: device bookings",items:["Use Device Requests to review device borrowing/booking requests.","Confirm availability and booking dates before approving/declining."]},{title:"ICT Secretary: coordination",items:["Escalate technical implementation tasks to ICT Officer.","Use ICT Support contacts for communication and issue logging."]}];case de.gg.ICT_DIRECTOR:return[{title:"ICT Director: final oversight",items:["Use ICT Director Dashboard to review escalated / high-impact requests.","Approve/Reject based on ICT policy and ensure the ICT team follows through."]}];default:return[{title:"General guidance",items:["Your menus and forms are displayed based on your role and permissions.","If you cannot find a page you need, contact ICT Support or request role verification from Admin."]}]}});function z(){w.value=!0}function Q(e){if(!e)return"User";const t={[de.gg.ADMIN]:"Administrator",[de.gg.DIVISIONAL_DIRECTOR]:"Divisional Director",[de.gg.HEAD_OF_DEPARTMENT]:"Head of Department",[de.gg.ICT_DIRECTOR]:"ICT Director",[de.gg.HEAD_OF_IT]:"Head of IT",[de.gg.STAFF]:"Staff Member",[de.gg.ICT_OFFICER]:"ICT Officer",[de.gg.SECRETARY_ICT]:"ICT Secretary"};return t[e]||e}async function J(){try{await xe.a.executeLogout(async()=>{await i()}),e.push("/")}catch(t){console.error("Logout failed:",t),e.push("/")}}const B=(0,a.KR)({});function K(e){const t=B.value[e]||0;return t}const G=(0,a.KR)(0),V=3,Y=(0,a.KR)(!1);async function $(e=!1){if(!Y.value)try{const a=h?.userRole||r?.value||v?.value;if(!a)return void console.warn("No role found, skipping notification fetch");const o=(await s.e(4710).then(s.bind(s,4710))).default;0;const i=await o.getPendingRequestsCount(e);0,G.value=0;let n=i.total_pending||0,l=null,d=null;if("ict_officer"===a)try{const e=(await s.e(5389).then(s.bind(s,5389))).default,t=await e.getPendingRequestsCount();l="object"===typeof t?t.total_pending??null:t}catch(t){console.warn("⚠️ Failed to fetch ICT-specific pending count:",t?.message||t)}else if("ict_director"===a){try{const e=(await s.e(9189).then(s.bind(s,9189))).default,a=await e.getDictStatistics(),o=a?.data||{},r=Number(o.pendingDict??o.pending??o.total_pending??o.pending_count??0);if(0===n&&r>0&&(n=r),0===n){const s=await e.getDictRequests(),a=e=>{if(!e)return[];const s=[e?.data?.data,e?.data?.records,e?.data?.items,e?.data?.rows,e?.data,e?.items,e?.records,e?.rows];for(const t of s)if(Array.isArray(t))return t;try{const t=Object.values(e?.data||{}),s=t.find(e=>Array.isArray(e));if(Array.isArray(s))return s}catch(t){}return[]},o=a(s),r=o.filter(e=>{const t=String(e.status||e.dict_status||"").toLowerCase(),s=String(e.ict_director_status||e.dict_status||"").toLowerCase(),a=String(e.hod_status||"").toLowerCase(),o=String(e.divisional_status||"").toLowerCase(),r=String(e.head_it_status||"").toLowerCase(),i=String(e.ict_officer_status||"").toLowerCase(),n="pending"===t||"divisional_approved"===t||"pending_ict_director"===t||"pending_dict"===t||"pending"===s,l=["approved","skipped"].includes(a)&&["approved","skipped"].includes(o),d=!["approved","implemented","completed"].includes(i),u=!["approved","rejected"].includes(r),c=!["approved","rejected"].includes(s),p=l&&c&&u&&d;return n||p}).length;r>0&&(n=r)}}catch(t){console.warn("⚠️ Failed to fetch DICT pending count:",t?.message||t)}try{"undefined"!==typeof window&&"number"===typeof window.accessRequestsPendingCount&&(d=window.accessRequestsPendingCount)}catch(t){console.warn("⚠️ Failed to read page override count:",t?.message||t)}n=("number"===typeof d?d:null)??("number"===typeof l?l:null)??n}i.details?.breakdown||i.details,0;const u="ict_officer"===a?n>0:i.total_pending>0;if(u&&console.warn("⚠️ NOTIFICATION ISSUE DETECTED:",{message:"Badge showing pending count but requests may be completed",pending_count:"ict_officer"===a?n:i.total_pending,user_role:a,timestamp:(new Date).toISOString(),suggestion:"Check backend /notifications/pending-count API - may be counting completed/implemented requests"}),n>0){const e=o.getRoleNotificationConfig(a),t={...B.value};B.value={},e.menuItems.forEach(e=>{let s=n;"ict_officer"===a&&"/ict-dashboard/access-requests"===e&&"undefined"!==typeof window&&"number"===typeof window.accessRequestsPendingCount&&(s=window.accessRequestsPendingCount),B.value[e]=s,f&&t[e]}),f&&(e.menuItems,B.value,JSON.stringify(t),JSON.stringify(B.value))}else{B.value;B.value={}}}catch(a){console.error("❌ Failed to fetch notification counts:",a),G.value++,G.value>=V&&(console.warn(`⚠️ Disabling notifications after ${V} failures`),Y.value=!0,setTimeout(()=>{Y.value=!1,G.value=0},3e5)),console.error("Error details:",{message:a.message,code:a.code,status:a.response?.status,retries:G.value,disabled:Y.value})}}let Z=null;return(0,a.sV)(()=>{setTimeout(()=>{$()},2e3),Z=setInterval($,3e4),window.sidebarInstance={fetchNotificationCounts:(e=!1)=>{f&&(B.value,(new Date).toISOString()),$(e)},setNotificationCount:(e,t)=>{try{"number"===typeof t&&e&&(f&&B.value[e],B.value[e]=t)}catch(s){console.warn("Failed to set notification count globally:",s?.message||s)}}};const e=e=>{f&&((new Date).toISOString(),B.value),$(!0)},t=e=>{const t=e?.detail?.count;"number"===typeof t&&(B.value["/ict-dashboard/access-requests"]=t)},s=e=>{f&&((new Date).toISOString(),B.value);B.value;B.value={},$(!0)};window.addEventListener&&(window.addEventListener("refresh-notifications",e),window.addEventListener("force-refresh-notifications",s),window.addEventListener("ict-access-requests-pending-count",t))}),(0,a.hi)(()=>{Z&&clearInterval(Z),window.sidebarInstance&&delete window.sidebarInstance,window.removeEventListener&&window.removeEventListener("refresh-notifications",()=>{$(!0)})}),(0,a.wB)(t,(e,t)=>{const s=["/ict-dashboard/access-requests","/hod-dashboard/request-list","/divisional-dashboard/combined-requests","/dict-dashboard/combined-requests","/head_of_it-dashboard/combined-requests"];e.path.startsWith("/divisional-dashboard")&&d.value&&(e.path,m(!1)),s.some(t=>e.path.startsWith(t))&&(e.path,setTimeout(()=>{$(!0)},1e3))},{immediate:!0}),{isCollapsed:d,searchQuery:b,showHelpModal:w,showUserGuide:y,userGuideRoleLabel:W,userGuideSections:P,stableUserRole:v,expandedSections:u,route:t,currentUser:o,userRole:r,isAuthenticated:n,isLoading:l,userName:I,userInitials:E,userDepartmentOrRole:L,shouldShowSidebar:S,dashboardItems:A,userManagementItems:R,deviceManagementItems:N,requestsManagementItems:T,filteredDashboardItems:q,filteredUserManagementItems:M,filteredDeviceManagementItems:H,filteredRequestsManagementItems:j,debugHeadOfIt:C,toggleCollapse:X,toggleSectionLocal:F,showHelp:z,getRoleDisplayName:Q,handleLogout:J,getNotificationCount:K,fetchNotificationCounts:$,piniaAuthStore:h}},directives:{tooltip:{mounted(e,t){t.value&&"string"===typeof t.value&&(e.title=t.value)},updated(e,t){t.value&&"string"===typeof t.value?e.title=t.value:e.removeAttribute("title")},unmounted(e){e.removeAttribute("title")}}}},Ee=s(1241);const Le=(0,Ee.A)(Ie,[["render",ne],["__scopeId","data-v-5f26fa50"]]);var Se=Le}}]);
//# sourceMappingURL=8966.6ba74cee.js.map