"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[981,7933],{981:function(e,s,t){t.d(s,{authService:function(){return l}});var a=t(4373);const r="/api",o=a.A.create({baseURL:r,timeout:parseInt("30000")||1e4,headers:{"Content-Type":"application/json",Accept:"application/json"}});o.interceptors.request.use(e=>{const s=localStorage.getItem("auth_token");return s&&(e.headers.Authorization=`Bearer ${s}`),e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,e=>{const s=e.response?.status,t=(e.config?.method||"").toString().toLowerCase(),a=(e.config?.url||"").toString();if(401===s){const e="post"===t&&a.includes("/login");e||(localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),localStorage.removeItem("session_data"),window.location.href="/login")}return Promise.reject(e)});const l={async login(e){try{const s=await o.post("/login",e);return{success:!0,data:s.data}}catch(s){return{success:!1,message:s.response?.data?.message||"Login failed",errors:s.response?.data?.errors||{}}}},async logout(){try{const e=await o.post("/logout");return{success:!0,data:e.data}}catch(e){return{success:!0,message:"Logged out locally (API call failed)"}}},async logoutAll(){try{const e=await o.post("/logout-all");return{success:!0,data:e.data}}catch(e){return{success:!1,message:e.response?.data?.message||"Logout all failed"}}},async getCurrentUser(){try{const e=await o.get("/current-user");return{success:!0,data:e.data}}catch(e){return{success:!1,message:e.response?.data?.message||"Failed to get user data",status:e.response?.status}}},async getRoleBasedRedirect(){try{const e=await o.get("/role-redirect");return{success:!0,data:e.data}}catch(e){return{success:!1,message:e.response?.data?.message||"Failed to get redirect URL",status:e.response?.status}}},async getActiveSessions(){try{const e=await o.get("/active-sessions");return{success:!0,data:e.data}}catch(e){return{success:!1,message:e.response?.data?.message||"Failed to get active sessions"}}},async revokeSession(e){try{const s=await o.post("/revoke-session",{token_id:e});return{success:!0,data:s.data}}catch(s){return{success:!1,message:s.response?.data?.message||"Failed to revoke session"}}},async changePassword(e){try{const s=await o.post("/change-password",{current_password:e.current,password:e.new,password_confirmation:e.confirm});return{success:!0,data:s.data,message:s.data?.message||"Password changed successfully."}}catch(s){return{success:!1,message:s.response?.data?.message||"Failed to change password.",errors:s.response?.data?.errors||{}}}},async requestPasswordResetByPhone(e){try{const s=await o.post("/password-reset/request-by-phone",{phone:e});return{success:!0,data:s.data,message:s.data?.message}}catch(s){return{success:!1,message:s.response?.data?.message||"Failed to send OTP.",errors:s.response?.data?.errors||{}}}},async verifyPasswordResetOtp(e){try{const s=await o.post("/password-reset/verify-otp",{phone:e.phone,otp:e.otp});return{success:!0,data:s.data,message:s.data?.message}}catch(s){return{success:!1,message:s.response?.data?.message||"Failed to verify OTP.",errors:s.response?.data?.errors||{}}}},async resetPasswordWithOtp(e){try{const s=await o.post("/password-reset/reset-with-otp",{phone:e.phone,otp:e.otp,password:e.password,password_confirmation:e.password_confirmation});return{success:!0,data:s.data?.data,message:s.data?.message}}catch(s){return{success:!1,message:s.response?.data?.message||"Failed to reset password.",errors:s.response?.data?.errors||{}}}}};s["default"]=l},1127:function(e,s,t){t.d(s,{h:function(){return n}});t(4114);var a=t(5796),r=t(1387),o=t(14),l=t(9553);function n(){const e=(0,r.rd)(),s=(0,o.useAuthStore)(),n=(0,a.EW)(()=>s.user),i=(0,a.EW)(()=>s.token),d=(0,a.EW)(()=>s.isAuthenticated),u=(0,a.EW)(()=>s.userPermissions),c=(0,a.EW)(()=>s.userRole),g=(0,a.EW)(()=>s.userRoles),p=(0,a.EW)(()=>s.isLoading),m=(0,a.EW)(()=>s.error),h=(0,a.EW)(()=>s.isAdmin),b=(0,a.EW)(()=>s.isStaff),f=(0,a.EW)(()=>s.isApprover),v=(0,a.EW)(()=>n.value?.name||"User"),w=async a=>{try{const{authService:r}=await t.e(981).then(t.bind(t,981)),o=await r.login(a);if(o.success){const{user:t,token:a}=o.data;s.setAuthData({user:t,token:a});let r=(0,l.getDefaultDashboard)(s.userRole)||"/user-dashboard";t?.needs_onboarding&&"admin"!==s.userRole&&(r="/onboarding");const n=e.currentRoute.value.query.redirect;return n&&"string"===typeof n&&(r=n),await e.push(r),{success:!0,user:t}}{let e=o.message||"Login failed";if(o.errors&&"object"===typeof o.errors){const s=["email","password"];for(const t of s){const s=o.errors[t];if(Array.isArray(s)&&s.length>0){e=s[0];break}}}return console.error("❌ Login failed:",e),s.setError(e),{success:!1,message:e}}}catch(m){return console.error("❌ Login error in composable:",m),s.setError(m.message||"Login failed"),{success:!1,message:m.message||"Login failed"}}},y=async()=>{try{const{authService:a}=await t.e(981).then(t.bind(t,981));return await a.logout(),s.clearAuth(),await e.push("/login"),{success:!0}}catch(m){return s.clearAuth(),await e.push("/login"),{success:!0}}},x=async()=>{try{const{authService:a}=await t.e(981).then(t.bind(t,981)),r=await a.logoutAll();return s.clearAuth(),await e.push("/login"),r.success?r:{success:!0}}catch(m){return s.clearAuth(),await e.push("/login"),{success:!0}}},k=e=>{s.updateUser(e)},L=()=>{s.clearError()},E=e=>s.hasPermission(e),P=e=>s.hasRole(e),C=e=>!e.meta?.roles||P(e.meta.roles),S=e=>{if(!P(e)){const s=Array.isArray(e)?e.join(", "):e;throw new Error(`Access denied. Required role(s): ${s}`)}},R=e=>{if(!e)return"User";const s={[l.gg.ADMIN]:"Administrator",[l.gg.DIVISIONAL_DIRECTOR]:"Divisional Director",[l.gg.HEAD_OF_DEPARTMENT]:"Head of Department",[l.gg.ICT_DIRECTOR]:"ICT Director",[l.gg.HEAD_OF_IT]:"Head of IT",[l.gg.STAFF]:"D. IN MEDICINE",[l.gg.ICT_OFFICER]:"ICT Officer",[l.gg.SECRETARY_ICT]:"Secretary ICT"};return s[e]||e};return{user:n,userName:v,token:i,isAuthenticated:d,userPermissions:u,userRole:c,userRoles:g,isLoading:p,error:m,isAdmin:h,isStaff:b,isApprover:f,login:w,logout:y,logoutAll:x,updateUser:k,clearError:L,hasPermission:E,hasRole:P,canAccessRoute:C,requireRole:S,getRoleDisplayName:R,ROLES:l.gg}}},3701:function(e,s,t){t.r(s),t.d(s,{default:function(){return pe}});var a=t(5796);function r(e,s,t,r,o,l){const n=(0,a.g2)("LoginPage");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(n)])}const o={class:"min-h-screen bg-gray-100"},l={class:"flex bg-white overflow-hidden w-full h-screen"},n={class:"w-full md:w-1/2 p-8 flex flex-col justify-center items-center"},i={class:"w-full max-w-md"},d={key:0,class:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded flex items-center"},u={class:"mb-4"},c=["disabled"],g={class:"mb-4"},p=["disabled"],m={class:"mb-4 flex items-center justify-between"},h={class:"flex items-center text-sm text-gray-600"},b=["disabled"],f={key:0},v={key:1},w={class:"mt-4 text-center"},y={key:0,class:"fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50"};function x(e,s,t,r,x,k){const L=(0,a.g2)("OrbitingDots"),E=(0,a.g2)("ForgotPasswordModal");return(0,a.uX)(),(0,a.CE)("div",o,[(0,a.Lk)("div",l,[s[17]||(s[17]=(0,a.Fv)('<div class="hidden md:block w-1/2 relative overflow-hidden" data-v-02455687><div class="absolute inset-0 bg-cover bg-center background-animate" style="background-image:url(&#39;/assets/images/image1.jpg&#39;);" data-v-02455687></div><div class="relative z-10 flex flex-col items-up justify-up h-full p-8 text-white" data-v-02455687></div><svg class="absolute right-0 top-0 h-full w-32 text-white" viewBox="0 0 100 100" preserveAspectRatio="none" data-v-02455687><path d="M100 0 L100 100 L50 100 C 100 66 0 33 50 0 L 100 0 Z" fill="currentColor" data-v-02455687></path><path d="M 50 100 C 100 66 0 33 50 0" fill="none" stroke="white" stroke-width="1.5" style="filter:drop-shadow(0 0 3px rgba(255, 255, 255, 0.9));" data-v-02455687></path></svg></div>',1)),(0,a.Lk)("div",n,[s[15]||(s[15]=(0,a.Lk)("h1",{class:"text-4xl font-serif font-bold text-primary animate-fadeIn mb-2"}," Muhimbili National Hospital ",-1)),s[16]||(s[16]=(0,a.Lk)("div",{class:"logo-circle rounded-full overflow-hidden border-2 border-primary flex items-center justify-center mb-6"},[(0,a.Lk)("img",{src:"/assets/images/logo.jpg",alt:"Muhimbili Logo",class:"max-w-full max-h-full animate-flipX object-contain"})],-1)),(0,a.Lk)("div",i,[s[14]||(s[14]=(0,a.Lk)("h2",{class:"text-2xl font-bold mb-4 text-center text-primary"},"Login",-1)),r.errorMessage?((0,a.uX)(),(0,a.CE)("div",d,[s[7]||(s[7]=(0,a.Lk)("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),(0,a.eW)(" "+(0,a.v_)(r.errorMessage),1)])):(0,a.Q3)("",!0),(0,a.Lk)("form",{onSubmit:s[4]||(s[4]=(0,a.D$)((...e)=>r.handleLogin&&r.handleLogin(...e),["prevent"]))},[(0,a.Lk)("div",u,[s[8]||(s[8]=(0,a.Lk)("label",{class:"block text-gray-700 font-bold text-left"},"Email",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>r.email=e),type:"email",class:"w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",required:"",placeholder:"Enter your email",disabled:r.loading},null,8,c),[[a.Jo,r.email]])]),(0,a.Lk)("div",g,[s[9]||(s[9]=(0,a.Lk)("label",{class:"block text-gray-700 font-bold text-left"},"Password",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>r.password=e),type:"password",class:"w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",required:"",placeholder:"Enter your password",disabled:r.loading},null,8,p),[[a.Jo,r.password]])]),(0,a.Lk)("div",m,[(0,a.Lk)("label",h,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":s[2]||(s[2]=e=>r.rememberEmail=e),type:"checkbox",class:"mr-2 rounded focus:ring-2 focus:ring-primary"},null,512),[[a.lH,r.rememberEmail]]),s[10]||(s[10]=(0,a.Lk)("span",null,"Remember my email",-1))]),r.email?((0,a.uX)(),(0,a.CE)("button",{key:0,type:"button",onClick:s[3]||(s[3]=(...e)=>r.clearSavedEmail&&r.clearSavedEmail(...e)),class:"text-xs text-gray-500 hover:text-red-600 transition-colors",title:"Clear saved email"},[...s[11]||(s[11]=[(0,a.Lk)("i",{class:"fas fa-times mr-1"},null,-1),(0,a.eW)(" Clear ",-1)])])):(0,a.Q3)("",!0)]),(0,a.Lk)("button",{type:"submit",disabled:r.isLoading,class:"w-full bg-primary text-white p-2 rounded hover:bg-opacity-90 transition ease-in-out duration-300 animate-fadeIn delay-2 animate-bounceIn disabled:opacity-50"},[r.loading?((0,a.uX)(),(0,a.CE)("span",f,[(0,a.bF)(L,{size:"sm",class:"mr-2"}),s[12]||(s[12]=(0,a.eW)(" Logging in... ",-1))])):((0,a.uX)(),(0,a.CE)("span",v,[...s[13]||(s[13]=[(0,a.Lk)("i",{class:"fas fa-sign-in-alt mr-2"},null,-1),(0,a.eW)(" Login ",-1)])]))],8,b)],32),(0,a.Lk)("div",w,[(0,a.Lk)("button",{type:"button",class:"text-sm text-primary hover:underline focus:outline-none",onClick:s[5]||(s[5]=(...e)=>r.handleForgotPassword&&r.handleForgotPassword(...e))}," Forgot your password? ")])])])]),r.showSuccessSnackbar?((0,a.uX)(),(0,a.CE)("div",y,[...s[18]||(s[18]=[(0,a.Lk)("div",{class:"flex items-center"},[(0,a.Lk)("i",{class:"fas fa-check-circle mr-2"}),(0,a.eW)(" Login successful! Redirecting... ")],-1)])])):(0,a.Q3)("",!0),(0,a.bF)(E,{show:r.showForgotPassword,onClose:s[6]||(s[6]=e=>r.showForgotPassword=!1)},null,8,["show"])])}var k=t(1387),L=t(1127);const E="remembered_email",P={saveEmail(e){if(e&&e.trim())try{localStorage.setItem(E,e.trim())}catch(s){console.error("Failed to save email:",s)}},getSavedEmail(){try{const e=localStorage.getItem(E);if(e&&e.trim())return e.trim()}catch(e){console.error("Failed to retrieve saved email:",e)}return null},clearSavedEmail(){try{localStorage.removeItem(E)}catch(e){console.error("Failed to clear saved email:",e)}},hasRememberedEmail(){return!!this.getSavedEmail()}};var C=P,S=t(4247);const R={key:0,class:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50"},A={class:"forgot-password-modal bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 relative"},O={key:0,class:"mb-3 p-2 bg-red-50 border border-red-200 text-xs text-red-700 rounded flex items-center"},F={class:"flex items-center justify-center mb-4 text-xs"},T={class:"flex items-center space-x-2"},I={key:1},W=["disabled"],_=["disabled"],X={key:0},D={key:1},M={key:2},N={class:"text-xs text-gray-600 mb-1"},j={class:"font-semibold"},q={key:0,class:"text-[11px] text-blue-600"},K=["disabled"],U=["disabled"],z={key:0},$={key:1},V=["disabled"],B=["disabled"],H={key:3},Q=["disabled"],J={key:0,class:"mt-1 text-xs text-red-600"},Y=["disabled"],Z={key:1,class:"mt-1 text-xs text-red-600"},G=["disabled"],ee={key:0},se={key:1};function te(e,s,t,r,o,l){return t.show?((0,a.uX)(),(0,a.CE)("div",R,[(0,a.Lk)("div",A,[(0,a.Lk)("button",{type:"button",class:"absolute top-3 right-3 text-gray-400 hover:text-gray-600",onClick:s[0]||(s[0]=(...e)=>r.handleClose&&r.handleClose(...e))},[...s[10]||(s[10]=[(0,a.Lk)("i",{class:"fas fa-times"},null,-1)])]),s[26]||(s[26]=(0,a.Lk)("h2",{class:"text-xl font-semibold text-gray-800 mb-2 text-center"},"Reset Password",-1)),s[27]||(s[27]=(0,a.Lk)("p",{class:"text-xs text-gray-500 mb-4 text-center"}," Follow the steps below to securely reset your password using your registered phone number. ",-1)),r.errorMessage?((0,a.uX)(),(0,a.CE)("div",O,[s[11]||(s[11]=(0,a.Lk)("i",{class:"fas fa-exclamation-circle mr-2"},null,-1)),(0,a.Lk)("span",null,(0,a.v_)(r.errorMessage),1)])):(0,a.Q3)("",!0),(0,a.Lk)("div",F,[(0,a.Lk)("div",T,[(0,a.Lk)("div",{class:(0,a.C4)(["w-6 h-6 rounded-full flex items-center justify-center text-white",r.step>=1?"bg-blue-600":"bg-gray-300"])}," 1 ",2),s[12]||(s[12]=(0,a.Lk)("span",{class:"text-gray-600"},"Phone",-1)),s[13]||(s[13]=(0,a.Lk)("div",{class:"w-6 h-px bg-gray-300 mx-1"},null,-1)),(0,a.Lk)("div",{class:(0,a.C4)(["w-6 h-6 rounded-full flex items-center justify-center text-white",r.step>=2?"bg-blue-600":"bg-gray-300"])}," 2 ",2),s[14]||(s[14]=(0,a.Lk)("span",{class:"text-gray-600"},"OTP",-1)),s[15]||(s[15]=(0,a.Lk)("div",{class:"w-6 h-px bg-gray-300 mx-1"},null,-1)),(0,a.Lk)("div",{class:(0,a.C4)(["w-6 h-6 rounded-full flex items-center justify-center text-white",r.step>=3?"bg-blue-600":"bg-gray-300"])}," 3 ",2),s[16]||(s[16]=(0,a.Lk)("span",{class:"text-gray-600"},"New Password",-1))])]),1===r.step?((0,a.uX)(),(0,a.CE)("div",I,[s[17]||(s[17]=(0,a.Lk)("label",{class:"block text-xs font-semibold text-gray-700 mb-1"},"Registered Phone Number",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>r.phoneNumber=e),type:"tel",class:"w-full p-2 border rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent",placeholder:"Enter your registered phone number",disabled:r.loading},null,8,W),[[a.Jo,r.phoneNumber]]),s[18]||(s[18]=(0,a.Lk)("p",{class:"mt-1 text-[11px] text-gray-500"}," Enter the phone number that is registered in the system. A 6-digit OTP code will be sent to this number. ",-1)),(0,a.Lk)("button",{type:"button",class:"mt-4 w-full bg-blue-600 text-white py-2 rounded text-sm hover:bg-blue-700 disabled:opacity-50",disabled:r.loading||!r.phoneNumber,onClick:s[2]||(s[2]=(...e)=>r.handleSendOtp&&r.handleSendOtp(...e))},[r.loading?((0,a.uX)(),(0,a.CE)("span",X,"Sending OTP...")):((0,a.uX)(),(0,a.CE)("span",D,"Send OTP"))],8,_)])):2===r.step?((0,a.uX)(),(0,a.CE)("div",M,[(0,a.Lk)("p",N,[s[19]||(s[19]=(0,a.eW)(" Enter the 6-digit OTP sent to your phone number ending with ",-1)),(0,a.Lk)("span",j,(0,a.v_)(r.phoneSuffix),1),s[20]||(s[20]=(0,a.eW)(". ",-1))]),r.otpCountdownLabel?((0,a.uX)(),(0,a.CE)("p",q," Code expires in "+(0,a.v_)(r.otpCountdownLabel),1)):(0,a.Q3)("",!0),s[21]||(s[21]=(0,a.Lk)("p",{class:"text-[11px] text-gray-500 mb-2"},[(0,a.eW)(" You have up to "),(0,a.Lk)("span",{class:"font-semibold"},"5 attempts"),(0,a.eW)(" before this code locks and you must request a new one. ")],-1)),s[22]||(s[22]=(0,a.Lk)("label",{class:"block text-xs font-semibold text-gray-700 mb-1"},"OTP Code",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":s[3]||(s[3]=e=>r.otp=e),type:"text",maxlength:"6",class:"w-full p-2 border rounded text-center tracking-widest text-lg font-mono focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent",placeholder:"••••••",disabled:r.loading},null,8,K),[[a.Jo,r.otp]]),(0,a.Lk)("button",{type:"button",class:"mt-4 w-full bg-blue-600 text-white py-2 rounded text-sm hover:bg-blue-700 disabled:opacity-50",disabled:r.loading||6!==r.otp.length,onClick:s[4]||(s[4]=(...e)=>r.handleVerifyOtp&&r.handleVerifyOtp(...e))},[r.loading?((0,a.uX)(),(0,a.CE)("span",z,"Verifying OTP...")):((0,a.uX)(),(0,a.CE)("span",$,"Proceed"))],8,U),0===r.otpCountdown?((0,a.uX)(),(0,a.CE)("button",{key:1,type:"button",class:"mt-2 w-full text-[11px] text-blue-600 hover:text-blue-800",disabled:r.loading,onClick:s[5]||(s[5]=(...e)=>r.handleResendOtp&&r.handleResendOtp(...e))}," Resend code ",8,V)):(0,a.Q3)("",!0),(0,a.Lk)("button",{type:"button",class:"mt-2 w-full text-[11px] text-gray-500 hover:text-blue-600",disabled:r.loading,onClick:s[6]||(s[6]=(...e)=>r.goBackToPhone&&r.goBackToPhone(...e))}," ← Back to phone number ",8,B)])):((0,a.uX)(),(0,a.CE)("div",H,[s[23]||(s[23]=(0,a.Lk)("label",{class:"block text-xs font-semibold text-gray-700 mb-1"},"New Password",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":s[7]||(s[7]=e=>r.newPassword=e),type:"password",class:(0,a.C4)(["w-full p-2 border rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent",{"border-red-500 focus:ring-red-500 focus:border-red-500":r.newPasswordError}]),placeholder:"Create a new password",disabled:r.loading},null,10,Q),[[a.Jo,r.newPassword]]),r.newPasswordError?((0,a.uX)(),(0,a.CE)("p",J,(0,a.v_)(r.newPasswordError),1)):(0,a.Q3)("",!0),s[24]||(s[24]=(0,a.Lk)("label",{class:"block text-xs font-semibold text-gray-700 mb-1 mt-3"},"Confirm New Password",-1)),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":s[8]||(s[8]=e=>r.confirmPassword=e),type:"password",class:(0,a.C4)(["w-full p-2 border rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent",{"border-red-500 focus:ring-red-500 focus:border-red-500":r.confirmPasswordError}]),placeholder:"Re-enter new password",disabled:r.loading},null,10,Y),[[a.Jo,r.confirmPassword]]),r.confirmPasswordError?((0,a.uX)(),(0,a.CE)("p",Z,(0,a.v_)(r.confirmPasswordError),1)):(0,a.Q3)("",!0),s[25]||(s[25]=(0,a.Lk)("p",{class:"mt-1 text-[11px] text-gray-500"}," After confirming, your password will be updated and you will be logged in automatically. ",-1)),(0,a.Lk)("button",{type:"button",class:"mt-4 w-full bg-blue-600 text-white py-2 rounded text-sm hover:bg-blue-700 disabled:opacity-50",disabled:r.loading||!r.newPassword||!r.confirmPassword,onClick:s[9]||(s[9]=(...e)=>r.handleResetPassword&&r.handleResetPassword(...e))},[r.loading?((0,a.uX)(),(0,a.CE)("span",ee,"Updating password...")):((0,a.uX)(),(0,a.CE)("span",se,"OK"))],8,G)]))])])):(0,a.Q3)("",!0)}var ae=t(981),re={name:"ForgotPasswordModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(e,{emit:s}){const r=(0,L.h)(),o=(0,a.KR)(1),l=(0,a.KR)(""),n=(0,a.KR)(""),i=(0,a.KR)(""),d=(0,a.KR)(""),u=(0,a.KR)(!1),c=(0,a.KR)(""),g=8,p=(0,a.EW)(()=>i.value&&i.value.length<g?`Password must be at least ${g} characters long.`:""),m=(0,a.EW)(()=>d.value&&i.value&&d.value!==i.value?"Passwords do not match.":""),h=(0,a.KR)(0);let b=null;const f=(0,a.EW)(()=>l.value?l.value.slice(-2):""),v=(0,a.EW)(()=>{if(!h.value)return"";const e=Math.floor(h.value/60),s=h.value%60,t=String(e).padStart(2,"0"),a=String(s).padStart(2,"0");return`${t}:${a}`}),w=()=>{b&&(clearInterval(b),b=null)},y=()=>{o.value=1,l.value="",n.value="",i.value="",d.value="",u.value=!1,c.value="",h.value=0,w()},x=()=>{u.value||(y(),s("close"))},k=async()=>{if(l.value){u.value=!0,c.value="";try{const e=await ae.authService.requestPasswordResetByPhone(l.value);if(!e.success){const s=e.errors||{};return void(s.phone&&Array.isArray(s.phone)&&s.phone.length?c.value=s.phone[0]:e.message&&e.message.toLowerCase().includes("not")&&e.message.toLowerCase().includes("found")?c.value="Phone number not found. Please enter the phone number registered in the system.":c.value=e.message||"Failed to send OTP. Please make sure the phone number is correct.")}o.value=2,h.value=180,b=setInterval(()=>{h.value>0?h.value-=1:w()},1e3)}catch(e){console.error("Error sending OTP:",e),c.value="Failed to send OTP. Please try again."}finally{u.value=!1}}else c.value="Please enter your registered phone number."},E=async()=>{if(6===n.value.length){u.value=!0,c.value="";try{const e=await ae.authService.verifyPasswordResetOtp({phone:l.value,otp:n.value});if(!e.success){const s=e.errors||{};return void(s.otp&&Array.isArray(s.otp)&&s.otp.length?c.value=s.otp[0]:e.message&&e.message.toLowerCase().includes("expired")?c.value="Your OTP has expired. Please request a new code and try again.":c.value=e.message||"The OTP you entered is incorrect. Please try again.")}o.value=3}catch(e){console.error("Error verifying OTP:",e),c.value="Failed to verify OTP. Please try again."}finally{u.value=!1}}else c.value="Please enter the 6-digit OTP code sent to your phone."},P=async()=>{if(i.value&&d.value)if(p.value||m.value)c.value="Please fix the highlighted password issues before continuing.";else{u.value=!0,c.value="";try{const e=await ae.authService.resetPasswordWithOtp({phone:l.value,otp:n.value,password:i.value,password_confirmation:d.value});if(!e.success||!e.data){const s=e.errors||{};return void(s.password&&Array.isArray(s.password)&&s.password.length?c.value=s.password[0]:s.otp&&Array.isArray(s.otp)&&s.otp.length?c.value=s.otp[0]:c.value=e.message||"Failed to update password. Please try again.")}const{user:a,token:o}=e.data;r.updateUser(a);const u=await Promise.resolve().then(t.bind(t,14)),g=u.useAuthStore();g.setAuthData({user:a,token:o}),y(),s("close")}catch(e){console.error("Error resetting password:",e),c.value="Failed to update password. Please try again."}finally{u.value=!1}}else c.value="Please enter and confirm your new password."},C=async()=>{!u.value&&l.value&&(n.value="",c.value="",await k())},S=()=>{u.value||(o.value=1,n.value="",c.value="",h.value=0,w())};return(0,a.wB)(()=>e.show,e=>{e?y():w()}),(0,a.xo)(()=>{w()}),{step:o,phoneNumber:l,otp:n,newPassword:i,confirmPassword:d,newPasswordError:p,confirmPasswordError:m,loading:u,errorMessage:c,phoneSuffix:f,otpCountdown:h,otpCountdownLabel:v,handleClose:x,handleSendOtp:k,handleVerifyOtp:E,handleResetPassword:P,handleResendOtp:C,goBackToPhone:S}}},oe=t(1241);const le=(0,oe.A)(re,[["render",te],["__scopeId","data-v-43137947"]]);var ne=le,ie={name:"LoginPage",components:{OrbitingDots:S.A,ForgotPasswordModal:ne},setup(){const{login:e,isLoading:s,error:t,clearError:r}=(0,L.h)(),o=(0,k.lq)(),l=(0,a.KR)(""),n=(0,a.KR)(""),i=(0,a.KR)(!0),d=(0,a.KR)(!1),u=(0,a.KR)(!1),c=(0,a.KR)(!1),g=()=>{const e=C.getSavedEmail();e&&(l.value=e,i.value=!0)},p=()=>{i.value&&l.value?C.saveEmail(l.value):C.clearSavedEmail()};(0,a.wB)(i,e=>{e?l.value&&p():C.clearSavedEmail()});const m=(0,a.EW)(()=>"access_denied"===o.query.error?"Access denied. You do not have permission to access that page.":t.value),h=async()=>{if(r(),!l.value||!n.value)return;d.value=!0,i.value&&p(),l.value,i.value;const s=await e({email:l.value,password:n.value});s.success?(u.value=!0,setTimeout(()=>{u.value=!1},3e3),n.value=""):(console.error("❌ Login failed:",s),t.value,m.value,n.value=""),d.value=!1},b=()=>{C.clearSavedEmail(),l.value="",i.value=!1},f=()=>{c.value=!0};return(0,a.sV)(()=>{r(),g()}),{email:l,password:n,rememberEmail:i,loading:d,errorMessage:m,isLoading:s,handleLogin:h,clearSavedEmail:b,handleForgotPassword:f,showForgotPassword:c,showSuccessSnackbar:u}}};const de=(0,oe.A)(ie,[["render",x],["__scopeId","data-v-02455687"]]);var ue=de,ce={name:"LoginPageWrapper",components:{LoginPage:ue}};const ge=(0,oe.A)(ce,[["render",r]]);var pe=ge},4247:function(e,s,t){t.d(s,{A:function(){return d}});var a=t(5796);const r={class:"center-logo"};function o(e,s,t,o,l,n){return(0,a.uX)(),(0,a.CE)("div",{class:(0,a.C4)(["orbiting-dots",n.sizeClass]),style:(0,a.Tr)(n.customSize)},[(0,a.Lk)("div",r,[(0,a.Lk)("img",{src:"/assets/images/logo2.png",alt:"Loading",class:"logo-img",onError:s[0]||(s[0]=(...e)=>n.handleImageError&&n.handleImageError(...e))},null,32)]),(0,a.Lk)("div",{class:"orbit",style:(0,a.Tr)(n.orbitStyle)},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(l.dots,(e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:`dot-${s}`,class:(0,a.C4)(`dot ${e.color}`),style:(0,a.Tr)(n.getDotStyle(s))},null,6))),128))],4)],6)}var l={name:"OrbitingDots",props:{size:{type:String,default:"sm"},customWidth:{type:Number,default:null},customHeight:{type:Number,default:null},speed:{type:Number,default:3}},data(){return{updateFrequency:50,dots:[{color:"logo-red"},{color:"logo-gold"},{color:"logo-white"},{color:"logo-red"},{color:"logo-gold"},{color:"logo-white"},{color:"logo-red"},{color:"logo-gold"},{color:"logo-white"},{color:"logo-red"},{color:"logo-gold"},{color:"logo-white"},{color:"logo-red"},{color:"logo-gold"},{color:"logo-white"},{color:"logo-red"},{color:"logo-gold"},{color:"logo-white"},{color:"logo-red"},{color:"logo-gold"},{color:"logo-white"},{color:"logo-red"},{color:"logo-gold"},{color:"logo-white"}]}},computed:{sizeClass(){return this.customWidth||this.customHeight?"":`size-${this.size}`},customSize(){return this.customWidth||this.customHeight?{width:this.customWidth?`${this.customWidth}px`:"auto",height:this.customHeight?`${this.customHeight}px`:"auto"}:{}},dotSpacing(){return 360/this.dots.length},orbitRadius(){if(this.customWidth)return Math.max(8,this.customWidth/4);switch(this.size){case"xs":return 6;case"sm":return 8;case"md":return 12;case"lg":return 16;case"xl":return 24;case"2xl":return 45;default:return 8}},currentContainerSize(){if(this.customWidth)return this.customWidth;switch(this.size){case"xs":return 16;case"sm":return 20;case"md":return 28;case"lg":return 36;case"xl":return 64;case"2xl":return 120;default:return 20}},durationSeconds(){const e=this.speed*(1e3/this.updateFrequency),s=e>0?360/e:1.5;return Math.max(.8,Math.min(s,4))},orbitStyle(){return{"--orbit-duration":`${this.durationSeconds}s`}}},methods:{getDotStyle(e){const s=e*this.dotSpacing,t=this.orbitRadius;return{top:"50%",left:"50%",transform:`translate(-50%, -50%) rotate(${s}deg) translateX(${t}px)`}},handleImageError(){const e=this.$el?.querySelector(".center-logo");e&&(e.style.display="none")}}},n=t(1241);const i=(0,n.A)(l,[["render",o],["__scopeId","data-v-088d0f9c"]]);var d=i}}]);
//# sourceMappingURL=auth.24e916ff.js.map