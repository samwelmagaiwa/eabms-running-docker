"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[981,5389,6700],{981:function(e,t,s){s.d(t,{authService:function(){return c}});var a=s(4373);const r="http://127.0.0.1:8000/api",i=a.A.create({baseURL:r,timeout:parseInt("30000")||1e4,headers:{"Content-Type":"application/json",Accept:"application/json"}});i.interceptors.request.use(e=>{const t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),i.interceptors.response.use(e=>e,e=>{const t=e.response?.status,s=(e.config?.method||"").toString().toLowerCase(),a=(e.config?.url||"").toString();if(401===t){const e="post"===s&&a.includes("/login");e||(localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),localStorage.removeItem("session_data"),window.location.href="/login")}return Promise.reject(e)});const c={async login(e){try{const t=await i.post("/login",e);return{success:!0,data:t.data}}catch(t){return{success:!1,message:t.response?.data?.message||"Login failed",errors:t.response?.data?.errors||{}}}},async logout(){try{const e=await i.post("/logout");return{success:!0,data:e.data}}catch(e){return{success:!0,message:"Logged out locally (API call failed)"}}},async logoutAll(){try{const e=await i.post("/logout-all");return{success:!0,data:e.data}}catch(e){return{success:!1,message:e.response?.data?.message||"Logout all failed"}}},async getCurrentUser(){try{const e=await i.get("/current-user");return{success:!0,data:e.data}}catch(e){return{success:!1,message:e.response?.data?.message||"Failed to get user data",status:e.response?.status}}},async getRoleBasedRedirect(){try{const e=await i.get("/role-redirect");return{success:!0,data:e.data}}catch(e){return{success:!1,message:e.response?.data?.message||"Failed to get redirect URL",status:e.response?.status}}},async getActiveSessions(){try{const e=await i.get("/active-sessions");return{success:!0,data:e.data}}catch(e){return{success:!1,message:e.response?.data?.message||"Failed to get active sessions"}}},async revokeSession(e){try{const t=await i.post("/revoke-session",{token_id:e});return{success:!0,data:t.data}}catch(t){return{success:!1,message:t.response?.data?.message||"Failed to revoke session"}}},async changePassword(e){try{const t=await i.post("/change-password",{current_password:e.current,password:e.new,password_confirmation:e.confirm});return{success:!0,data:t.data,message:t.data?.message||"Password changed successfully."}}catch(t){return{success:!1,message:t.response?.data?.message||"Failed to change password.",errors:t.response?.data?.errors||{}}}},async requestPasswordResetByPhone(e){try{const t=await i.post("/password-reset/request-by-phone",{phone:e});return{success:!0,data:t.data,message:t.data?.message}}catch(t){return{success:!1,message:t.response?.data?.message||"Failed to send OTP.",errors:t.response?.data?.errors||{}}}},async verifyPasswordResetOtp(e){try{const t=await i.post("/password-reset/verify-otp",{phone:e.phone,otp:e.otp});return{success:!0,data:t.data,message:t.data?.message}}catch(t){return{success:!1,message:t.response?.data?.message||"Failed to verify OTP.",errors:t.response?.data?.errors||{}}}},async resetPasswordWithOtp(e){try{const t=await i.post("/password-reset/reset-with-otp",{phone:e.phone,otp:e.otp,password:e.password,password_confirmation:e.password_confirmation});return{success:!0,data:t.data?.data,message:t.data?.message}}catch(t){return{success:!1,message:t.response?.data?.message||"Failed to reset password.",errors:t.response?.data?.errors||{}}}}};t["default"]=c},5356:function(e,t,s){s.r(t),s.d(t,{default:function(){return Oe}});var a=s(5796);const r={class:"flex flex-col h-screen"},i={key:0,class:"fixed top-4 right-4 bg-green-500 text-white px-4 py-3 rounded-lg shadow-xl max-w-sm",style:{"z-index":"9999"}},c={class:"flex items-center justify-between"},o={class:"flex flex-1 overflow-hidden"},n={class:"flex-1 p-6 bg-gradient-to-br from-blue-900 via-blue-800 to-teal-900 overflow-y-auto relative"},d={class:"absolute inset-0 overflow-hidden"},l={class:"absolute inset-0 opacity-5"},u={class:"grid grid-cols-12 gap-8 h-full transform rotate-45"},g={class:"absolute inset-0"},f={class:"max-w-full mx-auto relative z-10"},m={class:"medical-glass-card rounded-t-3xl p-4 mb-0 border-b border-blue-300/30"},p={class:"flex items-center justify-between"},h={class:"text-center"},w={class:"text-blue-200 text-sm"},v={class:"text-right"},b={class:"flex items-center"},y={class:"text-white text-sm font-medium"},_={class:"medical-glass-card rounded-b-3xl overflow-hidden"},k={class:"p-6"},x={key:0,class:"flex items-center justify-center py-16"},q={key:1,class:"p-8 text-center"},S={class:"text-blue-200 mb-4"},L={key:2,class:"p-4 bg-blue-900/30 border border-blue-500/30 rounded-lg mb-6"},I={class:"text-sm"},D={class:"mt-2 p-2 bg-gray-800 text-green-400 rounded text-xs overflow-auto"},O={key:3},C={class:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8"},A={class:"space-y-6"},F={class:"medical-card bg-gradient-to-r from-blue-600/25 to-cyan-600/25 border-2 border-blue-400/40 rounded-xl p-6"},E={class:"space-y-3"},N={class:"flex justify-between"},P={class:"font-semibold text-white"},R={class:"flex justify-between"},T={class:"font-semibold text-white"},$={class:"flex justify-between"},j={class:"font-semibold text-white"},M={class:"flex justify-between"},X={class:"font-semibold text-white"},B={class:"space-y-6"},U={class:"medical-card bg-gradient-to-r from-green-600/25 to-emerald-600/25 border-2 border-green-400/40 rounded-xl p-6"},W={class:"space-y-3"},G={class:"flex justify-between"},H={class:"px-3 py-1 bg-green-600/30 text-green-200 rounded-full text-sm font-medium border border-green-400/40"},J={class:"flex justify-between"},z={class:"font-semibold text-white"},Q={class:"flex justify-between"},K={class:"font-semibold text-white"},V={class:"mb-8"},Y={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Z={class:"medical-card bg-gradient-to-r from-blue-600/25 to-blue-600/25 border-2 border-blue-400/40 rounded-xl p-6"},ee={key:0,class:"space-y-2"},te={key:1,class:"text-blue-300 italic text-sm"},se={class:"medical-card bg-gradient-to-r from-cyan-600/25 to-cyan-600/25 border-2 border-cyan-400/40 rounded-xl p-6"},ae={key:0,class:"space-y-2"},re={key:1,class:"text-cyan-300 italic text-sm"},ie={class:"medical-card bg-gradient-to-r from-green-600/25 to-green-600/25 border-2 border-green-400/40 rounded-xl p-6"},ce={key:0,class:"space-y-2"},oe={class:"w-4 h-4 bg-green-600/30 text-green-200 rounded-full flex items-center justify-center text-xs mr-2 border border-green-400/40"},ne={key:1,class:"text-green-300 italic text-sm"},de={class:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8"},le={key:0,class:"flex flex-col"},ue={class:"flex-1 px-4 py-3 bg-blue-900/30 border border-blue-400/40 rounded-lg text-white leading-relaxed overflow-y-auto",style:{"min-height":"120px","max-height":"120px"}},ge={key:1,class:"flex flex-col"},fe=["readonly"],me={key:0,class:"flex justify-center"},pe=["disabled"],he={key:0,class:"fas fa-spinner fa-spin mr-3"},we={key:1,class:"fas fa-key mr-3"},ve={key:0,class:"fixed bottom-4 right-4 bg-green-600 text-white rounded-lg shadow-lg px-6 py-4 z-50"},be={class:"flex items-center"};function ye(e,t,s,ye,_e,ke){const xe=(0,a.g2)("Header"),qe=(0,a.g2)("ModernSidebar");return(0,a.uX)(),(0,a.CE)("div",r,[(0,a.bF)(a.eB,{name:"slide-down"},{default:(0,a.k6)(()=>[_e.showSuccessNotification?((0,a.uX)(),(0,a.CE)("div",i,[(0,a.Lk)("div",c,[t[6]||(t[6]=(0,a.Lk)("div",{class:"flex items-center"},[(0,a.Lk)("i",{class:"fas fa-check-circle text-lg mr-3"}),(0,a.Lk)("div",null,[(0,a.Lk)("h3",{class:"font-semibold text-base"},"Access Granted Successfully!"),(0,a.Lk)("p",{class:"text-green-100 text-sm"}," Your access request has been processed and access has been granted. ")])],-1)),(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>ke.hideSuccessNotification&&ke.hideSuccessNotification(...e)),class:"text-white hover:text-green-200 transition-colors ml-3 flex-shrink-0"},[...t[5]||(t[5]=[(0,a.Lk)("i",{class:"fas fa-times text-sm"},null,-1)])])])])):(0,a.Q3)("",!0)]),_:1}),(0,a.bF)(xe),(0,a.Lk)("div",o,[(0,a.bF)(qe),(0,a.Lk)("main",n,[(0,a.Lk)("div",d,[(0,a.Lk)("div",l,[(0,a.Lk)("div",u,[((0,a.uX)(),(0,a.CE)(a.FK,null,(0,a.pI)(48,e=>(0,a.Lk)("div",{key:e,class:"bg-white rounded-full w-2 h-2 animate-pulse",style:(0,a.Tr)({animationDelay:.1*e+"s"})},null,4)),64))])]),(0,a.Lk)("div",g,[((0,a.uX)(),(0,a.CE)(a.FK,null,(0,a.pI)(15,e=>(0,a.Lk)("div",{key:e,class:"absolute text-white opacity-10 animate-float",style:(0,a.Tr)({left:100*Math.random()+"%",top:100*Math.random()+"%",animationDelay:3*Math.random()+"s",animationDuration:3*Math.random()+2+"s",fontSize:20*Math.random()+10+"px"})},[(0,a.Lk)("i",{class:(0,a.C4)(["fas",["fa-laptop-code","fa-server","fa-network-wired","fa-shield-alt","fa-cogs"][Math.floor(5*Math.random())]])},null,2)],4)),64))])]),(0,a.Lk)("div",f,[(0,a.Lk)("div",m,[(0,a.Lk)("div",p,[(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>ke.goBack&&ke.goBack(...e)),class:"flex items-center px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-all duration-200 backdrop-blur-sm"},[...t[7]||(t[7]=[(0,a.Lk)("i",{class:"fas fa-arrow-left mr-2"},null,-1),(0,a.eW)(" Back ",-1)])]),(0,a.Lk)("div",h,[t[8]||(t[8]=(0,a.Lk)("h1",{class:"text-xl font-bold text-blue-100 mb-1"},"User Security Access",-1)),(0,a.Lk)("p",w,"Request ID: "+(0,a.v_)(ke.requestId),1)]),(0,a.Lk)("div",v,[(0,a.Lk)("div",b,[t[9]||(t[9]=(0,a.Lk)("i",{class:"fas fa-circle text-green-300 text-xs mr-2"},null,-1)),(0,a.Lk)("span",y,(0,a.v_)(ke.currentStatus),1)])])])]),(0,a.Lk)("div",_,[(0,a.Lk)("div",k,[_e.loading?((0,a.uX)(),(0,a.CE)("div",x,[...t[10]||(t[10]=[(0,a.Lk)("div",{class:"text-center"},[(0,a.Lk)("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-300 mx-auto mb-4"}),(0,a.Lk)("p",{class:"text-blue-200"},"Loading access request details...")],-1)])])):_e.error?((0,a.uX)(),(0,a.CE)("div",q,[t[12]||(t[12]=(0,a.Lk)("div",{class:"text-red-400 mb-4"},[(0,a.Lk)("i",{class:"fas fa-exclamation-triangle text-3xl"})],-1)),t[13]||(t[13]=(0,a.Lk)("h3",{class:"text-xl font-semibold text-white mb-2"},"Error Loading Request",-1)),(0,a.Lk)("p",S,(0,a.v_)(_e.error),1),(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>ke.loadRequestData&&ke.loadRequestData(...e)),class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},[...t[11]||(t[11]=[(0,a.Lk)("i",{class:"fas fa-redo mr-2"},null,-1),(0,a.eW)(" Retry ",-1)])])])):_e.requestData&&e.$route.query.debug?((0,a.uX)(),(0,a.CE)("div",L,[(0,a.Lk)("details",I,[t[14]||(t[14]=(0,a.Lk)("summary",{class:"font-semibold cursor-pointer text-blue-200"}," Debug: Raw Request Data ",-1)),(0,a.Lk)("pre",D,(0,a.v_)(JSON.stringify(_e.requestData,null,2)),1)])])):_e.requestData?((0,a.uX)(),(0,a.CE)("div",O,[(0,a.Lk)("div",C,[(0,a.Lk)("div",A,[(0,a.Lk)("div",F,[t[19]||(t[19]=(0,a.Lk)("h3",{class:"text-lg font-semibold text-white mb-4 flex items-center"},[(0,a.Lk)("i",{class:"fas fa-user mr-2"}),(0,a.eW)(" Requester Information ")],-1)),(0,a.Lk)("div",E,[(0,a.Lk)("div",N,[t[15]||(t[15]=(0,a.Lk)("span",{class:"text-blue-200"},"PF Number:",-1)),(0,a.Lk)("span",P,(0,a.v_)(_e.requestData.shared?.pfNumber||_e.requestData.pf_number||_e.requestData.pfNumber||"N/A"),1)]),(0,a.Lk)("div",R,[t[16]||(t[16]=(0,a.Lk)("span",{class:"text-blue-200"},"Staff Name:",-1)),(0,a.Lk)("span",T,(0,a.v_)(_e.requestData.shared?.staffName||_e.requestData.staff_name||_e.requestData.staffName||_e.requestData.name||"N/A"),1)]),(0,a.Lk)("div",$,[t[17]||(t[17]=(0,a.Lk)("span",{class:"text-blue-200"},"Department:",-1)),(0,a.Lk)("span",j,(0,a.v_)(_e.requestData.shared?.department||_e.requestData.department||_e.requestData.dept||"N/A"),1)]),(0,a.Lk)("div",M,[t[18]||(t[18]=(0,a.Lk)("span",{class:"text-blue-200"},"Contact:",-1)),(0,a.Lk)("span",X,(0,a.v_)(_e.requestData.shared?.phone||_e.requestData.phone||_e.requestData.contact||"N/A"),1)])])])]),(0,a.Lk)("div",B,[(0,a.Lk)("div",U,[t[23]||(t[23]=(0,a.Lk)("h3",{class:"text-lg font-semibold text-white mb-4 flex items-center"},[(0,a.Lk)("i",{class:"fas fa-check-circle mr-2"}),(0,a.eW)(" Current Status ")],-1)),(0,a.Lk)("div",W,[(0,a.Lk)("div",G,[t[20]||(t[20]=(0,a.Lk)("span",{class:"text-green-200"},"Status:",-1)),(0,a.Lk)("span",H,(0,a.v_)(ke.getStatusLabel(_e.requestData.status)),1)]),(0,a.Lk)("div",J,[t[21]||(t[21]=(0,a.Lk)("span",{class:"text-green-200"},"Progress:",-1)),(0,a.Lk)("span",z,(0,a.v_)(ke.getProgress()),1)]),(0,a.Lk)("div",Q,[t[22]||(t[22]=(0,a.Lk)("span",{class:"text-green-200"},"Last Updated:",-1)),(0,a.Lk)("span",K,(0,a.v_)(ke.formatDate(_e.requestData.updated_at)),1)])])])])]),(0,a.Lk)("div",V,[t[29]||(t[29]=(0,a.Lk)("h3",{class:"text-xl font-semibold text-white mb-6 flex items-center"},[(0,a.Lk)("i",{class:"fas fa-th-large mr-2 text-blue-300"}),(0,a.eW)(" Modules Selected ")],-1)),(0,a.Lk)("div",Y,[(0,a.Lk)("div",Z,[t[25]||(t[25]=(0,a.Lk)("h4",{class:"text-lg font-semibold text-white mb-4 flex items-center"},[(0,a.Lk)("i",{class:"fas fa-laptop mr-2"}),(0,a.eW)(" Wellsoft Modules ")],-1)),ke.wellsoftModules.length>0?((0,a.uX)(),(0,a.CE)("div",ee,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ke.wellsoftModules,e=>((0,a.uX)(),(0,a.CE)("div",{key:e,class:"flex items-center text-sm text-blue-200"},[t[24]||(t[24]=(0,a.Lk)("i",{class:"fas fa-check text-blue-400 mr-2 text-xs"},null,-1)),(0,a.eW)(" "+(0,a.v_)(e),1)]))),128))])):((0,a.uX)(),(0,a.CE)("p",te," No Wellsoft modules requested "))]),(0,a.Lk)("div",se,[t[27]||(t[27]=(0,a.Lk)("h4",{class:"text-lg font-semibold text-white mb-4 flex items-center"},[(0,a.Lk)("i",{class:"fas fa-box mr-2"}),(0,a.eW)(" Jeeva Modules ")],-1)),ke.jeevaModules.length>0?((0,a.uX)(),(0,a.CE)("div",ae,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ke.jeevaModules,e=>((0,a.uX)(),(0,a.CE)("div",{key:e,class:"flex items-center text-sm text-cyan-200"},[t[26]||(t[26]=(0,a.Lk)("i",{class:"fas fa-check text-cyan-400 mr-2 text-xs"},null,-1)),(0,a.eW)(" "+(0,a.v_)(e),1)]))),128))])):((0,a.uX)(),(0,a.CE)("p",re,"No Jeeva modules requested"))]),(0,a.Lk)("div",ie,[t[28]||(t[28]=(0,a.Lk)("h4",{class:"text-lg font-semibold text-white mb-4 flex items-center"},[(0,a.Lk)("i",{class:"fas fa-globe mr-2"}),(0,a.eW)(" Internet Purposes ")],-1)),ke.internetPurposes.length>0?((0,a.uX)(),(0,a.CE)("div",ce,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ke.internetPurposes,(e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:"flex items-center text-sm text-green-200"},[(0,a.Lk)("span",oe,(0,a.v_)(t+1),1),(0,a.eW)(" "+(0,a.v_)(e),1)]))),128))])):((0,a.uX)(),(0,a.CE)("p",ne," No internet purposes specified "))])])]),(0,a.Lk)("div",de,[ke.hodComments?((0,a.uX)(),(0,a.CE)("div",le,[t[30]||(t[30]=(0,a.Lk)("h3",{class:"text-xl font-semibold text-white mb-4 flex items-center"},[(0,a.Lk)("i",{class:"fas fa-comment mr-2 text-yellow-400"}),(0,a.eW)(" Head of Department Comments ")],-1)),(0,a.Lk)("div",ue,(0,a.v_)(ke.hodComments),1)])):(0,a.Q3)("",!0),ke.isIctOfficer?((0,a.uX)(),(0,a.CE)("div",ge,[t[31]||(t[31]=(0,a.Lk)("h3",{class:"text-xl font-semibold text-white mb-4 flex items-center"},[(0,a.Lk)("i",{class:"fas fa-comment-dots mr-2 text-blue-300"}),(0,a.eW)(" ICT Officer Comments ")],-1)),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>_e.ictOfficerComments=e),rows:"4",class:"flex-1 px-4 py-3 bg-blue-900/30 border border-blue-400/40 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 resize-none text-white placeholder-blue-300",placeholder:"Add your implementation comments or notes here...",readonly:!ke.isIctOfficer||ke.isReadOnly,style:{"min-height":"120px","max-height":"120px"}},null,8,fe),[[a.Jo,_e.ictOfficerComments]])])):(0,a.Q3)("",!0)]),ke.isIctOfficer&&!ke.isReadOnly?((0,a.uX)(),(0,a.CE)("div",me,[(0,a.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>ke.grantAccessNow&&ke.grantAccessNow(...e)),disabled:_e.granting,class:"px-8 py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold text-lg rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 flex items-center disabled:opacity-50 disabled:cursor-not-allowed border border-blue-400/40"},[_e.granting?((0,a.uX)(),(0,a.CE)("i",he)):((0,a.uX)(),(0,a.CE)("i",we)),(0,a.eW)(" "+(0,a.v_)(_e.granting?"Granting Access...":"Grant Access Now"),1)],8,pe)])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)])])])])]),(0,a.bF)(a.eB,{name:"fade"},{default:(0,a.k6)(()=>[_e.toast.show?((0,a.uX)(),(0,a.CE)("div",ve,[(0,a.Lk)("div",be,[t[32]||(t[32]=(0,a.Lk)("i",{class:"fas fa-check-circle mr-3"},null,-1)),(0,a.eW)(" "+(0,a.v_)(_e.toast.message),1)])])):(0,a.Q3)("",!0)]),_:1})])}s(4114),s(8111),s(2489),s(1701);var _e=s(6933),ke=s(8966),xe=s(460),qe=s(5389),Se=s(981),Le={name:"UserSecurityAccess",components:{Header:_e.A,ModernSidebar:ke.A},data(){return{requestData:null,loading:!0,error:null,granting:!1,ictOfficerComments:"",showSuccessNotification:!1,dataRefreshTimestamp:Date.now(),toast:{show:!1,message:""}}},computed:{requestId(){return this.$route.params.id},isIctOfficer(){const e=this.$route.query.role,t=Se["default"].getCurrentUser();return"ict_officer"===e||t&&"ict_officer"===t.role},isReadOnly(){const e="implemented"===this.requestData?.status||"approved"===this.requestData?.status;return!this.isIctOfficer||e},currentStatus(){if(this.dataRefreshTimestamp,!this.requestData)return"Loading...";if(this.dataRefreshTimestamp,this.requestData.workflow_stage,this.requestData.status,this.requestData.ict_officer_status,this.requestData.workflow_stage)return this.requestData.workflow_stage,this.requestData.workflow_stage;const e=this.getStatusLabel(null);return e},wellsoftModules(){if(!this.requestData)return[];const e=this.requestData.wellsoft_modules_selected||this.requestData.wellsoft_modules||this.requestData.wellsoft||this.requestData.wellsoftModules||[];if("string"===typeof e)try{return JSON.parse(e).filter(e=>e&&e.trim())}catch{return e.split(",").map(e=>e.trim()).filter(e=>e)}return Array.isArray(e)?e.filter(e=>e&&e.trim()):[]},jeevaModules(){if(!this.requestData)return[];const e=this.requestData.jeeva_modules_selected||this.requestData.jeeva_modules||this.requestData.jeeva||this.requestData.jeevaModules||[];if("string"===typeof e)try{return JSON.parse(e).filter(e=>e&&e.trim())}catch{return e.split(",").map(e=>e.trim()).filter(e=>e)}return Array.isArray(e)?e.filter(e=>e&&e.trim()):[]},internetPurposes(){if(!this.requestData)return[];const e=this.requestData.internet_purposes||this.requestData.internet||this.requestData.internetPurposes||[];if(!e)return[];if(Array.isArray(e))return e.filter(e=>e&&e.trim&&e.trim());if("string"===typeof e)try{const t=JSON.parse(e);return Array.isArray(t)?t.filter(e=>e&&e.trim&&e.trim()):[e]}catch{return e.split(",").map(e=>e.trim()).filter(e=>e)}return[]},hodComments(){return this.requestData?.shared?.hod_comments||this.requestData?.hod_comments||this.requestData?.approvals?.hod?.comments||this.requestData?.approval_workflow?.hod?.comments||"No comments provided"}},async mounted(){await this.loadRequestData(),this.checkAndShowSuccessNotification()},methods:{async loadRequestData(){this.loading=!0,this.error=null;try{this.requestId;let e=await xe.A.getRequestById(this.requestId);if(e.success&&e.data)this.requestData=e.data,this.requestData,this.requestData.status,this.requestData.ict_officer_status,this.requestData.ict_officer_implemented_at,this.requestData.head_it_status,this.getStatusLabel(this.requestData.status);else{console.warn("Failed to load from combinedAccessService, trying ICT Officer service...");const e=await qe["default"].getAccessRequestById(this.requestId);e.success&&e.data?(this.requestData=e.data,this.requestData,this.requestData.status,this.requestData.ict_officer_status,this.requestData.ict_officer_implemented_at,this.requestData.head_it_status,this.getStatusLabel(this.requestData.status)):(console.warn("Both services failed, using mock data for testing..."),this.requestData=this.generateMockData(),this.requestData)}}catch(e){console.error("Error loading request data:",e),this.error=e.message||"Failed to load request data"}finally{this.loading=!1}},async grantAccessNow(){if(!this.granting){this.granting=!0;try{this.requestId,this.ictOfficerComments;const e=await qe["default"].grantAccess(this.requestId,{comments:this.ictOfficerComments,status:"implemented",grantedAt:(new Date).toISOString()});if(!e.success)throw new Error(e.error||"Failed to grant access");await this.loadRequestData(),this.updateBadgeCountLocally(),this.refreshNotificationBadges(),setTimeout(()=>{this.refreshNotificationBadges()},2e3),setTimeout(()=>{this.refreshNotificationBadges()},4e3),setTimeout(()=>{this.refreshNotificationBadges()},6e3),this.toast={show:!0,message:"Access granted successfully!"},setTimeout(()=>{this.toast.show=!1,this.refreshNotificationBadges(),setTimeout(()=>{this.refreshNotificationBadges(),setTimeout(()=>{this.$router.push("/ict-dashboard/access-requests")},1e3)},500)},2e3)}catch(e){console.error("Error granting access:",e),this.toast={show:!0,message:"Error: "+e.message},setTimeout(()=>{this.toast.show=!1},5e3)}finally{this.granting=!1}}},getStatusLabel(e){const t=this.requestData;if(t?.workflow_stage)return t.workflow_stage,t.workflow_stage;if("implemented"===t?.ict_officer_status)return"Access Granted";if("implemented"===t?.status)return"Access Granted";if(!0===t?.implementation?.ictOfficer?.is_implemented)return"Access Granted";const s=t?.status?.toLowerCase();if(s&&(s.includes("access granted")||s.includes("implemented")||s.includes("completed")))return"Access Granted";const a=t?.ict_officer_implemented_at;if(a&&!a.includes("-000001")&&!a.includes("1970-01-01"))return"Access Granted";if("approved"===t?.head_it_status&&("pending"===t?.ict_officer_status||!t?.ict_officer_status))return"Pending ICT Officer Implementation";if("approved"===t?.ict_director_status&&("pending"===t?.head_it_status||!t?.head_it_status))return"Pending Head IT Approval";if("approved"===t?.divisional_status&&("pending"===t?.ict_director_status||!t?.ict_director_status))return"Pending ICT Director Approval";if("approved"===t?.hod_status&&("pending"===t?.divisional_status||!t?.divisional_status))return"Pending Divisional Director Approval";if("pending"===t?.hod_status||!t?.hod_status)return"Pending HOD Approval";const r={pending:"Pending Approval",hod_approved:"HOD Approved",divisional_approved:"Divisional Approved",ict_director_approved:"ICT Director Approved",head_it_approved:"Head IT Approved",pending_ict_officer:"Pending ICT Officer",assigned_to_ict:"Assigned to ICT Officer",implementation_in_progress:"Implementation In Progress",implemented:"Access Granted",approved:"Access Granted",completed:"Access Granted",rejected:"Rejected"};return r[e]||e?.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())||"Pending Approval"},getProgress(){if(!this.requestData)return"0%";const e=this.requestData;if(void 0!==e.approval_progress)return e.approval_progress+"%";let t=0;if("approved"===e.hod_status&&e.hod_approved_at&&(t=20),"approved"===e.divisional_status&&e.divisional_approved_at&&(t=40),"approved"===e.ict_director_status&&e.ict_director_approved_at&&(t=60),"approved"===e.head_it_status&&e.head_it_approved_at&&(t=80),"implemented"===e.ict_officer_status||"implemented"===e.status){const s=e.ict_officer_implemented_at;t=!s||s.includes("-000001")||s.includes("1970-01-01")?"implemented"===e.ict_officer_status||"implemented"===e.status?100:90:100}return t+"%"},formatDate(e){if(!e)return"N/A";try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return e}},checkAndShowSuccessNotification(){if(this.isReadOnly&&this.requestData){const e=this.requestData,t="implemented"===e?.ict_officer_status||"implemented"===e?.status||e?.ict_officer_implemented_at&&!e?.ict_officer_implemented_at.includes("-000001")&&!e?.ict_officer_implemented_at.includes("1970-01-01"),s=this.getStatusLabel(e?.status||"");(t||"Access Granted"===s||s.includes("Granted"))&&(this.showSuccessNotification=!0,setTimeout(()=>{this.hideSuccessNotification()},8e3))}},hideSuccessNotification(){this.showSuccessNotification=!1},goBack(){this.$router.go(-1)},async refreshNotificationBadges(){try{if(window.dispatchEvent){const e=new CustomEvent("force-refresh-notifications",{detail:{source:"UserSecurityAccess",reason:"access_granted",timestamp:Date.now()}});window.dispatchEvent(e);const t=new CustomEvent("refresh-notifications",{detail:{source:"UserSecurityAccess",reason:"access_granted",timestamp:Date.now()}});window.dispatchEvent(t)}window.sidebarInstance&&window.sidebarInstance.fetchNotificationCounts&&window.sidebarInstance.fetchNotificationCounts(!0);try{const e=(await s.e(4710).then(s.bind(s,4710))).default;e.clearCache&&e.clearCache(),setTimeout(async()=>{try{e.getPendingRequestsCount&&(await e.getPendingRequestsCount(!0),e.clearCache&&e.clearCache(),await e.getPendingRequestsCount(!0))}catch(t){console.warn("Failed during aggressive notification refresh:",t)}},500)}catch(e){console.warn("Failed to refresh via notification service:",e)}this.$root&&this.$root.$emit&&this.$root.$emit("force-refresh-notifications",{reason:"access_granted"})}catch(t){console.error("âŒ Failed to refresh notification badges:",t)}},updateBadgeCountLocally(){try{if(window.sidebarInstance&&window.sidebarInstance.notificationCounts){const e=window.sidebarInstance.notificationCounts,t="/ict-dashboard/access-requests";e[t]&&e[t]>0&&(e[t]=Math.max(0,e[t]-1),e[t],window.sidebarInstance.forceUpdate&&window.sidebarInstance.forceUpdate())}window.Vue&&window.Vue.observable}catch(e){console.warn("Failed to update badge count locally:",e)}},generateMockData(){return{id:this.requestId,pf_number:"PF12345",staff_name:"John Doe",department:"ICT Department",phone:"+256-700-123456",status:"pending_ict_officer",wellsoft_modules:["OPD","IPD","Pharmacy","Laboratory"],jeeva_modules:["Accounting","HR","Procurement"],internet_purposes:["Email communication","Research purposes","Official documentation"],hod_comments:"Staff requires access for daily operations. Approved by HOD.",comments:"All requested modules are necessary for the staff role.",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),request_type:"combined_access",services:["jeeva","wellsoft","internet"]}}}},Ie=s(1241);const De=(0,Ie.A)(Le,[["render",ye],["__scopeId","data-v-70ed0af4"]]);var Oe=De},5389:function(e,t,s){s.r(t);s(4603),s(7566),s(8721);var a=s(4373),r=s(8998);const i="http://127.0.0.1:8000/api",c=a.A.create({baseURL:i,timeout:0,headers:{"Content-Type":"application/json",Accept:"application/json"}});c.interceptors.request.use(e=>{const t=localStorage.getItem("auth_token");if(t&&(e.headers.Authorization=`Bearer ${t}`),e.method&&"get"===e.method.toLowerCase())try{const t=new URL(e.url,e.baseURL);t.searchParams.set("_cb",String(Date.now())),e.url=t.pathname+t.search}catch(s){const t=(e.url||"").includes("?")?"&":"?";e.url=`${e.url}${t}_cb=${Date.now()}`}return e},e=>Promise.reject(e)),c.interceptors.response.use(e=>e,e=>{const t=e.response?.status;if(401===t&&(localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),localStorage.removeItem("session_data"),"undefined"!==typeof window)){const e=window.location.pathname||"";"/"!==e&&"/login"!==e&&(window.location.href="/")}return Promise.reject(e)});const o={async getAccessRequests(){try{r.gg.debug("ðŸ”„ IctOfficerService: Fetching access requests...");const e=await c.get("/ict-officer/access-requests");return e.data.success?(r.gg.debug("âœ… IctOfficerService: Access requests loaded successfully"),{success:!0,data:e.data.data,message:e.data.message}):(r.gg.error("âŒ IctOfficerService: Failed to load access requests:",e.data.message),{success:!1,message:e.data.message||"Failed to load access requests"})}catch(e){return r.gg.error("âŒ IctOfficerService: Error fetching access requests:",e),{success:!1,message:e.response?.data?.message||"Network error while loading access requests"}}},async getAccessRequestById(e){try{r.gg.debug("ðŸ”„ IctOfficerService: Fetching access request by ID:",e);const t=await c.get(`/ict-officer/access-requests/${e}`);return t.data.success?(r.gg.debug("âœ… IctOfficerService: Access request loaded successfully"),{success:!0,data:t.data.data,message:t.data.message}):(r.gg.error("âŒ IctOfficerService: Failed to load access request:",t.data.message),{success:!1,message:t.data.message||"Failed to load access request"})}catch(t){return r.gg.error("âŒ IctOfficerService: Error fetching access request:",t),{success:!1,message:t.response?.data?.message||"Network error while loading access request"}}},async assignTaskToSelf(e,t=""){try{r.gg.debug("ðŸ”„ IctOfficerService: Assigning task to self:",e);const s=await c.post(`/ict-officer/access-requests/${e}/assign`,{notes:t});return s.data.success?(r.gg.debug("âœ… IctOfficerService: Task assigned successfully"),{success:!0,data:s.data.data,message:s.data.message}):(r.gg.error("âŒ IctOfficerService: Failed to assign task:",s.data.message),{success:!1,message:s.data.message||"Failed to assign task"})}catch(s){return r.gg.error("âŒ IctOfficerService: Error assigning task:",s),{success:!1,message:s.response?.data?.message||"Network error while assigning task"}}},async updateProgress(e,t,s=""){try{r.gg.debug("ðŸ”„ IctOfficerService: Updating progress:",e,t);const a=await c.put(`/ict-officer/access-requests/${e}/progress`,{status:t,notes:s});return a.data.success?(r.gg.debug("âœ… IctOfficerService: Progress updated successfully"),{success:!0,data:a.data.data,message:a.data.message}):(r.gg.error("âŒ IctOfficerService: Failed to update progress:",a.data.message),{success:!1,message:a.data.message||"Failed to update progress"})}catch(a){return r.gg.error("âŒ IctOfficerService: Error updating progress:",a),{success:!1,message:a.response?.data?.message||"Network error while updating progress"}}},async updateImplementationProgress(e,t,s=""){try{r.gg.debug("ðŸ”„ IctOfficerService: Updating implementation progress:",e,t);const a={implementation_status:t,implementation_comments:s};"implementation_in_progress"===t?a.ict_officer_started_at=(new Date).toISOString():"implemented"===t&&(a.ict_officer_implemented_at=(new Date).toISOString());const i=await c.put(`/ict-officer/access-requests/${e}/implementation`,a);return i.data.success?(r.gg.debug("âœ… IctOfficerService: Implementation progress updated successfully"),{success:!0,data:i.data.data,message:i.data.message||"Implementation progress updated successfully"}):(r.gg.error("âŒ IctOfficerService: Failed to update implementation progress:",i.data.message),{success:!1,message:i.data.message||"Failed to update implementation progress"})}catch(a){return r.gg.error("âŒ IctOfficerService: Error updating implementation progress:",a),{success:!1,message:a.response?.data?.message||"Network error while updating implementation progress"}}},async cancelTask(e,t){try{r.gg.debug("ðŸ”„ IctOfficerService: Canceling task:",e);const s=await c.post(`/ict-officer/access-requests/${e}/cancel`,{reason:t});return s.data.success?(r.gg.debug("âœ… IctOfficerService: Task canceled successfully"),{success:!0,data:s.data.data,message:s.data.message}):(r.gg.error("âŒ IctOfficerService: Failed to cancel task:",s.data.message),{success:!1,message:s.data.message||"Failed to cancel task"})}catch(s){return r.gg.error("âŒ IctOfficerService: Error canceling task:",s),{success:!1,message:s.response?.data?.message||"Network error while canceling task"}}},async completeImplementation(e,t="",s=null){try{r.gg.debug("ðŸ”„ IctOfficerService: Completing implementation:",e);const a=new FormData;a.append("notes",t),s&&a.append("signature",s);const i=await c.post(`/ict-officer/access-requests/${e}/complete`,a,{headers:{"Content-Type":"multipart/form-data"}});return i.data.success?(r.gg.debug("âœ… IctOfficerService: Implementation completed successfully"),{success:!0,data:i.data.data,message:i.data.message}):(r.gg.error("âŒ IctOfficerService: Failed to complete implementation:",i.data.message),{success:!1,message:i.data.message||"Failed to complete implementation"})}catch(a){return r.gg.error("âŒ IctOfficerService: Error completing implementation:",a),{success:!1,message:a.response?.data?.message||"Network error while completing implementation"}}},async getRequestTimeline(e){try{r.gg.debug("ðŸ”„ IctOfficerService: Fetching request timeline:",e);const t=await c.get(`/ict-officer/access-requests/${e}/timeline`);if(t.data.success)return r.gg.debug("âœ… IctOfficerService: Request timeline loaded successfully"),t.data.data;throw r.gg.error("âŒ IctOfficerService: Failed to load request timeline:",t.data.message),new Error(t.data.message||"Failed to load request timeline")}catch(t){throw r.gg.error("âŒ IctOfficerService: Error fetching request timeline:",t),t.response?new Error(t.response.data?.message||"Failed to load timeline data"):new Error("Network error while loading timeline")}},async getAccessRequestTimeline(e){try{r.gg.debug("ðŸ”„ IctOfficerService: Fetching access request timeline:",e);const t=await c.get(`/ict-officer/access-requests/${e}/timeline`);return t.data.success?(r.gg.debug("âœ… IctOfficerService: Access request timeline loaded successfully"),{success:!0,data:t.data.data,message:t.data.message}):(r.gg.error("âŒ IctOfficerService: Failed to load access request timeline:",t.data.message),{success:!1,message:t.data.message||"Failed to load access request timeline"})}catch(t){return r.gg.error("âŒ IctOfficerService: Error fetching access request timeline:",t),{success:!1,message:t.response?.data?.message||"Network error while loading access request timeline"}}},async grantAccess(e,t){try{r.gg.debug("ðŸ”„ IctOfficerService: Granting access for request:",e),r.gg.debug("Grant access data:",t);const s=await c.post(`/ict-officer/access-requests/${e}/grant-access`,{comments:t.comments||"",implementation_status:"implemented",implementation_completed_at:(new Date).toISOString()});return s.data.success?(r.gg.debug("âœ… IctOfficerService: Access granted successfully"),{success:!0,data:s.data.data,message:s.data.message||"Access granted successfully"}):(r.gg.error("âŒ IctOfficerService: Failed to grant access:",s.data.message),{success:!1,message:s.data.message||"Failed to grant access"})}catch(s){return r.gg.error("âŒ IctOfficerService: Error granting access:",s),{success:!1,message:s.response?.data?.message||"Network error while granting access"}}},async getStatistics(){try{r.gg.debug("ðŸ”„ IctOfficerService: Fetching statistics...");const e=await c.get("/ict-officer/statistics");return e.data.success?(r.gg.debug("âœ… IctOfficerService: Statistics loaded successfully"),{success:!0,data:e.data.data,message:e.data.message}):(r.gg.error("âŒ IctOfficerService: Failed to load statistics:",e.data.message),{success:!1,message:e.data.message||"Failed to load statistics"})}catch(e){return r.gg.error("âŒ IctOfficerService: Error fetching statistics:",e),{success:!1,message:e.response?.data?.message||"Network error while loading statistics"}}},async getPendingRequestsCount(){try{r.gg.debug("ðŸ”„ IctOfficerService: Fetching pending requests count...");const e=await c.get("/ict-officer/pending-count");if(e.data.success)return e.data.data;throw r.gg.error("âŒ IctOfficerService: Failed to load pending count:",e.data.message),new Error(e.data.message||"Failed to load pending requests count")}catch(e){throw r.gg.error("âŒ IctOfficerService: Error fetching pending count:",e),e.response?new Error(e.response.data?.message||"Failed to load pending count"):new Error("Network error while loading pending count")}},async resendRequesterSms(e,t=null){try{r.gg.debug("ðŸ”„ IctOfficerService: Retrying requester SMS for:",{requestId:e,requesterPhone:t});const a=e=>{if(!e)return null;const t=String(e).trim(),s=t.startsWith("+"),a=t.replace(/[^\d]/g,"");return s?`+${a}`:a},i=t||null,o=a(i),n={request_id:e,role:"ict_officer",notification_type:"requester_access_granted",resend_only:!0,force:!0,force_resend:!0,resend_sms:!0,send_sms:!0,send_sms_to_requester:!0,notification_channel:"sms",requester_phone:i||void 0,requester_phone_number:i||void 0,requester_msisdn:o||void 0,staff_phone:i||void 0,staff_phone_number:i||void 0,recipient_phone:o||void 0,destination_phone:o||void 0,phone_number:o||void 0,msisdn:o||void 0,contact_phone:o||void 0};let d;const l=[`/ict-officer/access-requests/${e}/notify`,`/ict-officer/access-requests/${e}/resend-sms`,`/ict-officer/access-requests/${e}/send-notification`,`/ict-officer/access-requests/${e}/grant-access`,"/ict-officer/notify","/ict-officer/resend-sms"];let u;for(let e=0;e<l.length;e++)try{r.gg.debug(`ðŸ”„ Trying endpoint ${e+1}/${l.length}: ${l[e]}`),d=await c.post(l[e],n),r.gg.debug(`âœ… Success with endpoint: ${l[e]}`);break}catch(s){if(console.warn(`âŒ Endpoint ${l[e]} failed:`,s.response?.status,s.response?.data?.message||s.message),u=s,e===l.length-1)throw r.gg.error("ðŸš« All endpoints failed for SMS retry"),u}return d.data?.success?(r.gg.debug("âœ… IctOfficerService: Requester SMS retry triggered successfully"),{success:!0,data:d.data.data,message:d.data.message}):{success:!1,message:d.data?.message||"Failed to trigger SMS retry"}}catch(a){return r.gg.error("âŒ IctOfficerService: Error retrying requester SMS:",a),{success:!1,message:a.response?.data?.message||"Network error while retrying SMS"}}}};t["default"]=o}}]);
//# sourceMappingURL=6700.8d4810dc.js.map