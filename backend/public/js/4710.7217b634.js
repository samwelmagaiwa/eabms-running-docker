"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[4710],{4710:function(e,t,a){a.r(t);a(4603),a(7566),a(8721);var s=a(4373);const r="/api",o=s.A.create({baseURL:r,timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json"}}),n=s.A.create({baseURL:r,timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json"}}),i=!1,d=e=>{e.interceptors.request.use(e=>{const t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e))};d(o),d(n);const c=e=>{e.interceptors.request.use(e=>{if(e.method&&"get"===e.method.toLowerCase())try{const t=new URL(e.url,e.baseURL);t.searchParams.set("_cb",String(Date.now())),e.url=t.pathname+t.search}catch(t){const a=(e.url||"").includes("?")?"&":"?";e.url=`${e.url}${a}_cb=${Date.now()}`}return e},e=>Promise.reject(e))};c(o),c(n);const u={data:null,timestamp:null,maxAge:15e3},l="true"===String({NODE_ENV:"production",VUE_APP_API_TIMEOUT:"30000",VUE_APP_API_URL:"/api",VUE_APP_DEBUG:"false",VUE_APP_LOG_LEVEL:"debug",VUE_APP_NAME:"Mnh Access Management System",VUE_APP_VERSION:"1.0.0",BASE_URL:"/"}.VUE_APP_ENABLE_SMS_RESEND||"false").toLowerCase(),p={isResendEnabled(){return l},async resendSmsGeneric({requestId:e,role:t=null,target:a=null,phone:s=null,channel:r="sms"}){if(!l)return{success:!1,message:"SMS resend not supported by backend; skipped"};const o=e=>{if(!e)return null;const t=String(e).trim(),a=t.startsWith("+"),s=t.replace(/[^\d]/g,"");return a?`+${s}`:s},i=s||null,d=o(i),c={request_id:e,role:t,target:a,notification_type:"generic_sms",resend_only:!0,force:!0,force_resend:!0,resend_sms:!0,send_sms:!0,notification_channel:r,phone:i||void 0,phone_number:d||void 0,recipient_phone:d||void 0,destination_phone:d||void 0,msisdn:d||void 0,contact_phone:d||void 0,requester_phone:i||void 0,requester_phone_number:i||void 0,staff_phone:i||void 0,staff_phone_number:i||void 0},u=[];let p,m;for(let l=0;l<u.length;l++)try{return p=await n.post(u[l],c),{success:!!p.data?.success,data:p.data?.data,message:p.data?.message}}catch(h){m=h;continue}return{success:!1,message:m?.response?.data?.message||m?.message||"No resend endpoints configured"}},async getPendingRequestsCount(e=!1){if(!e&&u.data&&u.timestamp){const e=Date.now()-u.timestamp;if(e<u.maxAge)return i&&Math.round(e/1e3),u.data}let t=null;const a=2;for(let r=1;r<=a;r++)try{const e=await n.get("/notifications/pending-count");if(e.data.success)return u.data=e.data.data,u.timestamp=Date.now(),e.data.data;console.error("‚ùå NotificationService: Failed to load pending count:",e.data.message),t=new Error(e.data.message||"Failed to load pending requests count")}catch(s){if(r===a&&i&&console.error("‚ùå NotificationService: Error fetching pending count:",s?.message||s),s.response&&(console.error("Response status:",s.response.status),console.error("Response data:",s.response.data),console.error("Response headers:",s.response.headers)),t=s,401===s.response?.status||403===s.response?.status)break;if(500===s.response?.status&&r>=2)break;r<a&&await new Promise(e=>setTimeout(e,1e3*r))}if(t){if(u.data)return console.warn("‚ö†Ô∏è NotificationService: Using stale cached data due to API failure"),u.data;i&&(console.error("üö´ NotificationService: All retry attempts failed"),console.error("Last error details:",{message:t.message,status:t.response?.status,data:t.response?.data})),i&&console.warn("üîÑ NotificationService: Providing fallback data to prevent UI breakage");const e={total_pending:0,requires_attention:!1,details:null};return u.data=e,u.timestamp=Date.now(),e}return{total_pending:0,requires_attention:!1,details:null}},async getPendingRequestsBreakdown(){try{const e=await n.get("/notifications/breakdown");if(e.data.success)return e.data.data;throw console.error("‚ùå NotificationService: Failed to load breakdown:",e.data.message),new Error(e.data.message||"Failed to load breakdown")}catch(e){console.error("‚ùå NotificationService: Error fetching breakdown:",e);let t="Network error while loading breakdown";throw e.response?t=e.response.data?.message||"Failed to load breakdown":"ECONNABORTED"===e.code?t="Request timed out - server may be slow":e.message.includes("Network Error")&&(t="Network connection error"),new Error(t)}},clearCache(){u.data=null,u.timestamp=null},getRoleNotificationConfig(e){const t={head_of_department:{routePattern:"/hod-dashboard",menuItems:["/hod-dashboard/request-list"],description:"New requests awaiting HOD approval"},divisional_director:{routePattern:"/divisional-dashboard",menuItems:["/divisional-dashboard/combined-requests"],description:"HOD-approved requests awaiting divisional approval"},ict_director:{routePattern:"/dict-dashboard",menuItems:["/dict-dashboard/combined-requests"],description:"Divisional-approved requests awaiting ICT Director approval"},head_of_it:{routePattern:"/head_of_it-dashboard",menuItems:["/head_of_it-dashboard/combined-requests"],description:"ICT Director-approved requests awaiting Head of IT approval"},ict_officer:{routePattern:"/ict-dashboard",menuItems:["/ict-dashboard/access-requests"],description:"Requests requiring implementation (excludes implemented/completed)"},admin:{routePattern:"/admin-dashboard",menuItems:["/admin-dashboard","/service-users"],description:"System-wide pending requests"}};return t[e]||{routePattern:"/user-dashboard",menuItems:[],description:"No pending approval tasks"}},shouldShowNotificationForRoute(e,t){const a=this.getRoleNotificationConfig(t);return a.menuItems.includes(e)}};t["default"]=p}}]);
//# sourceMappingURL=4710.7217b634.js.map