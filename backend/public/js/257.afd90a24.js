"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[257,5389,9189],{373:function(e,t,s){s.d(t,{A:function(){return de}});var a=s(5796);const r={class:"rounded-lg max-w-6xl w-full mx-6 h-[95vh] overflow-hidden bg-gradient-to-r from-blue-900 via-blue-800 to-blue-900 text-white flex flex-col timeline-typography"},i={class:"flex items-center justify-between p-6 border-b border-blue-600/40 bg-gradient-to-r from-blue-900 via-blue-800 to-blue-900 text-white"},o={key:0,class:"text-base text-blue-200"},n={class:"p-6 overflow-y-auto flex-1"},c={key:0,class:"py-16 flex items-center justify-center"},d={key:1,class:"text-center py-12"},l={class:"text-gray-500 text-sm mt-1"},u={key:2,class:"relative"},m={class:"mb-4 p-3 bg-blue-800 text-white rounded-lg border border-blue-400/50"},g={class:"flex items-center justify-between mb-1"},p=["disabled"],f={key:1,class:"text-emerald-300 text-xs"},h={class:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm"},_={key:0},v={key:0,class:"mt-3 pt-2 border-t border-blue-600/40"},y={class:"space-y-1.5"},b={class:"space-y-4"},w={key:0,class:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20"},k={key:1,class:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20"},S={key:2,class:"w-1.5 h-1.5 rounded-full bg-gray-400"},q={class:"ml-4 flex-1"},x={class:"flex items-center justify-between mb-1"},I={class:"font-medium text-sm text-white"},D={class:"space-y-1 text-xs"},F={key:0,class:"flex items-center gap-2"},L={class:"text-xs text-white leading-relaxed"},E={key:0,class:"text-blue-200 text-xs"},O={key:1,class:"flex items-center gap-2"},C={class:"text-xs text-white leading-relaxed"},A={key:2,class:"flex items-start gap-2"},R={class:"text-white text-xs leading-relaxed whitespace-pre-wrap break-words"},T={key:3,class:"flex items-center gap-2"},j={class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-red-900/30 text-red-300 border border-red-500/40"},$={key:4,class:"flex items-center gap-2"},N={key:5,class:"flex items-start gap-2"},H={class:"space-y-0.5"},U={key:6,class:"flex items-center"},P={class:"text-xs text-white"},X={key:0,class:"mt-2"},z={key:1,class:"mt-2 border-t border-gray-200 pt-2"},M={class:"bg-gray-50 rounded-lg p-3"},B={class:"flex items-center justify-between mb-2"},Q={key:0,class:"text-red-600 text-xs"},V={class:"flex justify-end space-x-2"},W=["disabled"],Y={key:0,class:"w-3 h-3 mr-1 animate-spin",fill:"none",viewBox:"0 0 24 24"},J={key:1},K={key:2},G={class:"flex justify-between p-4 border-t border-blue-600/40 bg-gradient-to-r from-blue-900 via-blue-800 to-blue-900"};function Z(e,t,s,Z,ee,te){return s.show?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[12000]",onClick:t[13]||(t[13]=(0,a.D$)((...e)=>te.close&&te.close(...e),["self"]))},[(0,a.Lk)("div",r,[(0,a.Lk)("div",i,[(0,a.Lk)("div",null,[t[14]||(t[14]=(0,a.Lk)("h2",{class:"text-2xl font-semibold text-white"},"Request Timeline",-1)),te.normalizedRequest?((0,a.uX)(),(0,a.CE)("p",o," Request #"+(0,a.v_)(te.normalizedRequest.display_id)+" - "+(0,a.v_)(te.normalizedRequest.staff_name||"‚Äî"),1)):(0,a.Q3)("",!0)]),(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>te.close&&te.close(...e)),class:"text-gray-400 hover:text-gray-600 transition-colors"},[...t[15]||(t[15]=[(0,a.Lk)("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),(0,a.Lk)("div",n,[ee.loading?((0,a.uX)(),(0,a.CE)("div",c,[...t[16]||(t[16]=[(0,a.Fv)('<div class="flex items-center space-x-3 px-4 py-2 rounded-full bg-blue-700/40 border border-blue-400/40 shadow-lg backdrop-blur-sm" data-v-00d156ea><div class="relative" data-v-00d156ea><div class="h-6 w-6 rounded-full border-2 border-blue-300 border-t-transparent animate-spin" data-v-00d156ea></div><div class="absolute inset-0 rounded-full" style="box-shadow:0 0 12px 2px rgba(59, 130, 246, 0.6);" data-v-00d156ea></div></div><span class="text-blue-100 font-medium tracking-wide" data-v-00d156ea>Loading timeline‚Ä¶</span></div>',1)])])):ee.error?((0,a.uX)(),(0,a.CE)("div",d,[t[17]||(t[17]=(0,a.Lk)("div",{class:"text-red-600 mb-2"},[(0,a.Lk)("svg",{class:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.268 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),t[18]||(t[18]=(0,a.Lk)("p",{class:"text-red-600 font-medium"},"Failed to load timeline",-1)),(0,a.Lk)("p",l,(0,a.v_)(ee.error),1),(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>te.loadTimeline&&te.loadTimeline(...e)),class:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"}," Retry ")])):ee.timelineData?((0,a.uX)(),(0,a.CE)("div",u,[(0,a.Lk)("div",m,[(0,a.Lk)("div",g,[t[19]||(t[19]=(0,a.Lk)("h3",{class:"font-medium text-white text-sm"},"Request Details",-1)),te.normalizedRequest?.id&&!ee.hasUserSigned?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[2]||(t[2]=(...e)=>te.handleSignDocument&&te.handleSignDocument(...e)),disabled:ee.isSigning,class:"px-2 py-1 text-xs rounded bg-emerald-600 hover:bg-emerald-700 disabled:opacity-50",title:"Digitally sign this document"},(0,a.v_)(ee.isSigning?"Signing‚Ä¶":"Sign Document"),9,p)):ee.hasUserSigned?((0,a.uX)(),(0,a.CE)("span",f,"You signed this document")):(0,a.Q3)("",!0)]),(0,a.Lk)("div",h,[(0,a.Lk)("div",null,[t[20]||(t[20]=(0,a.Lk)("span",{class:"font-medium"},"Staff Name:",-1)),(0,a.eW)(" "+(0,a.v_)(te.normalizedRequest?.staff_name||"‚Äî"),1)]),(0,a.Lk)("div",null,[t[21]||(t[21]=(0,a.Lk)("span",{class:"font-medium"},"PF Number:",-1)),(0,a.eW)(" "+(0,a.v_)(te.normalizedRequest?.pf_number||"‚Äî"),1)]),(0,a.Lk)("div",null,[t[22]||(t[22]=(0,a.Lk)("span",{class:"font-medium"},"Department:",-1)),(0,a.eW)(" "+(0,a.v_)(te.normalizedRequest?.department_name||"N/A"),1)]),(0,a.Lk)("div",null,[t[23]||(t[23]=(0,a.Lk)("span",{class:"font-medium"},"Request Type:",-1)),(0,a.eW)(" "+(0,a.v_)(te.normalizedRequest?.request_type_name||"‚Äî"),1)]),te.normalizedRequest?.access_type_name?((0,a.uX)(),(0,a.CE)("div",_,[t[24]||(t[24]=(0,a.Lk)("span",{class:"font-medium"},"Access Type:",-1)),(0,a.eW)(" "+(0,a.v_)(te.normalizedRequest?.access_type_name),1)])):(0,a.Q3)("",!0),(0,a.Lk)("div",null,[t[25]||(t[25]=(0,a.Lk)("span",{class:"font-medium"},"Submitted:",-1)),(0,a.eW)(" "+(0,a.v_)(te.formatDateTime(te.normalizedRequest?.created_at)),1)])]),ee.signatures&&ee.signatures.length?((0,a.uX)(),(0,a.CE)("div",v,[t[29]||(t[29]=(0,a.Lk)("h4",{class:"text-sm font-semibold text-white mb-2"},"Digital Signatures",-1)),(0,a.Lk)("ul",y,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ee.signatures,e=>((0,a.uX)(),(0,a.CE)("li",{key:e.id,class:"text-sm text-blue-100 leading-relaxed"},[t[26]||(t[26]=(0,a.Lk)("span",{class:"text-emerald-300 font-medium"},"Signed by",-1)),(0,a.eW)(" "+(0,a.v_)(e.user_name||"Unknown")+" ",1),t[27]||(t[27]=(0,a.Lk)("span",{class:"text-emerald-300 font-medium"},"at",-1)),(0,a.eW)(" "+(0,a.v_)(e.signed_at||"‚Äî")+" ",1),t[28]||(t[28]=(0,a.Lk)("span",{class:"text-emerald-300 font-medium"},"Signature",-1)),(0,a.eW)(": "+(0,a.v_)(e.signature_preview)+"‚Ä¶ ",1)]))),128))])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",b,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(te.timelineSteps,(e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"relative flex items-start"},[s<te.timelineSteps.length-1?((0,a.uX)(),(0,a.CE)("div",{key:0,class:(0,a.C4)(["absolute left-3 top-8 w-0.5 h-12 bg-gray-200",{"bg-green-400":"completed"===e.status,"bg-red-400":"rejected"===e.status,"bg-yellow-400":"pending"===e.status}])},null,2)):(0,a.Q3)("",!0),(0,a.Lk)("div",{class:(0,a.C4)(["flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center border-2 bg-blue-800",te.getStepIconClasses(e.status)])},["completed"===e.status?((0,a.uX)(),(0,a.CE)("svg",w,[...t[30]||(t[30]=[(0,a.Lk)("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])])):"rejected"===e.status?((0,a.uX)(),(0,a.CE)("svg",k,[...t[31]||(t[31]=[(0,a.Lk)("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)])])):((0,a.uX)(),(0,a.CE)("div",S))],2),(0,a.Lk)("div",q,[(0,a.Lk)("div",{class:(0,a.C4)(["bg-blue-800 text-white border rounded-lg p-3 shadow-sm",{"border-green-300":"completed"===e.status,"border-red-300":"rejected"===e.status,"border-yellow-300":"pending"===e.status,"border-blue-300":"active"===e.status}])},[(0,a.Lk)("div",x,[(0,a.Lk)("h4",I,(0,a.v_)(e.title),1),(0,a.Lk)("span",{class:(0,a.C4)(["inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",te.getStatusClasses(e.statusLabel||e.status)]),style:(0,a.Tr)(te.getStatusStyle(e.statusLabel||e.status))},(0,a.v_)(e.statusLabel),7)]),(0,a.Lk)("div",D,[e.actor?((0,a.uX)(),(0,a.CE)("div",F,[t[32]||(t[32]=(0,a.Lk)("span",{class:"font-medium text-white w-28 text-xs"},"Actor:",-1)),(0,a.Lk)("span",L,(0,a.v_)(e.actor),1),e.position?((0,a.uX)(),(0,a.CE)("span",E,"("+(0,a.v_)(e.position)+")",1)):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0),e.timestamp?((0,a.uX)(),(0,a.CE)("div",O,[t[33]||(t[33]=(0,a.Lk)("span",{class:"font-medium text-white w-28 text-xs"},"Date:",-1)),(0,a.Lk)("span",C,(0,a.v_)(te.formatDateTime(e.timestamp)),1)])):(0,a.Q3)("",!0),e.comments?((0,a.uX)(),(0,a.CE)("div",A,[t[34]||(t[34]=(0,a.Lk)("span",{class:"font-medium text-white w-28 flex-shrink-0 text-xs"},"Comments:",-1)),(0,a.Lk)("span",R,(0,a.v_)(e.comments),1)])):(0,a.Q3)("",!0),"divisional"===e.id&&("skipped"===ee.timelineData?.request?.divisional_status||"Skipped"===e.statusLabel)||"hod"===e.id&&("skipped"===ee.timelineData?.request?.hod_status||"Skipped"===e.statusLabel)?((0,a.uX)(),(0,a.CE)("div",T,[t[35]||(t[35]=(0,a.Lk)("span",{class:"font-medium text-white w-28 text-xs"},"Signature:",-1)),(0,a.Lk)("span",j,(0,a.v_)("divisional"===e.id?"No Divisional Director ‚Äî Stage Skipped":"No HOD ‚Äî Stage Skipped"),1)])):e.hasSignature?((0,a.uX)(),(0,a.CE)("div",$,[...t[36]||(t[36]=[(0,a.Lk)("span",{class:"font-medium text-white w-28 text-xs"},"Signature:",-1),(0,a.Lk)("span",{class:"text-green-300 text-xs"},"‚úì Signed",-1)])])):(0,a.Q3)("",!0),e.rejectionReasons&&e.rejectionReasons.length?((0,a.uX)(),(0,a.CE)("div",N,[t[37]||(t[37]=(0,a.Lk)("span",{class:"font-medium text-white w-28 flex-shrink-0 text-xs"},"Reasons:",-1)),(0,a.Lk)("div",H,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.rejectionReasons,e=>((0,a.uX)(),(0,a.CE)("div",{key:e,class:"text-red-700 bg-red-100 px-1.5 py-0.5 rounded text-xs"},(0,a.v_)(e),1))),128))])])):(0,a.Q3)("",!0),e.assignedOfficer?((0,a.uX)(),(0,a.CE)("div",U,[t[38]||(t[38]=(0,a.Lk)("span",{class:"font-medium text-white w-28 text-xs"},"Officer:",-1)),(0,a.Lk)("span",P,(0,a.v_)(e.assignedOfficer),1)])):(0,a.Q3)("",!0)]),"ict_officer_implementation"===e.id&&te.canUpdateImplementation&&!ee.showUpdateForm?((0,a.uX)(),(0,a.CE)("div",X,[(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>te.openUpdateForm&&te.openUpdateForm(...e)),class:"inline-flex items-center px-3 py-1.5 bg-blue-600 text-white text-xs font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[...t[39]||(t[39]=[(0,a.Lk)("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),(0,a.eW)(" Update Progress ",-1)])])])):(0,a.Q3)("",!0),"ict_officer_implementation"===e.id&&ee.showUpdateForm?((0,a.uX)(),(0,a.CE)("div",z,[(0,a.Lk)("div",M,[(0,a.Lk)("div",B,[t[41]||(t[41]=(0,a.Lk)("h5",{class:"text-xs font-medium text-gray-900"}," Update Implementation Progress ",-1)),(0,a.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>te.closeUpdateForm&&te.closeUpdateForm(...e)),class:"text-gray-400 hover:text-gray-600"},[...t[40]||(t[40]=[(0,a.Lk)("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),(0,a.Lk)("form",{onSubmit:t[8]||(t[8]=(0,a.D$)((...e)=>te.updateImplementationProgress&&te.updateImplementationProgress(...e),["prevent"])),class:"space-y-2"},[(0,a.Lk)("div",null,[t[43]||(t[43]=(0,a.Lk)("label",{for:"status",class:"block text-xs font-medium text-gray-700 mb-0.5"}," Status ",-1)),(0,a.bo)((0,a.Lk)("select",{id:"status","onUpdate:modelValue":t[5]||(t[5]=e=>ee.updateForm.status=e),required:"",class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},[...t[42]||(t[42]=[(0,a.Lk)("option",{value:""},"Select Status",-1),(0,a.Lk)("option",{value:"implementation_in_progress"},"In Progress",-1),(0,a.Lk)("option",{value:"implemented"},"Implemented",-1),(0,a.Lk)("option",{value:"rejected"},"Rejected",-1)])],512),[[a.u1,ee.updateForm.status]])]),(0,a.Lk)("div",null,[t[44]||(t[44]=(0,a.Lk)("label",{for:"comments",class:"block text-xs font-medium text-gray-700 mb-0.5"}," Implementation Comments ",-1)),(0,a.bo)((0,a.Lk)("textarea",{id:"comments","onUpdate:modelValue":t[6]||(t[6]=e=>ee.updateForm.comments=e),rows:"2",placeholder:"Add comments about the implementation progress...",class:"w-full px-2 py-1 text-xs border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 resize-none"},null,512),[[a.Jo,ee.updateForm.comments]])]),ee.updateError?((0,a.uX)(),(0,a.CE)("div",Q,(0,a.v_)(ee.updateError),1)):(0,a.Q3)("",!0),(0,a.Lk)("div",V,[(0,a.Lk)("button",{type:"button",onClick:t[7]||(t[7]=(...e)=>te.closeUpdateForm&&te.closeUpdateForm(...e)),class:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"}," Cancel "),(0,a.Lk)("button",{type:"submit",disabled:ee.updating||!ee.updateForm.status,class:"inline-flex items-center px-3 py-1.5 text-xs font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},[ee.updating?((0,a.uX)(),(0,a.CE)("svg",Y,[...t[45]||(t[45]=[(0,a.Lk)("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),(0,a.Lk)("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(0,a.Q3)("",!0),ee.updating?((0,a.uX)(),(0,a.CE)("span",J,"Updating...")):((0,a.uX)(),(0,a.CE)("span",K,"Update Progress"))],8,W)])],32)])])):(0,a.Q3)("",!0)],2)])]))),128))])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",G,[(0,a.Lk)("div",null,[te.canShowUpdateProgressButton?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[9]||(t[9]=(...e)=>te.openUpdateProgress&&te.openUpdateProgress(...e)),class:"inline-flex items-center px-3 py-1.5 bg-blue-600 text-white text-xs font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"},[...t[46]||(t[46]=[(0,a.Lk)("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[(0,a.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),(0,a.eW)(" Update Progress ",-1)])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",null,[(0,a.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>te.close&&te.close(...e)),class:"px-3 py-1.5 text-xs text-white rounded transition-colors shadow-md",style:{"background-color":"#ff0000"},onMouseenter:t[11]||(t[11]=e=>e.target.style.backgroundColor="#cc0000"),onMouseleave:t[12]||(t[12]=e=>e.target.style.backgroundColor="#FF0000")}," Close ",32)])])])])):(0,a.Q3)("",!0)}s(4114),s(8111),s(116);var ee=s(5389),te=s(9189),se=s(4063),ae=s(9729),re=s(460),ie=s(1127),oe={name:"RequestTimeline",props:{show:{type:Boolean,default:!1},requestId:{type:[Number,String],default:null}},emits:["close","updated","openUpdateProgress"],data(){return{loading:!1,error:null,timelineData:null,signatures:[],hasUserSigned:!1,isSigning:!1,showUpdateForm:!1,updateForm:{status:"",comments:""},updating:!1,updateError:null}},setup(){const{hasRole:e,ROLES:t,user:s}=(0,ie.h)();return{hasRole:e,ROLES:t,currentUser:s}},computed:{normalizedRequest(){const e=this.timelineData?.request||this.timelineData?.request_info||null;if(!e)return null;const t=Array.isArray(e.request_types)?e.request_types:Array.isArray(e.request_type)?e.request_type:e.request_type_name?[e.request_type_name]:e.services||[],s=Array.isArray(t)?t.join(", "):t||"";return{id:e.id||e.request_id,display_id:e.request_id||(e.id?`REQ-${String(e.id).padStart(6,"0")}`:""),staff_name:e.staff_name||e.staffName||e.full_name||e.name||e.employee_name||e.applicant_name||e.user_name||e.requester_name||e.requester?.name||e.profile?.staff_name||e.profile?.full_name||e.user?.name||"",pf_number:e.pf_number||e.pfNumber||e.PF_NUMBER||e.pf||e.employee_id||e.employee_no||e.employeeNumber||e.profile?.pf_number||e.profile?.employee_id||e.pf_number_display||"",department_name:e.department&&(e.department.name||e.department.department_name||e.department.label)||e.department_name||e.departmentLabel||e.department_label||e.department||e.dept||e.profile?.department_name||e.profile?.department||e.department_id||"",request_type_name:s,access_type_name:e.access_type_name||e.access_type||"",created_at:e.created_at||e.submission_date||e.createdAt||null}},isIctOfficer(){return this.hasRole(this.ROLES.ICT_OFFICER)},isIctDirector(){return this.hasRole(this.ROLES.ICT_DIRECTOR)},isDivisionalDirector(){return this.hasRole(this.ROLES.DIVISIONAL_DIRECTOR)},isHeadOfIT(){return this.hasRole(this.ROLES.HEAD_OF_IT)},isHeadOfDepartment(){return this.hasRole(this.ROLES.HEAD_OF_DEPARTMENT)},currentService(){return this.isIctOfficer?ee["default"]:this.isIctDirector?te["default"]:this.isDivisionalDirector?se.A:this.isHeadOfIT?ae.A:this.isHeadOfDepartment?re.A:ee["default"]},canUpdateImplementation(){if(!this.isIctOfficer||!this.timelineData?.request)return!1;const e=this.timelineData.request;return e.ict_officer_user_id&&e.ict_officer_user_id===this.currentUser?.id&&!e.ict_officer_implemented_at&&"implemented"!==e.ict_officer_status&&"rejected"!==e.ict_officer_status},canShowUpdateProgressButton(){if(!this.isIctOfficer||!this.timelineData?.request)return!1;const e=this.timelineData.request;e.ict_officer_user_id,this.currentUser,e.ict_officer_status,e.status,this.isIctOfficer;const t=e.ict_officer_user_id&&e.ict_officer_user_id===this.currentUser?.id&&("assigned_to_ict"===e.status||"implementation_in_progress"===e.status||"assigned"===e.ict_officer_status||"implementation_in_progress"===e.ict_officer_status)&&"implemented"!==e.ict_officer_status&&"rejected"!==e.ict_officer_status;return t},timelineSteps(){if(!this.timelineData)return[];const e=this.timelineData.request||this.timelineData.request_info;if(!e)return[];const t=[];t.push({id:"submission",title:"Request Submitted",status:"completed",statusLabel:"Completed",actor:e.staff_name,position:"Requester",timestamp:e.created_at,comments:null,hasSignature:!!e.signature_path});const s=this.getApprovalStatus("hod",e),a=e.hod_name||e.hod_approved_by_name||e.approved_by_name||"Head of Department",r=e.hod_approved_at||e.hod_rejected_at||e.updated_at||e.created_at||null;t.push({id:"hod",title:"HOD/BM Approval",status:s.status,statusLabel:s.label,actor:a,position:"Head of Department",timestamp:r,comments:e.hod_comments,hasSignature:!!e.hod_signature_path});const i=this.getApprovalStatus("divisional",e),o=e.divisional_director_name||e.divisional_name||e.divisional_approved_by_name||e.approved_by_name||"Divisional Director",n=e.divisional_approved_at||e.divisional_rejected_at||e.updated_at||e.created_at||null,c=e.divisional_director_comments||e.divisional_comments||null;t.push({id:"divisional",title:"Divisional Director Approval",status:i.status,statusLabel:i.label,actor:o,position:"Divisional Director",timestamp:n,comments:c,hasSignature:!!e.divisional_director_signature_path});const d=this.getApprovalStatus("ict_director",e),l=e.ict_director_name||e.dict_director_name||e.ict_director_approved_by_name||e.approved_by_name||"ICT Director",u=e.ict_director_approved_at||e.dict_approved_at||e.updated_at||e.created_at||null,m=e.ict_director_comments||e.dict_comments||null;t.push({id:"ict_director",title:"ICT Director Approval",status:d.status,statusLabel:d.label,actor:l,position:"ICT Director",timestamp:u,comments:m,hasSignature:!!e.dict_signature_path,rejectionReasons:e.ict_director_rejection_reasons||[]});const g=this.getApprovalStatus("head_it",e),p=e.head_it_name||e.head_of_it_name||e.head_it_approved_by_name||e.approved_by_name||"Head of IT",f=e.head_it_approved_at||e.head_it_rejected_at||e.updated_at||e.created_at||null,h=e.head_it_comments||null;t.push({id:"head_it",title:"Head of IT Approval",status:g.status,statusLabel:g.label,actor:p,position:"Head of IT",timestamp:f,comments:h,hasSignature:!!e.head_it_signature_path});let _="pending",v="Waiting",y=null;"rejected"===e.ict_officer_status?(_="rejected",v="Rejected",y=e.ict_officer_rejected_at):"implemented"===e.ict_officer_status?(_="completed",v="Implemented",y=this.getValidTimestamp(e.ict_officer_implemented_at)):"implementation_in_progress"===e.ict_officer_status?(_="active",v="In Progress",y=this.getValidTimestamp(e.ict_officer_started_at)||this.getValidTimestamp(e.ict_officer_assigned_at)):e.ict_officer_assigned_at&&e.ict_officer_user_id&&(_="active",v="Assigned - Pending Implementation",y=this.getValidTimestamp(e.ict_officer_assigned_at));const b=this.getOverallProgressIndex(e);(b>=6||b>=5&&"rejected"!==_)&&(_="completed",v="Implemented",y||(y=this.getValidTimestamp(e.ict_officer_implemented_at)||this.getValidTimestamp(e.updated_at)||this.getValidTimestamp(e.head_it_approved_at)));const w=e.ict_officer_name||e.assigned_ict_officer&&e.assigned_ict_officer.name||e.assigned_ict_officer||e.ict_officer||"ICT Department",k=e.implementation_comments||e.ict_officer_comments||e.ict_implementation_comments||e.ict_implementation_comment||e.ict_implementation_details||"‚Äî",S=y||this.getValidTimestamp(e.ict_officer_implemented_at)||this.getValidTimestamp(e.ict_officer_rejected_at)||this.getValidTimestamp(e.ict_officer_started_at)||this.getValidTimestamp(e.ict_officer_assigned_at)||this.getValidTimestamp(e.updated_at)||this.getValidTimestamp(e.created_at);return t.push({id:"ict_officer_implementation",title:"ICT Officer Implementation",status:_,statusLabel:v,actor:w,position:"ICT Officer",timestamp:S,comments:k,hasSignature:!!e.ict_officer_signature_path}),e.cancelled_at&&t.push({id:"cancellation",title:"Request Cancelled",status:"rejected",statusLabel:"Cancelled",actor:e.cancelled_by||"System",position:"Administrator",timestamp:e.cancelled_at,comments:e.cancellation_reason}),t}},watch:{show(e){e&&this.requestId&&this.loadTimeline()},requestId(e,t){this.show&&e&&e!==t&&this.loadTimeline()}},methods:{async loadTimeline(){if(this.requestId&&(!this.timelineData?.request?.id||String(this.timelineData.request.id)!==String(this.requestId)||this.loading||this.error)){this.loading=!0,this.error=null;try{this.isIctOfficer,this.isIctDirector,this.isDivisionalDirector,this.isHeadOfIT,this.isHeadOfDepartment;const t=this.requestId,a=[];a.push(this.currentService),this.isIctOfficer||this.currentService===re.A||a.push(re.A),this.currentService!==ee["default"]&&a.push(ee["default"]);let r=!1,i=null;for(const s of a)try{const e=await s.getRequestTimeline(t);if(e&&void 0!==e.success){if(e.success){this.timelineData=e.data,r=!0;break}i=new Error(e.error||e.message||"Failed to load timeline data")}else{if(e){this.timelineData=e,r=!0;break}i=new Error("No timeline data returned")}}catch(e){i=e}if(!r){let s=null;try{const e=await re.A.getHodRequestById(t);e?.success&&e.data&&(s=e.data)}catch(e){}if(!s)try{const e=await re.A.getRequestById(t);if(e?.success&&e.data&&(s=e.data),!s){const e=await ee["default"].getAccessRequestById(t);e?.success&&e.data&&(s=e.data)}}catch(e){}s&&(this.timelineData={request:s,ict_assignments:[]},r=!0)}if(!r)throw i||new Error("Failed to load timeline");try{const e=this.timelineData?.request?.id||this.timelineData?.request_info?.id;if(e){const t=(await s.e(1075).then(s.bind(s,1075))).default,a=await t.list(e);this.signatures=Array.isArray(a?.data)?a.data:[];const r=this.currentUser?.id;this.hasUserSigned=!!this.signatures.find(e=>e.user_id===r)}}catch(e){console.warn("Failed to load digital signatures",e),this.signatures=[]}}catch(t){console.error("‚ùå RequestTimeline: Error loading timeline:",t),this.error=t.message||t.response?.data?.message||"Failed to load timeline data"}finally{this.loading=!1}}},close(){this.$emit("close")},async handleSignDocument(){try{this.isSigning=!0;const e=this.timelineData?.request?.id||this.timelineData?.request_info?.id;if(!e)return;const t=(await s.e(1075).then(s.bind(s,1075))).default,a=await t.sign(e);if(a?.data?.success){const s=await t.list(e);this.signatures=Array.isArray(s?.data)?s.data:[],this.hasUserSigned=!0}}catch(e){console.error("Digital sign failed",e)}finally{this.isSigning=!1}},openUpdateProgress(){this.$emit("openUpdateProgress",this.timelineData?.request)},openUpdateForm(){this.showUpdateForm=!0,this.updateForm.status="",this.updateForm.comments="",this.updateError=null},closeUpdateForm(){this.showUpdateForm=!1,this.updateForm.status="",this.updateForm.comments="",this.updateError=null},async updateImplementationProgress(){if(this.updateForm.status){this.updating=!0,this.updateError=null;try{const e=await ee["default"].updateImplementationProgress(this.requestId,this.updateForm.status,this.updateForm.comments);e.success?(await this.loadTimeline(),this.closeUpdateForm(),this.$emit("updated"),this.showSuccessMessage()):this.updateError=e.message||"Failed to update progress"}catch(e){console.error("Error updating progress:",e),this.updateError=e.message||"Network error while updating progress"}finally{this.updating=!1}}else this.updateError="Please select a status"},showSuccessMessage(){const e=document.createElement("div");e.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300",e.innerHTML='\n        <div class="flex items-center">\n          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">\n            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>\n          </svg>\n          Progress updated successfully!\n        </div>\n      ',document.body.appendChild(e),setTimeout(()=>{e.parentNode&&(e.style.transform="translateX(100%)",e.style.opacity="0",setTimeout(()=>{document.body.removeChild(e)},300))},3e3)},getApprovalStatus(e,t){const s=`${e}_status`,a="ict_officer"===e?`${e}_implemented_at`:`${e}_approved_at`,r=t[s],i=t[a];let o={};if("rejected"===r)o={status:"rejected",label:"Rejected"};else if("skipped"!==r||"divisional"!==e&&"hod"!==e)if("approved"===r||"ict_officer"===e&&"implemented"===r||i)o={status:"completed",label:"ict_officer"===e?"Implemented":"Approved"};else{const s=this.getOverallProgressIndex(t),a={hod:1,divisional:2,ict_director:3,head_it:4,ict_officer:5},r=a[e]||0;if(s>r)o={status:"completed",label:"ict_officer"===e?"Implemented":"Approved"};else if(s===r){const s="ict_officer"===e&&"implementation_in_progress"===t.ict_officer_status?"In Progress":"Pending";o={status:"active",label:s}}else o=this.isPreviousStageComplete(e,t)?{status:"active",label:"Pending"}:{status:"pending",label:"Waiting"}}else o={status:"completed",label:"Skipped"};return"ict_officer"===e&&(t.ict_officer_assigned_at&&t.ict_officer_user_id?(o.assignmentStatus="completed",o.assignmentLabel="Assigned"):t.head_it_approved_at?(o.assignmentStatus="active",o.assignmentLabel="Pending Assignment"):(o.assignmentStatus="pending",o.assignmentLabel="Waiting")),o},getOverallProgressIndex(e){const t=(e.status||"").toString(),s={pending:0,pending_hod:0,hod_approved:1,pending_divisional:1,divisional_approved:2,pending_ict_director:2,ict_director_approved:3,dict_approved:3,pending_head_it:3,head_it_approved:4,pending_ict_officer:4,implementation_in_progress:5,implemented:5,approved:6,completed:6};return s[t]??0},isPreviousStageComplete(e,t){const s=["hod","divisional","ict_director","head_it","ict_officer"],a=s.indexOf(e);if(0===a)return!0;const r=s[a-1],i=`${r}_status`,o="ict_officer"===r?`${r}_implemented_at`:`${r}_approved_at`;return"approved"===t[i]||"ict_officer"===r&&"implemented"===t[i]||!!t[o]},getStepIconClasses(e){switch(e){case"completed":return"bg-green-500 border-green-500";case"rejected":return"bg-red-500 border-red-500";case"pending":return"bg-yellow-500 border-yellow-500";case"active":return"bg-blue-500 border-blue-500";default:return"bg-gray-200 border-gray-300"}},getStatusClasses(e){const t=(e||"").toString().toLowerCase();return["completed","approved","assigned","implemented"].includes(t)?"bg-green-600 text-white":["rejected","cancelled"].includes(t)?"bg-red-600 text-white":["pending","pending assignment","waiting"].includes(t)?"text-white":"bg-gray-500 text-white"},getStatusStyle(e){const t=(e||"").toString().toLowerCase();return["pending","pending assignment","waiting"].includes(t)?{backgroundColor:"#FF0000"}:{}},getValidTimestamp(e){if(!e)return null;try{const t=new Date(e);return isNaN(t.getTime())||t.getFullYear()<2020||t.getFullYear()>2030?(console.warn("Invalid timestamp detected:",e),null):e}catch(t){return console.warn("Error parsing timestamp:",e,t),null}},formatDateTime(e){if(!e)return"N/A";try{const t=new Date(e);return isNaN(t.getTime())||t.getFullYear()<2020||t.getFullYear()>2030?"Invalid Date":t.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return"Invalid Date"}}}},ne=s(1241);const ce=(0,ne.A)(oe,[["render",Z],["__scopeId","data-v-00d156ea"]]);var de=ce},4063:function(e,t,s){s(4114),s(8111),s(1701),s(4603),s(7566),s(8721);var a=s(274);class r{async getDivisionalRequests(e={}){try{const t=new URLSearchParams;e.search&&t.append("search",e.search),e.status&&t.append("status",e.status),e.department&&t.append("department",e.department),e.per_page&&t.append("per_page",e.per_page),e.page&&t.append("page",e.page);const s=await a.A.get(`/divisional/combined-access-requests?${t.toString()}`);if(s.data&&s.data.success)return s.data.data,{success:!0,data:s.data};throw new Error(s.data?.message||"Failed to retrieve Divisional requests")}catch(t){return"Request aborted"===t.message||t.message?.includes("aborted")||t.message?.includes("canceled")?{success:!1,error:"Request aborted",data:null}:(console.error("‚ùå Error fetching Divisional requests:",t),{success:!1,error:t.response?.data?.message||t.message||"Failed to retrieve Divisional requests",data:null})}}async getRequestById(e){try{const t=await a.A.get(`/divisional/combined-access-requests/${e}`);if(t.data&&t.data.success)return{success:!0,data:t.data.data};throw new Error(t.data?.message||"Request not found")}catch(t){return console.error("‚ùå Error fetching request:",t),{success:!1,error:t.response?.data?.message||t.message||"Failed to retrieve request",data:null}}}async updateDivisionalApproval(e,t){try{const s=new FormData;s.append("divisional_status",t.status),s.append("divisional_comments",t.comments||""),s.append("divisional_name",t.divisionalName||""),s.append("divisional_approved_at",(new Date).toISOString()),t.divisionalSignature&&s.append("divisional_signature",t.divisionalSignature),t.moduleData&&s.append("module_data",JSON.stringify(t.moduleData)),t.accessRights&&s.append("access_rights",JSON.stringify(t.accessRights));const r=await a.A.post(`/divisional/combined-access-requests/${e}/approve`,s);if(r.data&&r.data.success)return{success:!0,data:r.data.data,message:"Request approval updated successfully"};throw new Error(r.data?.message||"Failed to update approval")}catch(s){return console.error("‚ùå Error updating Divisional Director approval:",s),{success:!1,error:s.response?.data?.message||s.message||"Failed to update approval",errors:s.response?.data?.errors||null}}}async cancelRequest(e,t){try{const s=await a.A.post(`/divisional/combined-access-requests/${e}/cancel`,{reason:t||"Cancelled by Divisional Director",cancelled_at:(new Date).toISOString()});if(s.data&&s.data.success)return{success:!0,data:s.data.data,message:"Request cancelled successfully"};throw new Error(s.data?.message||"Failed to cancel request")}catch(s){return console.error("‚ùå Error cancelling request:",s),{success:!1,error:s.response?.data?.message||s.message||"Failed to cancel request"}}}async getDivisionalStatistics(){try{const e=await a.A.get("/divisional/combined-access-requests/statistics");if(e.data&&e.data.success)return{success:!0,data:e.data.data};throw new Error(e.data?.message||"Failed to retrieve statistics")}catch(e){return console.error("‚ùå Error fetching Divisional Director statistics:",e),{success:!1,error:e.response?.data?.message||e.message||"Failed to retrieve statistics",data:{pendingDivisional:0,divisionalApproved:0,divisionalRejected:0,total:0}}}}async exportDivisionalRequests(e={},t="excel"){try{const s=new URLSearchParams;e.search&&s.append("search",e.search),e.status&&s.append("status",e.status),e.department&&s.append("department",e.department),e.date_from&&s.append("date_from",e.date_from),e.date_to&&s.append("date_to",e.date_to),s.append("format",t);const r=await a.A.get(`/divisional/combined-access-requests/export?${s.toString()}`,{responseType:"blob"});return{success:!0,data:r.data,filename:this.getFilenameFromHeaders(r.headers)||`divisional_requests_${Date.now()}.${"excel"===t?"xlsx":"csv"}`}}catch(s){return console.error("‚ùå Error exporting Divisional Director requests:",s),{success:!1,error:s.response?.data?.message||s.message||"Failed to export requests"}}}async searchRequests(e){try{const t=await a.A.post("/divisional/combined-access-requests/search",e);if(t.data&&t.data.success)return t.data.data,{success:!0,data:t.data};throw new Error(t.data?.message||"Search failed")}catch(t){return console.error("‚ùå Error searching requests:",t),{success:!1,error:t.response?.data?.message||t.message||"Search failed",data:null}}}async bulkApprove(e,t){try{e.length;const s=await a.A.post("/divisional/combined-access-requests/bulk-approve",{request_ids:e,divisional_comments:t.comments||"",divisional_name:t.divisionalName||"",approved_at:(new Date).toISOString()});if(s.data&&s.data.success)return{success:!0,data:s.data.data,message:`${s.data.data.approved_count||0} requests approved successfully`};throw new Error(s.data?.message||"Bulk approval failed")}catch(s){return console.error("‚ùå Error in bulk approval:",s),{success:!1,error:s.response?.data?.message||s.message||"Bulk approval failed",data:null}}}async getRequestHistory(e){try{const t=await a.A.get(`/divisional/combined-access-requests/${e}/history`);if(t.data&&t.data.success)return{success:!0,data:t.data.data};throw new Error(t.data?.message||"Failed to retrieve request history")}catch(t){return console.error("‚ùå Error fetching request history:",t),{success:!1,error:t.response?.data?.message||t.message||"Failed to retrieve request history",data:[]}}}getFilenameFromHeaders(e){try{const t=e["content-disposition"]||e["Content-Disposition"];if(t){const e=t.match(/filename[^;=\n]*=((['\"]).*?\2|[^;\n]*)/);if(e&&e[1])return e[1].replace(/['"]/g,"")}return null}catch(t){return console.warn("Could not extract filename from headers:",t),null}}validateRequestData(e){const t=[];return e.staff_name&&""!==e.staff_name.trim()||t.push("Staff name is required"),e.pf_number&&""!==e.pf_number.trim()||t.push("PF Number is required"),e.department&&""!==e.department.trim()||t.push("Department is required"),e.phone&&""!==e.phone.trim()||t.push("Phone number is required"),e.services&&0!==e.services.length||t.push("At least one service must be selected"),{isValid:0===t.length,errors:t}}formatRequestForDisplay(e){return{...e,formattedHodApprovalDate:this.formatDate(e.hod_approved_at||e.hod_approval_date),formattedHodApprovalTime:this.formatTime(e.hod_approved_at||e.hod_approval_date),statusText:this.getStatusText(e.divisional_status||e.status),servicesText:this.getServicesText(e.services||e.request_types),requestIdDisplay:e.request_id||`REQ-${e.id.toString().padStart(6,"0")}`}}formatDate(e){if(!e)return"N/A";const t=new Date(e);return t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}formatTime(e){if(!e)return"N/A";const t=new Date(e);return t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}getStatusText(e){const t={hod_approved:"Pending Divisional Approval",divisional_approved:"Divisional Approved",divisional_rejected:"Divisional Rejected",cancelled:"Cancelled",completed:"Completed"};return t[e]||"Unknown Status"}getServicesText(e){if(!e||0===e.length)return"No services";const t={jeeva:"Jeeva",jeeva_access:"Jeeva",wellsoft:"Wellsoft",internet:"Internet",internet_access_request:"Internet"};return e.map(e=>t[e]||e).join(", ")}async getRequestTimeline(e){try{const t=await a.A.get(`/divisional/combined-access-requests/${e}/timeline`);if(t.data&&t.data.success)return{success:!0,data:t.data.data,message:t.data.message};throw new Error(t.data?.message||"Failed to load request timeline")}catch(t){return console.error("‚ùå DivisionalAccessService: Error fetching request timeline:",t),{success:!1,error:t.response?.data?.message||t.message||"Failed to load request timeline"}}}}t.A=new r},5389:function(e,t,s){s.r(t);s(4603),s(7566),s(8721);var a=s(4373),r=s(8998);const i="/api",o=a.A.create({baseURL:i,timeout:0,headers:{"Content-Type":"application/json",Accept:"application/json"}});o.interceptors.request.use(e=>{const t=localStorage.getItem("auth_token");if(t&&(e.headers.Authorization=`Bearer ${t}`),e.method&&"get"===e.method.toLowerCase())try{const t=new URL(e.url,e.baseURL);t.searchParams.set("_cb",String(Date.now())),e.url=t.pathname+t.search}catch(s){const t=(e.url||"").includes("?")?"&":"?";e.url=`${e.url}${t}_cb=${Date.now()}`}return e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,e=>{const t=e.response?.status;if(401===t&&(localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),localStorage.removeItem("session_data"),"undefined"!==typeof window)){const e=window.location.pathname||"";"/"!==e&&"/login"!==e&&(window.location.href="/")}return Promise.reject(e)});const n={async getAccessRequests(){try{r.gg.debug("üîÑ IctOfficerService: Fetching access requests...");const e=await o.get("/ict-officer/access-requests");return e.data.success?(r.gg.debug("‚úÖ IctOfficerService: Access requests loaded successfully"),{success:!0,data:e.data.data,message:e.data.message}):(r.gg.error("‚ùå IctOfficerService: Failed to load access requests:",e.data.message),{success:!1,message:e.data.message||"Failed to load access requests"})}catch(e){return r.gg.error("‚ùå IctOfficerService: Error fetching access requests:",e),{success:!1,message:e.response?.data?.message||"Network error while loading access requests"}}},async getAccessRequestById(e){try{r.gg.debug("üîÑ IctOfficerService: Fetching access request by ID:",e);const t=await o.get(`/ict-officer/access-requests/${e}`);return t.data.success?(r.gg.debug("‚úÖ IctOfficerService: Access request loaded successfully"),{success:!0,data:t.data.data,message:t.data.message}):(r.gg.error("‚ùå IctOfficerService: Failed to load access request:",t.data.message),{success:!1,message:t.data.message||"Failed to load access request"})}catch(t){return r.gg.error("‚ùå IctOfficerService: Error fetching access request:",t),{success:!1,message:t.response?.data?.message||"Network error while loading access request"}}},async assignTaskToSelf(e,t=""){try{r.gg.debug("üîÑ IctOfficerService: Assigning task to self:",e);const s=await o.post(`/ict-officer/access-requests/${e}/assign`,{notes:t});return s.data.success?(r.gg.debug("‚úÖ IctOfficerService: Task assigned successfully"),{success:!0,data:s.data.data,message:s.data.message}):(r.gg.error("‚ùå IctOfficerService: Failed to assign task:",s.data.message),{success:!1,message:s.data.message||"Failed to assign task"})}catch(s){return r.gg.error("‚ùå IctOfficerService: Error assigning task:",s),{success:!1,message:s.response?.data?.message||"Network error while assigning task"}}},async updateProgress(e,t,s=""){try{r.gg.debug("üîÑ IctOfficerService: Updating progress:",e,t);const a=await o.put(`/ict-officer/access-requests/${e}/progress`,{status:t,notes:s});return a.data.success?(r.gg.debug("‚úÖ IctOfficerService: Progress updated successfully"),{success:!0,data:a.data.data,message:a.data.message}):(r.gg.error("‚ùå IctOfficerService: Failed to update progress:",a.data.message),{success:!1,message:a.data.message||"Failed to update progress"})}catch(a){return r.gg.error("‚ùå IctOfficerService: Error updating progress:",a),{success:!1,message:a.response?.data?.message||"Network error while updating progress"}}},async updateImplementationProgress(e,t,s=""){try{r.gg.debug("üîÑ IctOfficerService: Updating implementation progress:",e,t);const a={implementation_status:t,implementation_comments:s};"implementation_in_progress"===t?a.ict_officer_started_at=(new Date).toISOString():"implemented"===t&&(a.ict_officer_implemented_at=(new Date).toISOString());const i=await o.put(`/ict-officer/access-requests/${e}/implementation`,a);return i.data.success?(r.gg.debug("‚úÖ IctOfficerService: Implementation progress updated successfully"),{success:!0,data:i.data.data,message:i.data.message||"Implementation progress updated successfully"}):(r.gg.error("‚ùå IctOfficerService: Failed to update implementation progress:",i.data.message),{success:!1,message:i.data.message||"Failed to update implementation progress"})}catch(a){return r.gg.error("‚ùå IctOfficerService: Error updating implementation progress:",a),{success:!1,message:a.response?.data?.message||"Network error while updating implementation progress"}}},async cancelTask(e,t){try{r.gg.debug("üîÑ IctOfficerService: Canceling task:",e);const s=await o.post(`/ict-officer/access-requests/${e}/cancel`,{reason:t});return s.data.success?(r.gg.debug("‚úÖ IctOfficerService: Task canceled successfully"),{success:!0,data:s.data.data,message:s.data.message}):(r.gg.error("‚ùå IctOfficerService: Failed to cancel task:",s.data.message),{success:!1,message:s.data.message||"Failed to cancel task"})}catch(s){return r.gg.error("‚ùå IctOfficerService: Error canceling task:",s),{success:!1,message:s.response?.data?.message||"Network error while canceling task"}}},async completeImplementation(e,t="",s=null){try{r.gg.debug("üîÑ IctOfficerService: Completing implementation:",e);const a=new FormData;a.append("notes",t),s&&a.append("signature",s);const i=await o.post(`/ict-officer/access-requests/${e}/complete`,a,{headers:{"Content-Type":"multipart/form-data"}});return i.data.success?(r.gg.debug("‚úÖ IctOfficerService: Implementation completed successfully"),{success:!0,data:i.data.data,message:i.data.message}):(r.gg.error("‚ùå IctOfficerService: Failed to complete implementation:",i.data.message),{success:!1,message:i.data.message||"Failed to complete implementation"})}catch(a){return r.gg.error("‚ùå IctOfficerService: Error completing implementation:",a),{success:!1,message:a.response?.data?.message||"Network error while completing implementation"}}},async getRequestTimeline(e){try{r.gg.debug("üîÑ IctOfficerService: Fetching request timeline:",e);const t=await o.get(`/ict-officer/access-requests/${e}/timeline`);if(t.data.success)return r.gg.debug("‚úÖ IctOfficerService: Request timeline loaded successfully"),t.data.data;throw r.gg.error("‚ùå IctOfficerService: Failed to load request timeline:",t.data.message),new Error(t.data.message||"Failed to load request timeline")}catch(t){throw r.gg.error("‚ùå IctOfficerService: Error fetching request timeline:",t),t.response?new Error(t.response.data?.message||"Failed to load timeline data"):new Error("Network error while loading timeline")}},async getAccessRequestTimeline(e){try{r.gg.debug("üîÑ IctOfficerService: Fetching access request timeline:",e);const t=await o.get(`/ict-officer/access-requests/${e}/timeline`);return t.data.success?(r.gg.debug("‚úÖ IctOfficerService: Access request timeline loaded successfully"),{success:!0,data:t.data.data,message:t.data.message}):(r.gg.error("‚ùå IctOfficerService: Failed to load access request timeline:",t.data.message),{success:!1,message:t.data.message||"Failed to load access request timeline"})}catch(t){return r.gg.error("‚ùå IctOfficerService: Error fetching access request timeline:",t),{success:!1,message:t.response?.data?.message||"Network error while loading access request timeline"}}},async grantAccess(e,t){try{r.gg.debug("üîÑ IctOfficerService: Granting access for request:",e),r.gg.debug("Grant access data:",t);const s=await o.post(`/ict-officer/access-requests/${e}/grant-access`,{comments:t.comments||"",implementation_status:"implemented",implementation_completed_at:(new Date).toISOString()});return s.data.success?(r.gg.debug("‚úÖ IctOfficerService: Access granted successfully"),{success:!0,data:s.data.data,message:s.data.message||"Access granted successfully"}):(r.gg.error("‚ùå IctOfficerService: Failed to grant access:",s.data.message),{success:!1,message:s.data.message||"Failed to grant access"})}catch(s){return r.gg.error("‚ùå IctOfficerService: Error granting access:",s),{success:!1,message:s.response?.data?.message||"Network error while granting access"}}},async getStatistics(){try{r.gg.debug("üîÑ IctOfficerService: Fetching statistics...");const e=await o.get("/ict-officer/statistics");return e.data.success?(r.gg.debug("‚úÖ IctOfficerService: Statistics loaded successfully"),{success:!0,data:e.data.data,message:e.data.message}):(r.gg.error("‚ùå IctOfficerService: Failed to load statistics:",e.data.message),{success:!1,message:e.data.message||"Failed to load statistics"})}catch(e){return r.gg.error("‚ùå IctOfficerService: Error fetching statistics:",e),{success:!1,message:e.response?.data?.message||"Network error while loading statistics"}}},async getPendingRequestsCount(){try{r.gg.debug("üîÑ IctOfficerService: Fetching pending requests count...");const e=await o.get("/ict-officer/pending-count");if(e.data.success)return e.data.data;throw r.gg.error("‚ùå IctOfficerService: Failed to load pending count:",e.data.message),new Error(e.data.message||"Failed to load pending requests count")}catch(e){throw r.gg.error("‚ùå IctOfficerService: Error fetching pending count:",e),e.response?new Error(e.response.data?.message||"Failed to load pending count"):new Error("Network error while loading pending count")}},async resendRequesterSms(e,t=null){try{r.gg.debug("üîÑ IctOfficerService: Retrying requester SMS for:",{requestId:e,requesterPhone:t});const a=e=>{if(!e)return null;const t=String(e).trim(),s=t.startsWith("+"),a=t.replace(/[^\d]/g,"");return s?`+${a}`:a},i=t||null,n=a(i),c={request_id:e,role:"ict_officer",notification_type:"requester_access_granted",resend_only:!0,force:!0,force_resend:!0,resend_sms:!0,send_sms:!0,send_sms_to_requester:!0,notification_channel:"sms",requester_phone:i||void 0,requester_phone_number:i||void 0,requester_msisdn:n||void 0,staff_phone:i||void 0,staff_phone_number:i||void 0,recipient_phone:n||void 0,destination_phone:n||void 0,phone_number:n||void 0,msisdn:n||void 0,contact_phone:n||void 0};let d;const l=[`/ict-officer/access-requests/${e}/notify`,`/ict-officer/access-requests/${e}/resend-sms`,`/ict-officer/access-requests/${e}/send-notification`,`/ict-officer/access-requests/${e}/grant-access`,"/ict-officer/notify","/ict-officer/resend-sms"];let u;for(let e=0;e<l.length;e++)try{r.gg.debug(`üîÑ Trying endpoint ${e+1}/${l.length}: ${l[e]}`),d=await o.post(l[e],c),r.gg.debug(`‚úÖ Success with endpoint: ${l[e]}`);break}catch(s){if(console.warn(`‚ùå Endpoint ${l[e]} failed:`,s.response?.status,s.response?.data?.message||s.message),u=s,e===l.length-1)throw r.gg.error("üö´ All endpoints failed for SMS retry"),u}return d.data?.success?(r.gg.debug("‚úÖ IctOfficerService: Requester SMS retry triggered successfully"),{success:!0,data:d.data.data,message:d.data.message}):{success:!1,message:d.data?.message||"Failed to trigger SMS retry"}}catch(a){return r.gg.error("‚ùå IctOfficerService: Error retrying requester SMS:",a),{success:!1,message:a.response?.data?.message||"Network error while retrying SMS"}}}};t["default"]=n},9101:function(e,t,s){s.d(t,{A:function(){return m}});var a=s(5796);const r={class:"bg-gradient-to-r from-blue-900 via-blue-800 to-blue-900 text-white py-4 px-6 border-t border-blue-600/40 shadow-lg backdrop-blur-sm relative",style:{position:"relative","z-index":"1","margin-top":"auto"}},i={class:"flex flex-col md:flex-row justify-between items-center"},o={class:"text-base text-blue-100 flex items-center space-x-2"},n={class:"font-medium"};function c(e,t,s,c,d,l){return(0,a.uX)(),(0,a.CE)("footer",r,[(0,a.Lk)("div",i,[(0,a.Lk)("div",o,[t[0]||(t[0]=(0,a.Lk)("div",{class:"w-6 h-6 bg-blue-600/30 rounded-full flex items-center justify-center border border-blue-500/40"},[(0,a.Lk)("i",{class:"fas fa-hospital text-blue-300 text-sm"})],-1)),(0,a.Lk)("p",n," ¬© "+(0,a.v_)(l.currentYear)+" Muhimbili National Hospital. All rights reserved. ",1)])])])}var d={name:"AppFooter",computed:{currentYear(){return(new Date).getFullYear()}}},l=s(1241);const u=(0,l.A)(d,[["render",c],["__scopeId","data-v-2f68623d"]]);var m=u},9189:function(e,t,s){s.r(t);s(8111),s(2489);var a=s(274);const r={async getDictRequests(e={}){try{const t=await a.A.get("/ict-director/combined-access-requests",{params:e});return{success:!0,data:t.data}}catch(t){return console.error("Error fetching ICT Director requests:",t),{success:!1,error:t.response?.data?.message||t.message||"Failed to fetch requests"}}},async getDictRequest(e){try{const t=await a.A.get(`/ict-director/combined-access-requests/${e}`);return{success:!0,data:t.data}}catch(t){return console.error("Error fetching ICT Director request:",t),{success:!1,error:t.response?.data?.message||t.message||"Failed to fetch request"}}},async updateDictApproval(e,t){try{const s=await a.A.post(`/ict-director/combined-access-requests/${e}/approve`,t);return{success:!0,data:s.data}}catch(s){return console.error("Error updating ICT Director approval:",s),{success:!1,error:s.response?.data?.message||s.message||"Failed to update approval"}}},async cancelRequest(e,t){try{const s=await a.A.post(`/ict-director/combined-access-requests/${e}/cancel`,{reason:t});return{success:!0,data:s.data}}catch(s){return console.error("Error cancelling request:",s),{success:!1,error:s.response?.data?.message||s.message||"Failed to cancel request"}}},async getDictStatistics(){try{const e=await a.A.get("/ict-director/combined-access-requests/statistics");return{success:!0,data:e.data.data||e.data}}catch(e){return console.error("Error fetching ICT Director statistics:",e),{success:!1,error:e.response?.data?.message||e.message||"Failed to fetch statistics"}}},async approveRequest(e,t={}){return await this.updateDictApproval(e,{dict_status:"approved",dict_comments:t.comments||"",dict_name:t.name||""})},async rejectRequest(e,t={}){return await this.updateDictApproval(e,{dict_status:"rejected",dict_comments:t.comments||"",dict_name:t.name||""})},async getDictRecommendations(e={}){try{const t=await a.A.get("/divisional/dict-recommendations",{params:e});return{success:!0,data:t.data}}catch(t){console.error("Error fetching dict recommendations:",t);try{const t=await a.A.get("/divisional/combined-access-requests",{params:{...e,has_ict_director_comments:!0}});t.data,t.data,t.data,t.data,Array.isArray(t.data?.data);const s=t.data?.data||[],r=Array.isArray(s)?s:[],i={...t.data,data:r.filter(e=>e.ict_director_comments&&""!==e.ict_director_comments.trim())};return{success:!0,data:i}}catch(s){return console.error("Fallback also failed:",s),{success:!1,error:t.response?.data?.message||t.message||"Failed to fetch dict recommendations"}}}},async submitDivisionalResponse(e,t){try{const s=await a.A.post(`/divisional/respond-to-dict/${e}`,t);return{success:!0,data:s.data}}catch(s){return console.error("Error submitting divisional response:",s),{success:!1,error:s.response?.data?.message||s.message||"Failed to submit response"}}},async getRequestTimeline(e){try{const t=await a.A.get(`/ict-director/combined-access-requests/${e}/timeline`);if(t.data&&t.data.success)return{success:!0,data:t.data.data,message:t.data.message};throw new Error(t.data?.message||"Failed to load request timeline")}catch(t){return console.error("‚ùå DictAccessService: Error fetching request timeline:",t),{success:!1,error:t.response?.data?.message||t.message||"Failed to load request timeline"}}}};t["default"]=r},9729:function(e,t,s){var a=s(4373);const r="/api",i=a.A.create({baseURL:r,timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json"}});i.interceptors.request.use(e=>{const t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e));const o={async getPendingRequests(){try{const e=await i.get("/head-of-it/all-requests");return e.data.success?{success:!0,data:e.data.data,message:e.data.message}:(console.error("‚ùå HeadOfItService: Failed to load pending requests:",e.data.message),{success:!1,message:e.data.message||"Failed to load pending requests"})}catch(e){return console.error("‚ùå HeadOfItService: Error fetching pending requests:",e),{success:!1,message:e.response?.data?.message||"Network error while loading requests"}}},async getRequestById(e){try{const t=await i.get(`/head-of-it/requests/${e}`);return t.data.success?{success:!0,data:t.data.data,message:t.data.message}:(console.error("‚ùå HeadOfItService: Failed to load request:",t.data.message),{success:!1,message:t.data.message||"Failed to load request"})}catch(t){return console.error("‚ùå HeadOfItService: Error fetching request:",t),{success:!1,message:t.response?.data?.message||"Network error while loading request"}}},async approveRequest(e,t){try{const s=new FormData;s.append("signature",t),s.append("action","approve");const a=await i.post(`/head-of-it/requests/${e}/approve`,s,{headers:{"Content-Type":"multipart/form-data"}});return a.data.success?{success:!0,data:a.data.data,message:a.data.message}:(console.error("‚ùå HeadOfItService: Failed to approve request:",a.data.message),{success:!1,message:a.data.message||"Failed to approve request"})}catch(s){return console.error("‚ùå HeadOfItService: Error approving request:",s),{success:!1,message:s.response?.data?.message||"Network error while approving request"}}},async rejectRequest(e,t,s){try{const a=new FormData;a.append("signature",t),a.append("action","reject"),a.append("reason",s);const r=await i.post(`/head-of-it/requests/${e}/reject`,a,{headers:{"Content-Type":"multipart/form-data"}});return r.data.success?{success:!0,data:r.data.data,message:r.data.message}:(console.error("‚ùå HeadOfItService: Failed to reject request:",r.data.message),{success:!1,message:r.data.message||"Failed to reject request"})}catch(a){return console.error("‚ùå HeadOfItService: Error rejecting request:",a),{success:!1,message:a.response?.data?.message||"Network error while rejecting request"}}},async getIctOfficers(e=null){try{const t=e?`/head-of-it/ict-officers?request_id=${e}`:"/head-of-it/ict-officers",s=await i.get(t);return s.data.success?{success:!0,data:s.data.data,message:s.data.message}:(console.error("‚ùå HeadOfItService: Failed to load ICT officers:",s.data.message),{success:!1,message:s.data.message||"Failed to load ICT officers"})}catch(t){return console.error("‚ùå HeadOfItService: Error fetching ICT officers:",t),{success:!1,message:t.response?.data?.message||"Network error while loading ICT officers"}}},async assignTaskToIctOfficer(e,t,s=null,a=!1){try{const o=async()=>{const s={user_access_id:e,ict_officer_user_id:t,force_reassign:!!a};return i.post("/head-of-it/assign-ict-task",s,{timeout:2e4})},n=async()=>{const r=e=>{if(!e)return null;const t=String(e).trim(),s=t.startsWith("+"),a=t.replace(/[^\d]/g,"");return s?`+${a}`:a},o=s||null,n=r(o),c={request_id:e,ict_officer_id:t,notify_phone:o||void 0,ict_officer_phone:n||void 0,send_sms:!0,send_sms_to_ict_officer:!0,notify_ict_officer:!0,notification_channel:"sms",force_reassign:!!a};return i.post("/head-of-it/assign-task",c,{timeout:2e4})};let c;try{c=await o()}catch(r){const e=r?.response?.status;if(404!==e&&405!==e&&501!==e)throw r;console.warn("HeadOfItService: New assignment endpoint unavailable, falling back to legacy"),c=await n()}return c.data.success?{success:!0,data:c.data.data,message:c.data.message}:(console.error("‚ùå HeadOfItService: Failed to assign task:",c.data.message),{success:!1,message:c.data.message||"Failed to assign task"})}catch(o){console.error("‚ùå HeadOfItService: Error assigning task:",o);const e=o.response?.data?.errors,t=e&&Object.values(e).flat().join(" ")||o.response?.data?.message||o.message||"Network error while assigning task";return{success:!1,message:t}}},async getTaskHistory(e){try{const t=await i.get(`/head-of-it/tasks/${e}/history`);return t.data.success?{success:!0,data:t.data.data,message:t.data.message}:(console.error("‚ùå HeadOfItService: Failed to load task history:",t.data.message),{success:!1,message:t.data.message||"Failed to load task history"})}catch(t){return console.error("‚ùå HeadOfItService: Error fetching task history:",t),{success:!1,message:t.response?.data?.message||"Network error while loading task history"}}},async cancelTaskAssignment(e){try{const s=()=>i.post(`/head-of-it/ict-tasks/${e}/cancel`,null,{timeout:15e3}),a=()=>i.post(`/head-of-it/tasks/${e}/cancel`,null,{timeout:15e3});let r;try{r=await s()}catch(t){const e=t?.response?.status;if(404!==e&&405!==e&&501!==e)throw t;console.warn("HeadOfItService: New cancel endpoint unavailable, falling back to legacy"),r=await a()}return r.data.success?{success:!0,data:r.data.data,message:r.data.message}:(console.error("‚ùå HeadOfItService: Failed to cancel task assignment:",r.data.message),{success:!1,message:r.data.message||"Failed to cancel task assignment"})}catch(s){return console.error("‚ùå HeadOfItService: Error canceling task assignment:",s),{success:!1,message:s.response?.data?.message||"Network error while canceling task assignment"}}},async getDictRecommendations(e={}){try{const t=await i.get("/head-of-it/dict-recommendations",{params:e});return t.data.success?{success:!0,data:t.data,message:t.data.message}:(console.error("‚ùå HeadOfItService: Failed to load DICT recommendations:",t.data.message),{success:!1,message:t.data.message||"Failed to load DICT recommendations"})}catch(t){return console.error("‚ùå HeadOfItService: Error fetching DICT recommendations:",t),{success:!1,message:t.response?.data?.message||"Network error while loading DICT recommendations"}}},async getDictRecommendationStats(){try{const e=await i.get("/head-of-it/dict-recommendations/stats");return e.data.success?{success:!0,data:e.data.data,message:e.data.message}:(console.error("‚ùå HeadOfItService: Failed to load statistics:",e.data.message),{success:!1,message:e.data.message||"Failed to load statistics"})}catch(e){return console.error("‚ùå HeadOfItService: Error fetching statistics:",e),{success:!1,message:e.response?.data?.message||"Network error while loading statistics"}}},async getDictRecommendationDetails(e){try{const t=await i.get(`/head-of-it/dict-recommendations/${e}/details`);return t.data.success?{success:!0,data:t.data.data,message:t.data.message}:(console.error("‚ùå HeadOfItService: Failed to load recommendation details:",t.data.message),{success:!1,message:t.data.message||"Failed to load recommendation details"})}catch(t){return console.error("‚ùå HeadOfItService: Error fetching recommendation details:",t),{success:!1,message:t.response?.data?.message||"Network error while loading recommendation details"}}},async getRequestTimeline(e){try{const t=await i.get(`/head-of-it/requests/${e}/timeline`);return t.data.success?{success:!0,data:t.data.data,message:t.data.message}:(console.error("‚ùå HeadOfItService: Failed to load request timeline:",t.data.message),{success:!1,message:t.data.message||"Failed to load request timeline"})}catch(t){return console.error("‚ùå HeadOfItService: Error fetching request timeline:",t),{success:!1,message:t.response?.data?.message||"Network error while loading request timeline"}}}};t.A=o}}]);
//# sourceMappingURL=257.afd90a24.js.map